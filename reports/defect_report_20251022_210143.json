{
  "timestamp": "2025-10-22 21:01:43",
  "summary": {
    "static_analysis": {
      "total": 288,
      "high": 113,
      "medium": 131,
      "low": 44
    },
    "external_tools": {
      "ruff": 0,
      "pylint": 212,
      "mypy": 1,
      "bandit": 10
    },
    "dynamic_analysis": {
      "compile_errors": 0
    },
    "fixes": {
      "total_fixed": 0,
      "fixed_files": 16
    },
    "verification": {
      "verified_files": 0,
      "compile_errors": 0
    }
  },
  "defects": [
    {
      "file": "build.py",
      "line": 6,
      "col": 13,
      "severity": "HIGH",
      "rule_id": "PY002",
      "message": "调用 os.system 存在命令注入风险。",
      "snippet": "    result = os.system(cmd)"
    },
    {
      "file": "build.py",
      "line": 22,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PY002",
      "message": "调用 os.system 存在命令注入风险。",
      "snippet": "os.system(\"rmdir /s /q dist build *.spec >nul 2>&1\")"
    },
    {
      "file": "main.py",
      "line": 7,
      "col": 3,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "if sys.stdout is None:"
    },
    {
      "file": "main.py",
      "line": 9,
      "col": 3,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "if sys.stderr is None:"
    },
    {
      "file": "main.py",
      "line": 72,
      "col": 73,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'current_time'。",
      "snippet": "            print(f\"【提示】系统设置暂未实现, 当前时间: {current_time}\")  # current_time 未定义"
    },
    {
      "file": "ranking_manager.py",
      "line": 25,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if v is None:"
    },
    {
      "file": "ranking_manager.py",
      "line": 29,
      "col": 19,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'round'。",
      "snippet": "        return int(round(float(v)))"
    },
    {
      "file": "ranking_manager.py",
      "line": 30,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception:"
    },
    {
      "file": "ranking_manager.py",
      "line": 47,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if diff is None:"
    },
    {
      "file": "ranking_manager.py",
      "line": 49,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if diff is None:"
    },
    {
      "file": "ranking_manager.py",
      "line": 52,
      "col": 34,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "        difficulty = int(diff) if diff is not None else 3"
    },
    {
      "file": "ranking_manager.py",
      "line": 53,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception:"
    },
    {
      "file": "ranking_manager.py",
      "line": 74,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if elapsed is None:"
    },
    {
      "file": "ranking_manager.py",
      "line": 101,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception:"
    },
    {
      "file": "ranking_manager.py",
      "line": 147,
      "col": 32,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'x'。",
      "snippet": "        rows.sort(key=lambda x: x.get(\"elapsed\", 1_000_000))"
    },
    {
      "file": "save_manager.py",
      "line": 13,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "save_manager.py",
      "line": 23,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "puzzle_editor.py",
      "line": 229,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "puzzle_editor.py",
      "line": 285,
      "col": 25,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "            \"has_image\": self.image is not None,"
    },
    {
      "file": "game_controller.py",
      "line": 45,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "        if image_path is None:"
    },
    {
      "file": "game_controller.py",
      "line": 183,
      "col": 19,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'p'。",
      "snippet": "            if all(p.solved for p in self.state['puzzle_pieces']):"
    },
    {
      "file": "game_controller.py",
      "line": 191,
      "col": 0,
      "severity": "LOW",
      "rule_id": "PY203",
      "message": "list.remove() 要求参数为列表中的元素，而非索引。",
      "snippet": "                    self.state['puzzle_pieces'].remove(piece)"
    },
    {
      "file": "game_logic.py",
      "line": 121,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 132,
      "col": 20,
      "severity": "HIGH",
      "rule_id": "PY006",
      "message": "使用 pickle 反序列化存在安全风险。",
      "snippet": "            state = pickle.load(f)"
    },
    {
      "file": "game_logic.py",
      "line": 135,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 206,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if user_id is not None:"
    },
    {
      "file": "game_logic.py",
      "line": 250,
      "col": 21,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'run_puzzle_game'。",
      "snippet": "            result = run_puzzle_game("
    },
    {
      "file": "game_logic.py",
      "line": 263,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "                if puzzle_id is None:"
    },
    {
      "file": "game_logic.py",
      "line": 267,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "                if image_path is not None: # 成功加载"
    },
    {
      "file": "game_logic.py",
      "line": 268,
      "col": 30,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'run_puzzle_game'。",
      "snippet": "                     result = run_puzzle_game(self.screen, puzzle_order, puzzle_order, puzzle_shape,"
    },
    {
      "file": "game_logic.py",
      "line": 287,
      "col": 25,
      "severity": "HIGH",
      "rule_id": "PY100",
      "message": "使用了未定义的名称 'run_puzzle_game'。",
      "snippet": "                result = run_puzzle_game("
    },
    {
      "file": "game_logic.py",
      "line": 317,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 352,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 396,
      "col": 7,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "    if image_path is None:"
    },
    {
      "file": "game_logic.py",
      "line": 417,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 462,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 479,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 665,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 800,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 747,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PY202",
      "message": "在生成器上使用 max()，若序列为空会抛出 ValueError，建议加默认值。",
      "snippet": "            max_x = max(area.rect.right for area in target_areas)"
    },
    {
      "file": "game_logic.py",
      "line": 748,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PY202",
      "message": "在生成器上使用 max()，若序列为空会抛出 ValueError，建议加默认值。",
      "snippet": "            max_y = max(area.rect.bottom for area in target_areas)"
    },
    {
      "file": "game_logic.py",
      "line": 144,
      "col": 0,
      "severity": "LOW",
      "rule_id": "PY203",
      "message": "list.remove() 要求参数为列表中的元素，而非索引。",
      "snippet": "            os.remove(save_path)"
    },
    {
      "file": "game_logic.py",
      "line": 715,
      "col": 0,
      "severity": "LOW",
      "rule_id": "PY203",
      "message": "list.remove() 要求参数为列表中的元素，而非索引。",
      "snippet": "                        puzzle_pieces.remove(piece)"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 175,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 218,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 239,
      "col": 16,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "                except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 247,
      "col": 16,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "                except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 269,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_ui.py",
      "line": 85,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "        if callbacks is None:"
    },
    {
      "file": "game_ui.py",
      "line": 110,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "image_editor.py",
      "line": 62,
      "col": 24,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "                        except Exception as e:"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 350,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "ranking_ui.py",
      "line": 85,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception:"
    },
    {
      "file": "ranking_ui.py",
      "line": 183,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "ranking_ui.py",
      "line": 208,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception:"
    },
    {
      "file": "ranking_ui.py",
      "line": 249,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "        except Exception:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 80,
      "col": 24,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "                        except Exception:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 97,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 110,
      "col": 35,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "            if self.is_hovered and self.hover_surf is not None and self.hover_surf is not self.image_surf:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 110,
      "col": 67,
      "severity": "MEDIUM",
      "rule_id": "AST002",
      "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
      "snippet": "            if self.is_hovered and self.hover_surf is not None and self.hover_surf is not self.image_surf:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 146,
      "col": 24,
      "severity": "HIGH",
      "rule_id": "PY006",
      "message": "使用 pickle 反序列化存在安全风险。",
      "snippet": "                state = pickle.load(f)"
    },
    {
      "file": "start_screen_ui.py",
      "line": 154,
      "col": 8,
      "severity": "LOW",
      "rule_id": "PY010",
      "message": "使用裸 except，建议捕获具体异常类型。",
      "snippet": "        except:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 162,
      "col": 0,
      "severity": "LOW",
      "rule_id": "PY203",
      "message": "list.remove() 要求参数为列表中的元素，而非索引。",
      "snippet": "            os.remove(save_path)"
    },
    {
      "file": "audio_manager.py",
      "line": 19,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "audio_manager.py",
      "line": 43,
      "col": 12,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "normalizer.py",
      "line": 31,
      "col": 4,
      "severity": "LOW",
      "rule_id": "PY011",
      "message": "过于宽泛的异常捕获：Exception。",
      "snippet": "    except Exception:"
    },
    {
      "file": "build.py",
      "line": 5,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-redefined-outer-name",
      "message": "Redefining name 'cmd' from outer scope (line 25)",
      "snippet": "def run(cmd):"
    },
    {
      "file": "build.py",
      "line": 15,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused import PyInstaller",
      "snippet": "    import PyInstaller"
    },
    {
      "file": "main.py",
      "line": 68,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 17 spaces, expected 16",
      "snippet": "                 break"
    },
    {
      "file": "main.py",
      "line": 77,
      "col": 13,
      "severity": "MEDIUM",
      "rule_id": "PL-fixme",
      "message": "TODO: 实现排行榜功能 - 这个TODO永远不会被完成",
      "snippet": "            # TODO: 实现排行榜功能 - 这个TODO永远不会被完成"
    },
    {
      "file": "main.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-reimported",
      "message": "Reimport 'sys' (imported line 3)",
      "snippet": "import sys  # 重复导入"
    },
    {
      "file": "main.py",
      "line": 8,
      "col": 17,
      "severity": "MEDIUM",
      "rule_id": "PL-unspecified-encoding",
      "message": "Using open without explicitly specifying an encoding",
      "snippet": "    sys.stdout = open('nul', 'w')"
    },
    {
      "file": "main.py",
      "line": 10,
      "col": 17,
      "severity": "MEDIUM",
      "rule_id": "PL-unspecified-encoding",
      "message": "Using open without explicitly specifying an encoding",
      "snippet": "    sys.stderr = open('nul', 'w')"
    },
    {
      "file": "main.py",
      "line": 12,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "main.py",
      "line": 13,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-reimported",
      "message": "Reimport 'sys' (imported line 3)",
      "snippet": "import sys  # 再次重复导入"
    },
    {
      "file": "main.py",
      "line": 21,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "main.py",
      "line": 21,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "main.py",
      "line": 24,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'ui.main_menu_ui'",
      "snippet": "from ui.main_menu_ui import show_main_menu"
    },
    {
      "file": "main.py",
      "line": 27,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.game_logic'",
      "snippet": "from game.game_logic import GameController"
    },
    {
      "file": "main.py",
      "line": 72,
      "col": 73,
      "severity": "HIGH",
      "rule_id": "PL-undefined-variable",
      "message": "Undefined variable 'current_time'",
      "snippet": "            print(f\"【提示】系统设置暂未实现, 当前时间: {current_time}\")  # current_time 未定义"
    },
    {
      "file": "main.py",
      "line": 95,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unreachable",
      "message": "Unreachable code",
      "snippet": "    print(\"程序结束\")  # 无法到达的代码"
    },
    {
      "file": "main.py",
      "line": 45,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'screem'",
      "snippet": "    screem = screen  # 拼写错误，但未使用"
    },
    {
      "file": "image_manager.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
      "snippet": "from config import CUSTOM_IMAGE_DIR"
    },
    {
      "file": "ranking_manager.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'RANKING_DIR' in module 'config'",
      "snippet": "from config import RANKING_DIR"
    },
    {
      "file": "ranking_manager.py",
      "line": 30,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception:"
    },
    {
      "file": "ranking_manager.py",
      "line": 53,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception:"
    },
    {
      "file": "ranking_manager.py",
      "line": 101,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception:"
    },
    {
      "file": "save_manager.py",
      "line": 13,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "save_manager.py",
      "line": 23,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "puzzle_editor.py",
      "line": 93,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 21 spaces, expected 20",
      "snippet": "                     self.ui.on_image_loaded()"
    },
    {
      "file": "puzzle_editor.py",
      "line": 153,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 25 spaces, expected 24",
      "snippet": "                         print(f\"【警告】输入值超出范围 ({min_val}-{max_val})\")"
    },
    {
      "file": "puzzle_editor.py",
      "line": 154,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 25 spaces, expected 24",
      "snippet": "                         count_window.destroy()"
    },
    {
      "file": "puzzle_editor.py",
      "line": 155,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 25 spaces, expected 24",
      "snippet": "                         root.destroy()"
    },
    {
      "file": "puzzle_editor.py",
      "line": 244,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 13 spaces, expected 12",
      "snippet": "             return self.image.copy() # UI 会根据 self.image.size 来调整显示"
    },
    {
      "file": "puzzle_editor.py",
      "line": 9,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image, ImageOps"
    },
    {
      "file": "puzzle_editor.py",
      "line": 143,
      "col": 31,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'event'",
      "snippet": "            def on_count_enter(event=None): # 支持回车确认"
    },
    {
      "file": "puzzle_editor.py",
      "line": 182,
      "col": 23,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'save_dir'",
      "snippet": "            puzzle_id, save_dir = result"
    },
    {
      "file": "puzzle_editor.py",
      "line": 229,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "puzzle_editor.py",
      "line": 239,
      "col": 32,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'width'",
      "snippet": "    def get_preview_image(self, width, height):"
    },
    {
      "file": "puzzle_editor.py",
      "line": 239,
      "col": 39,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'height'",
      "snippet": "    def get_preview_image(self, width, height):"
    },
    {
      "file": "puzzle_editor.py",
      "line": 9,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused ImageOps imported from PIL",
      "snippet": "from PIL import Image, ImageOps"
    },
    {
      "file": "game_controller.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "game_controller.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT"
    },
    {
      "file": "game_controller.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT"
    },
    {
      "file": "game_controller.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT"
    },
    {
      "file": "game_controller.py",
      "line": 7,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.puzzle_generator'",
      "snippet": "from game.puzzle_generator import split_image"
    },
    {
      "file": "game_controller.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.image_manager'",
      "snippet": "from data.image_manager import ImageManager"
    },
    {
      "file": "game_controller.py",
      "line": 9,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.save_manager'",
      "snippet": "from data.save_manager import save_game_state, load_game_state"
    },
    {
      "file": "game_controller.py",
      "line": 10,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.ranking_manager'",
      "snippet": "from data.ranking_manager import RankingManager"
    },
    {
      "file": "game_controller.py",
      "line": 11,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'ui.game_ui'",
      "snippet": "from ui.game_ui import GameUI"
    },
    {
      "file": "game_controller.py",
      "line": 43,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.generate_jigsaw_mask'",
      "snippet": "        from game.generate_jigsaw_mask import create_jigsaw_mask  # 导入但未使用"
    },
    {
      "file": "game_controller.py",
      "line": 43,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused create_jigsaw_mask imported from game.generate_jigsaw_mask",
      "snippet": "        from game.generate_jigsaw_mask import create_jigsaw_mask  # 导入但未使用"
    },
    {
      "file": "game_controller.py",
      "line": 117,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-using-constant-test",
      "message": "Using a conditional statement with a constant value",
      "snippet": "        if False:  # 永远不会执行的代码块"
    },
    {
      "file": "game_controller.py",
      "line": 129,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'piece_area_rect'",
      "snippet": "        piece_area_rect = pygame.Rect(0, SCREEN_HEIGHT - PIECE_AREA_HEIGHT, SCREEN_WIDTH, PIECE_AREA_HEIGHT)"
    },
    {
      "file": "game_controller.py",
      "line": 152,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.puzzle_piece'",
      "snippet": "        from game.puzzle_piece import PuzzlePiece"
    },
    {
      "file": "game_controller.py",
      "line": 158,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'dt'",
      "snippet": "            dt = self.clock.tick(60)"
    },
    {
      "file": "game_controller.py",
      "line": 231,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'project_root'",
      "snippet": "        project_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))"
    },
    {
      "file": "game_controller.py",
      "line": 245,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-redefined-outer-name",
      "message": "Redefining name 'os' from outer scope (line 3)",
      "snippet": "        import os"
    },
    {
      "file": "game_controller.py",
      "line": 245,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-reimported",
      "message": "Reimport 'os' (imported line 3)",
      "snippet": "        import os"
    },
    {
      "file": "game_logic.py",
      "line": 268,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 21 spaces, expected 20",
      "snippet": "                     result = run_puzzle_game(self.screen, puzzle_order, puzzle_order, puzzle_shape,"
    },
    {
      "file": "game_logic.py",
      "line": 270,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 21 spaces, expected 20",
      "snippet": "                     return result"
    },
    {
      "file": "game_logic.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "game_logic.py",
      "line": 11,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image"
    },
    {
      "file": "game_logic.py",
      "line": 14,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.normalizer'",
      "snippet": "from utils.normalizer import normalize_shape as norm_shape_for_rank, infer_image_id"
    },
    {
      "file": "game_logic.py",
      "line": 18,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'BACKGROUND_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'GRID_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'TEXT_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'PIECE_BG_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SAVE_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'RANKING_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_PATHS' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_SIZES' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 48,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.puzzle_piece'",
      "snippet": "from game.puzzle_piece import PuzzlePiece"
    },
    {
      "file": "game_logic.py",
      "line": 49,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'ui.start_screen_ui'",
      "snippet": "from ui.start_screen_ui import Button, show_save_slot_selection, show_start_screen # 导入UI组件"
    },
    {
      "file": "game_logic.py",
      "line": 50,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.ranking_manager'",
      "snippet": "from data.ranking_manager import RankingManager"
    },
    {
      "file": "game_logic.py",
      "line": 79,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-redefined-outer-name",
      "message": "Redefining name 'FONT_SIZES' from outer scope (line 26)",
      "snippet": "        from config import FONT_SIZES"
    },
    {
      "file": "game_logic.py",
      "line": 80,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-redefined-outer-name",
      "message": "Redefining name 'load_font' from outer scope (line 18)",
      "snippet": "        from game.game_logic import load_font"
    },
    {
      "file": "game_logic.py",
      "line": 79,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-reimported",
      "message": "Reimport 'FONT_SIZES' (imported line 26)",
      "snippet": "        from config import FONT_SIZES"
    },
    {
      "file": "game_logic.py",
      "line": 79,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_SIZES' in module 'config'",
      "snippet": "        from config import FONT_SIZES"
    },
    {
      "file": "game_logic.py",
      "line": 80,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.game_logic'",
      "snippet": "        from game.game_logic import load_font"
    },
    {
      "file": "game_logic.py",
      "line": 80,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-reimported",
      "message": "Reimport 'load_font' (imported line 18)",
      "snippet": "        from game.game_logic import load_font"
    },
    {
      "file": "game_logic.py",
      "line": 121,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 135,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 160,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'font_small'",
      "snippet": "    font_small = load_font('zhengwen.ttf', 18)"
    },
    {
      "file": "game_logic.py",
      "line": 242,
      "col": 20,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'load_saved'",
      "snippet": "        rows, cols, load_saved, action, shape_style = show_start_screen(self.screen, IMAGE_PATH)"
    },
    {
      "file": "game_logic.py",
      "line": 317,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 332,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-redefined-outer-name",
      "message": "Redefining name 'project_root' from outer scope (line 21)",
      "snippet": "    project_root = os.path.dirname(current_dir)      # 项目根目录"
    },
    {
      "file": "game_logic.py",
      "line": 352,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 417,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 427,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.generate_jigsaw_mask'",
      "snippet": "        from game.generate_jigsaw_mask import split_image_with_jigsaw_mask"
    },
    {
      "file": "game_logic.py",
      "line": 432,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.generate_triangle_mask'",
      "snippet": "        from game.generate_triangle_mask import split_image_with_triangle_mask"
    },
    {
      "file": "game_logic.py",
      "line": 440,
      "col": 8,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.generate_rectangle_mask'",
      "snippet": "        from game.generate_rectangle_mask import split_image_with_rectangle_mask"
    },
    {
      "file": "game_logic.py",
      "line": 462,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 479,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 665,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 701,
      "col": 34,
      "severity": "MEDIUM",
      "rule_id": "PL-f-string-without-interpolation",
      "message": "Using an f-string that does not have any interpolated variables",
      "snippet": "                            print(f\"保存失败\")"
    },
    {
      "file": "game_logic.py",
      "line": 800,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "game_logic.py",
      "line": 332,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'project_root'",
      "snippet": "    project_root = os.path.dirname(current_dir)      # 项目根目录"
    },
    {
      "file": "game_logic.py",
      "line": 342,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'assets_dir'",
      "snippet": "    assets_dir = os.path.normpath(os.path.join(current_dir, '..', 'assets'))"
    },
    {
      "file": "game_logic.py",
      "line": 539,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'solved_positions_from_save'",
      "snippet": "            solved_positions_from_save = saved_state.get('solved_positions', {})"
    },
    {
      "file": "game_logic.py",
      "line": 14,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused normalize_shape imported from utils.normalizer as norm_shape_for_rank",
      "snippet": "from utils.normalizer import normalize_shape as norm_shape_for_rank, infer_image_id"
    },
    {
      "file": "game_logic.py",
      "line": 14,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused infer_image_id imported from utils.normalizer",
      "snippet": "from utils.normalizer import normalize_shape as norm_shape_for_rank, infer_image_id"
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_PATHS imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "game_logic.py",
      "line": 26,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_SIZES imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image, ImageDraw, ImageOps"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame # 新增导入"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 52,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-attribute-defined-outside-init",
      "message": "Attribute 'pieces' defined outside __init__",
      "snippet": "        self.pieces = []"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 71,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-attribute-defined-outside-init",
      "message": "Attribute 'pieces' defined outside __init__",
      "snippet": "        self.pieces = []"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 175,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 218,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 239,
      "col": 23,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "                except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 247,
      "col": 23,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "                except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 269,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception as e:"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 317,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'top_type'",
      "snippet": "            top_type = get_edge_type(row, col, rows, cols, \"top\")"
    },
    {
      "file": "generate_jigsaw_mask.py",
      "line": 320,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'right_type'",
      "snippet": "            right_type = get_edge_type(row, col, rows, cols, \"right\")"
    },
    {
      "file": "generate_rectangle_mask.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "generate_rectangle_mask.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image"
    },
    {
      "file": "generate_triangle_mask.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "generate_triangle_mask.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image, ImageDraw, ImageFont"
    },
    {
      "file": "puzzle_generator.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "puzzle_piece.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "puzzle_piece.py",
      "line": 29,
      "col": 38,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'piece_area_rect'",
      "snippet": "    def stop_drag(self, target_areas, piece_area_rect):"
    },
    {
      "file": "puzzle_piece.py",
      "line": 56,
      "col": 28,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'in_piece_area'",
      "snippet": "    def draw(self, surface, in_piece_area=False):"
    },
    {
      "file": "puzzle_rotation.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "game_ui.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "game_ui.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "game_ui.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "game_ui.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "game_ui.py",
      "line": 37,
      "col": 23,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'screen'",
      "snippet": "    def __init__(self, screen):"
    },
    {
      "file": "game_ui.py",
      "line": 110,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "game_ui.py",
      "line": 79,
      "col": 91,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'moves'",
      "snippet": "    def draw_game_screen(self, screen, pieces, target_areas, original_image, time_elapsed, moves, callbacks=None):"
    },
    {
      "file": "game_ui.py",
      "line": 160,
      "col": 32,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'screen'",
      "snippet": "    def _position_buttons(self, screen):"
    },
    {
      "file": "game_ui.py",
      "line": 186,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-unreachable",
      "message": "Unreachable code",
      "snippet": "        if events:"
    },
    {
      "file": "game_ui.py",
      "line": 191,
      "col": 19,
      "severity": "HIGH",
      "rule_id": "PL-no-member",
      "message": "Instance of 'GameUI' has no 'font_large' member",
      "snippet": "        congrats = self.font_large.render(\"🎉 恭喜完成！\", True, (0, 0, 0))"
    },
    {
      "file": "game_ui.py",
      "line": 192,
      "col": 20,
      "severity": "HIGH",
      "rule_id": "PL-no-member",
      "message": "Instance of 'GameUI' has no 'font_medium' member",
      "snippet": "        time_text = self.font_medium.render(f\"用时: {total_time} 秒\", True, (0, 0, 0))"
    },
    {
      "file": "game_ui.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused SCREEN_WIDTH imported from config",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "game_ui.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused SCREEN_HEIGHT imported from config",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "image_editor.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "image_editor.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image, ImageTk"
    },
    {
      "file": "image_editor.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "image_editor.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.image_manager'",
      "snippet": "from data.image_manager import ImageManager"
    },
    {
      "file": "image_editor.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
      "snippet": "from config import CUSTOM_IMAGE_DIR"
    },
    {
      "file": "image_editor.py",
      "line": 62,
      "col": 31,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "                        except Exception as e:"
    },
    {
      "file": "image_editor.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused ImageTk imported from PIL",
      "snippet": "from PIL import Image, ImageTk"
    },
    {
      "file": "main_menu_ui.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "main_menu_ui.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "main_menu_ui.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "main_menu_ui.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_WIDTH, SCREEN_HEIGHT"
    },
    {
      "file": "main_menu_ui.py",
      "line": 48,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'title_rect'",
      "snippet": "    title_rect = title.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 4))"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'PIL'",
      "snippet": "from PIL import Image"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 9,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 11,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'game.generate_jigsaw_mask'",
      "snippet": "from game.generate_jigsaw_mask import draw_jigsaw_outline_on_image"
    },
    {
      "file": "puzzle_editor_ui.py",
      "line": 350,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "ranking_ui.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "ranking_ui.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "ranking_ui.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.ranking_manager'",
      "snippet": "from data.ranking_manager import RankingManager"
    },
    {
      "file": "ranking_ui.py",
      "line": 7,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'data.image_manager'",
      "snippet": "from data.image_manager import ImageManager"
    },
    {
      "file": "ranking_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'RANKING_DIR' in module 'config'",
      "snippet": "from config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR"
    },
    {
      "file": "ranking_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR"
    },
    {
      "file": "ranking_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR"
    },
    {
      "file": "ranking_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
      "snippet": "from config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR"
    },
    {
      "file": "ranking_ui.py",
      "line": 85,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception:"
    },
    {
      "file": "ranking_ui.py",
      "line": 183,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception as e:"
    },
    {
      "file": "ranking_ui.py",
      "line": 181,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-protected-access",
      "message": "Access to a protected member _data of a client class",
      "snippet": "            rm._data = [r for r in rm._data if r.get(\"image\") != current_image]  # 直接操作内部列表"
    },
    {
      "file": "ranking_ui.py",
      "line": 181,
      "col": 35,
      "severity": "MEDIUM",
      "rule_id": "PL-protected-access",
      "message": "Access to a protected member _data of a client class",
      "snippet": "            rm._data = [r for r in rm._data if r.get(\"image\") != current_image]  # 直接操作内部列表"
    },
    {
      "file": "ranking_ui.py",
      "line": 182,
      "col": 12,
      "severity": "MEDIUM",
      "rule_id": "PL-protected-access",
      "message": "Access to a protected member _save of a client class",
      "snippet": "            rm._save()"
    },
    {
      "file": "ranking_ui.py",
      "line": 208,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception:"
    },
    {
      "file": "ranking_ui.py",
      "line": 249,
      "col": 15,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "        except Exception:"
    },
    {
      "file": "ranking_ui.py",
      "line": 96,
      "col": 25,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'audio_manager'",
      "snippet": "def show_ranking(screen, audio_manager=None):"
    },
    {
      "file": "ranking_ui.py",
      "line": 101,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'image_manager'",
      "snippet": "    image_manager = ImageManager()  # 先留着，便于后续扩展"
    },
    {
      "file": "ranking_ui.py",
      "line": 143,
      "col": 4,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-variable",
      "message": "Unused variable 'assets_dir'",
      "snippet": "    assets_dir = os.path.normpath(os.path.join(cur_dir, '..', 'assets'))"
    },
    {
      "file": "ranking_ui.py",
      "line": 8,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused RANKING_DIR imported from config",
      "snippet": "from config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR"
    },
    {
      "file": "settings_ui.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "settings_ui.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import SCREEN_HEIGHT,SCREEN_WIDTH"
    },
    {
      "file": "settings_ui.py",
      "line": 5,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import SCREEN_HEIGHT,SCREEN_WIDTH"
    },
    {
      "file": "settings_ui.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font  # ✅ 导入字体加载器"
    },
    {
      "file": "settings_ui.py",
      "line": 5,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused SCREEN_HEIGHT imported from config",
      "snippet": "from config import SCREEN_HEIGHT,SCREEN_WIDTH"
    },
    {
      "file": "start_screen_ui.py",
      "line": 220,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 13 spaces, expected 12",
      "snippet": "             del_btn = Button(delete_button_x, y_start + i * y_spacing, delete_button_width, 50, \"删除\", font_small)"
    },
    {
      "file": "start_screen_ui.py",
      "line": 221,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 13 spaces, expected 12",
      "snippet": "             buttons.append((del_btn, f\"del_{i}\")) # 使用特殊标识符"
    },
    {
      "file": "start_screen_ui.py",
      "line": 222,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-bad-indentation",
      "message": "Bad indentation. Found 13 spaces, expected 12",
      "snippet": "             delete_buttons[i] = del_btn # 也可以用字典映射"
    },
    {
      "file": "start_screen_ui.py",
      "line": 3,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "start_screen_ui.py",
      "line": 8,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'utils.font_loader'",
      "snippet": "from utils.font_loader import load_font"
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_WIDTH' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SCREEN_HEIGHT' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'BACKGROUND_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'GRID_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'TEXT_COLOR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'SAVE_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'RANKING_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_PATHS' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_SIZES' in module 'config'",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 97,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 80,
      "col": 31,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "                        except Exception:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 154,
      "col": 8,
      "severity": "MEDIUM",
      "rule_id": "PL-bare-except",
      "message": "No exception type(s) specified",
      "snippet": "        except:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 267,
      "col": 30,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-argument",
      "message": "Unused argument 'audio_manager'",
      "snippet": "def show_start_screen(screen, audio_manager=None):"
    },
    {
      "file": "start_screen_ui.py",
      "line": 6,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused import time",
      "snippet": "import time"
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused PIECE_AREA_HEIGHT imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused BACKGROUND_COLOR imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused GRID_COLOR imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_PATHS imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "start_screen_ui.py",
      "line": 16,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_SIZES imported from config",
      "snippet": "from config import ("
    },
    {
      "file": "audio_manager.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "audio_manager.py",
      "line": 19,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "audio_manager.py",
      "line": 43,
      "col": 19,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "            except Exception as e:"
    },
    {
      "file": "font_loader.py",
      "line": 2,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-import-error",
      "message": "Unable to import 'pygame'",
      "snippet": "import pygame"
    },
    {
      "file": "font_loader.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_PATHS' in module 'config'",
      "snippet": "from config import FONT_PATHS, FONT_SIZES"
    },
    {
      "file": "font_loader.py",
      "line": 4,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "PL-no-name-in-module",
      "message": "No name 'FONT_SIZES' in module 'config'",
      "snippet": "from config import FONT_PATHS, FONT_SIZES"
    },
    {
      "file": "font_loader.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_PATHS imported from config",
      "snippet": "from config import FONT_PATHS, FONT_SIZES"
    },
    {
      "file": "font_loader.py",
      "line": 4,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "PL-unused-import",
      "message": "Unused FONT_SIZES imported from config",
      "snippet": "from config import FONT_PATHS, FONT_SIZES"
    },
    {
      "file": "normalizer.py",
      "line": 31,
      "col": 11,
      "severity": "MEDIUM",
      "rule_id": "PL-broad-exception-caught",
      "message": "Catching too general exception Exception",
      "snippet": "    except Exception:"
    },
    {
      "file": "build.py",
      "line": 3,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B404",
      "message": "Consider possible security implications associated with the subprocess module.",
      "snippet": "import subprocess"
    },
    {
      "file": "build.py",
      "line": 6,
      "col": 0,
      "severity": "HIGH",
      "rule_id": "B605",
      "message": "Starting a process with a shell, possible injection detected, security issue.",
      "snippet": "    result = os.system(cmd)"
    },
    {
      "file": "build.py",
      "line": 22,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B605",
      "message": "Starting a process with a shell: Seems safe, but may be changed in the future, consider rewriting without shell",
      "snippet": "os.system(\"rmdir /s /q dist build *.spec >nul 2>&1\")"
    },
    {
      "file": "build.py",
      "line": 22,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B607",
      "message": "Starting a process with a partial executable path",
      "snippet": "os.system(\"rmdir /s /q dist build *.spec >nul 2>&1\")"
    },
    {
      "file": "build.py",
      "line": 39,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B603",
      "message": "subprocess call - check for execution of untrusted input.",
      "snippet": "subprocess.call(cmd)"
    },
    {
      "file": "game_logic.py",
      "line": 8,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B403",
      "message": "Consider possible security implications associated with pickle module.",
      "snippet": "import pickle"
    },
    {
      "file": "game_logic.py",
      "line": 132,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "B301",
      "message": "Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.",
      "snippet": "            state = pickle.load(f)"
    },
    {
      "file": "start_screen_ui.py",
      "line": 7,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B403",
      "message": "Consider possible security implications associated with pickle module.",
      "snippet": "import pickle"
    },
    {
      "file": "start_screen_ui.py",
      "line": 80,
      "col": 0,
      "severity": "LOW",
      "rule_id": "B110",
      "message": "Try, Except, Pass detected.",
      "snippet": "                        except Exception:"
    },
    {
      "file": "start_screen_ui.py",
      "line": 146,
      "col": 0,
      "severity": "MEDIUM",
      "rule_id": "B301",
      "message": "Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.",
      "snippet": "                state = pickle.load(f)"
    }
  ],
  "external_tools_details": {
    "ruff": {
      "count": 0,
      "findings": [],
      "stderr": "error: unexpected argument '--format' found\n\n  tip: to pass '--format' as a value, use '-- --format'\n\nUsage: ruff.exe check --select <RULE_CODE> [FILES]...\n\nFor more information, try '--help'.\n"
    },
    "pylint": {
      "count": 212,
      "findings": [
        {
          "type": "warning",
          "module": "scan_bx3e08zg.build",
          "obj": "run",
          "line": 5,
          "column": 8,
          "endLine": 5,
          "endColumn": 11,
          "path": "build.py",
          "symbol": "redefined-outer-name",
          "message": "Redefining name 'cmd' from outer scope (line 25)",
          "message-id": "W0621"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.build",
          "obj": "",
          "line": 15,
          "column": 4,
          "endLine": 15,
          "endColumn": 22,
          "path": "build.py",
          "symbol": "unused-import",
          "message": "Unused import PyInstaller",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 68,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "main.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 17 spaces, expected 16",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 77,
          "column": 13,
          "endLine": null,
          "endColumn": null,
          "path": "main.py",
          "symbol": "fixme",
          "message": "TODO: 实现排行榜功能 - 这个TODO永远不会被完成",
          "message-id": "W0511"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 10,
          "path": "main.py",
          "symbol": "reimported",
          "message": "Reimport 'sys' (imported line 3)",
          "message-id": "W0404"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 8,
          "column": 17,
          "endLine": 8,
          "endColumn": 33,
          "path": "main.py",
          "symbol": "unspecified-encoding",
          "message": "Using open without explicitly specifying an encoding",
          "message-id": "W1514"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 10,
          "column": 17,
          "endLine": 10,
          "endColumn": 33,
          "path": "main.py",
          "symbol": "unspecified-encoding",
          "message": "Using open without explicitly specifying an encoding",
          "message-id": "W1514"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 12,
          "column": 0,
          "endLine": 12,
          "endColumn": 13,
          "path": "main.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 13,
          "column": 0,
          "endLine": 13,
          "endColumn": 10,
          "path": "main.py",
          "symbol": "reimported",
          "message": "Reimport 'sys' (imported line 3)",
          "message-id": "W0404"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 21,
          "column": 0,
          "endLine": 21,
          "endColumn": 46,
          "path": "main.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 21,
          "column": 0,
          "endLine": 21,
          "endColumn": 46,
          "path": "main.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 24,
          "column": 0,
          "endLine": 24,
          "endColumn": 42,
          "path": "main.py",
          "symbol": "import-error",
          "message": "Unable to import 'ui.main_menu_ui'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "",
          "line": 27,
          "column": 0,
          "endLine": 27,
          "endColumn": 42,
          "path": "main.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.game_logic'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main",
          "obj": "main",
          "line": 72,
          "column": 73,
          "endLine": 72,
          "endColumn": 85,
          "path": "main.py",
          "symbol": "undefined-variable",
          "message": "Undefined variable 'current_time'",
          "message-id": "E0602"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "main",
          "line": 95,
          "column": 4,
          "endLine": 95,
          "endColumn": 25,
          "path": "main.py",
          "symbol": "unreachable",
          "message": "Unreachable code",
          "message-id": "W0101"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main",
          "obj": "main",
          "line": 45,
          "column": 4,
          "endLine": 45,
          "endColumn": 10,
          "path": "main.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'screem'",
          "message-id": "W0612"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_manager",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 35,
          "path": "image_manager.py",
          "symbol": "no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_manager",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 30,
          "path": "ranking_manager.py",
          "symbol": "no-name-in-module",
          "message": "No name 'RANKING_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_manager",
          "obj": "_to_int_seconds",
          "line": 30,
          "column": 11,
          "endLine": 30,
          "endColumn": 20,
          "path": "ranking_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_manager",
          "obj": "_normalize_record",
          "line": 53,
          "column": 11,
          "endLine": 53,
          "endColumn": 20,
          "path": "ranking_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_manager",
          "obj": "RankingManager._load",
          "line": 101,
          "column": 19,
          "endLine": 101,
          "endColumn": 28,
          "path": "ranking_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.save_manager",
          "obj": "save_game_state",
          "line": 13,
          "column": 11,
          "endLine": 13,
          "endColumn": 20,
          "path": "save_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.save_manager",
          "obj": "load_game_state",
          "line": 23,
          "column": 11,
          "endLine": 23,
          "endColumn": 20,
          "path": "save_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 93,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "puzzle_editor.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 21 spaces, expected 20",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 153,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "puzzle_editor.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 25 spaces, expected 24",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 154,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "puzzle_editor.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 25 spaces, expected 24",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 155,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "puzzle_editor.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 25 spaces, expected 24",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 244,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "puzzle_editor.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 13 spaces, expected 12",
          "message-id": "W0311"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 9,
          "column": 0,
          "endLine": 9,
          "endColumn": 31,
          "path": "puzzle_editor.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "PuzzleEditor.setup_puzzle_ui.on_shape_selected.on_count_enter",
          "line": 143,
          "column": 31,
          "endLine": 143,
          "endColumn": 36,
          "path": "puzzle_editor.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'event'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "PuzzleEditor.save_settings_ui",
          "line": 182,
          "column": 23,
          "endLine": 182,
          "endColumn": 31,
          "path": "puzzle_editor.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'save_dir'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "PuzzleEditor._load_image_internal",
          "line": 229,
          "column": 15,
          "endLine": 229,
          "endColumn": 24,
          "path": "puzzle_editor.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "PuzzleEditor.get_preview_image",
          "line": 239,
          "column": 32,
          "endLine": 239,
          "endColumn": 37,
          "path": "puzzle_editor.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'width'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "PuzzleEditor.get_preview_image",
          "line": 239,
          "column": 39,
          "endLine": 239,
          "endColumn": 45,
          "path": "puzzle_editor.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'height'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor",
          "obj": "",
          "line": 9,
          "column": 0,
          "endLine": 9,
          "endColumn": 31,
          "path": "puzzle_editor.py",
          "symbol": "unused-import",
          "message": "Unused ImageOps imported from PIL",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 65,
          "path": "game_controller.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 65,
          "path": "game_controller.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 65,
          "path": "game_controller.py",
          "symbol": "no-name-in-module",
          "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 7,
          "column": 0,
          "endLine": 7,
          "endColumn": 45,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.puzzle_generator'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 43,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.image_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 9,
          "column": 0,
          "endLine": 9,
          "endColumn": 62,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.save_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 10,
          "column": 0,
          "endLine": 10,
          "endColumn": 47,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.ranking_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "",
          "line": 11,
          "column": 0,
          "endLine": 11,
          "endColumn": 29,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'ui.game_ui'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.start_new_game",
          "line": 43,
          "column": 8,
          "endLine": 43,
          "endColumn": 64,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.generate_jigsaw_mask'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.start_new_game",
          "line": 43,
          "column": 8,
          "endLine": 43,
          "endColumn": 64,
          "path": "game_controller.py",
          "symbol": "unused-import",
          "message": "Unused create_jigsaw_mask imported from game.generate_jigsaw_mask",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.setup_puzzle",
          "line": 117,
          "column": 11,
          "endLine": 117,
          "endColumn": 16,
          "path": "game_controller.py",
          "symbol": "using-constant-test",
          "message": "Using a conditional statement with a constant value",
          "message-id": "W0125"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.setup_puzzle",
          "line": 129,
          "column": 8,
          "endLine": 129,
          "endColumn": 23,
          "path": "game_controller.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'piece_area_rect'",
          "message-id": "W0612"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.create_piece",
          "line": 152,
          "column": 8,
          "endLine": 152,
          "endColumn": 49,
          "path": "game_controller.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.puzzle_piece'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.run_game_loop",
          "line": 158,
          "column": 12,
          "endLine": 158,
          "endColumn": 14,
          "path": "game_controller.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'dt'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.save_on_exit",
          "line": 231,
          "column": 8,
          "endLine": 231,
          "endColumn": 20,
          "path": "game_controller.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'project_root'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.clear_save_file",
          "line": 245,
          "column": 8,
          "endLine": 245,
          "endColumn": 17,
          "path": "game_controller.py",
          "symbol": "redefined-outer-name",
          "message": "Redefining name 'os' from outer scope (line 3)",
          "message-id": "W0621"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_controller",
          "obj": "GameController.clear_save_file",
          "line": 245,
          "column": 8,
          "endLine": 245,
          "endColumn": 17,
          "path": "game_controller.py",
          "symbol": "reimported",
          "message": "Reimport 'os' (imported line 3)",
          "message-id": "W0404"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 268,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "game_logic.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 21 spaces, expected 20",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 270,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "game_logic.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 21 spaces, expected 20",
          "message-id": "W0311"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 13,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 11,
          "column": 0,
          "endLine": 11,
          "endColumn": 21,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 14,
          "column": 0,
          "endLine": 14,
          "endColumn": 83,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.normalizer'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 18,
          "column": 0,
          "endLine": 18,
          "endColumn": 39,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'BACKGROUND_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'GRID_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'TEXT_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'PIECE_BG_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SAVE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'RANKING_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_PATHS' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_SIZES' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 48,
          "column": 0,
          "endLine": 48,
          "endColumn": 41,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.puzzle_piece'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 49,
          "column": 0,
          "endLine": 49,
          "endColumn": 82,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'ui.start_screen_ui'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 50,
          "column": 0,
          "endLine": 50,
          "endColumn": 47,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.ranking_manager'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 79,
          "column": 8,
          "endLine": 79,
          "endColumn": 37,
          "path": "game_logic.py",
          "symbol": "redefined-outer-name",
          "message": "Redefining name 'FONT_SIZES' from outer scope (line 26)",
          "message-id": "W0621"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 80,
          "column": 8,
          "endLine": 80,
          "endColumn": 45,
          "path": "game_logic.py",
          "symbol": "redefined-outer-name",
          "message": "Redefining name 'load_font' from outer scope (line 18)",
          "message-id": "W0621"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 79,
          "column": 8,
          "endLine": 79,
          "endColumn": 37,
          "path": "game_logic.py",
          "symbol": "reimported",
          "message": "Reimport 'FONT_SIZES' (imported line 26)",
          "message-id": "W0404"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 79,
          "column": 8,
          "endLine": 79,
          "endColumn": 37,
          "path": "game_logic.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_SIZES' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 80,
          "column": 8,
          "endLine": 80,
          "endColumn": 45,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.game_logic'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "TargetArea.draw",
          "line": 80,
          "column": 8,
          "endLine": 80,
          "endColumn": 45,
          "path": "game_logic.py",
          "symbol": "reimported",
          "message": "Reimport 'load_font' (imported line 18)",
          "message-id": "W0404"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "save_game_state",
          "line": 121,
          "column": 11,
          "endLine": 121,
          "endColumn": 20,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "load_game_state",
          "line": 135,
          "column": 11,
          "endLine": 135,
          "endColumn": 20,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "show_completion_screen",
          "line": 160,
          "column": 4,
          "endLine": 160,
          "endColumn": 14,
          "path": "game_logic.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'font_small'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "GameController.start_new_game",
          "line": 242,
          "column": 20,
          "endLine": 242,
          "endColumn": 30,
          "path": "game_logic.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'load_saved'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "GameController.load_settings",
          "line": 317,
          "column": 15,
          "endLine": 317,
          "endColumn": 24,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 332,
          "column": 4,
          "endLine": 332,
          "endColumn": 16,
          "path": "game_logic.py",
          "symbol": "redefined-outer-name",
          "message": "Redefining name 'project_root' from outer scope (line 21)",
          "message-id": "W0621"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 352,
          "column": 15,
          "endLine": 352,
          "endColumn": 24,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 417,
          "column": 11,
          "endLine": 417,
          "endColumn": 20,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 427,
          "column": 8,
          "endLine": 427,
          "endColumn": 74,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.generate_jigsaw_mask'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 432,
          "column": 8,
          "endLine": 432,
          "endColumn": 78,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.generate_triangle_mask'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 440,
          "column": 8,
          "endLine": 440,
          "endColumn": 80,
          "path": "game_logic.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.generate_rectangle_mask'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 462,
          "column": 11,
          "endLine": 462,
          "endColumn": 20,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 479,
          "column": 11,
          "endLine": 479,
          "endColumn": 20,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game.show_full_image",
          "line": 665,
          "column": 15,
          "endLine": 665,
          "endColumn": 24,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 701,
          "column": 34,
          "endLine": 701,
          "endColumn": 49,
          "path": "game_logic.py",
          "symbol": "f-string-without-interpolation",
          "message": "Using an f-string that does not have any interpolated variables",
          "message-id": "W1309"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 800,
          "column": 19,
          "endLine": 800,
          "endColumn": 28,
          "path": "game_logic.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 332,
          "column": 4,
          "endLine": 332,
          "endColumn": 16,
          "path": "game_logic.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'project_root'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 342,
          "column": 4,
          "endLine": 342,
          "endColumn": 14,
          "path": "game_logic.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'assets_dir'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "run_puzzle_game",
          "line": 539,
          "column": 12,
          "endLine": 539,
          "endColumn": 38,
          "path": "game_logic.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'solved_positions_from_save'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 14,
          "column": 0,
          "endLine": 14,
          "endColumn": 83,
          "path": "game_logic.py",
          "symbol": "unused-import",
          "message": "Unused normalize_shape imported from utils.normalizer as norm_shape_for_rank",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 14,
          "column": 0,
          "endLine": 14,
          "endColumn": 83,
          "path": "game_logic.py",
          "symbol": "unused-import",
          "message": "Unused infer_image_id imported from utils.normalizer",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "unused-import",
          "message": "Unused FONT_PATHS imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_logic",
          "obj": "",
          "line": 26,
          "column": 0,
          "endLine": 31,
          "endColumn": 1,
          "path": "game_logic.py",
          "symbol": "unused-import",
          "message": "Unused FONT_SIZES imported from config",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 42,
          "path": "generate_jigsaw_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 13,
          "path": "generate_jigsaw_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "PuzzlePiece._create_square_puzzle_pieces",
          "line": 52,
          "column": 8,
          "endLine": 52,
          "endColumn": 19,
          "path": "generate_jigsaw_mask.py",
          "symbol": "attribute-defined-outside-init",
          "message": "Attribute 'pieces' defined outside __init__",
          "message-id": "W0201"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "PuzzlePiece._create_triangle_puzzle_pieces",
          "line": 71,
          "column": 8,
          "endLine": 71,
          "endColumn": 19,
          "path": "generate_jigsaw_mask.py",
          "symbol": "attribute-defined-outside-init",
          "message": "Attribute 'pieces' defined outside __init__",
          "message-id": "W0201"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "split_image_with_jigsaw_mask",
          "line": 175,
          "column": 11,
          "endLine": 175,
          "endColumn": 20,
          "path": "generate_jigsaw_mask.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "split_image_with_jigsaw_mask",
          "line": 218,
          "column": 19,
          "endLine": 218,
          "endColumn": 28,
          "path": "generate_jigsaw_mask.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "split_image_with_jigsaw_mask",
          "line": 239,
          "column": 23,
          "endLine": 239,
          "endColumn": 32,
          "path": "generate_jigsaw_mask.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "split_image_with_jigsaw_mask",
          "line": 247,
          "column": 23,
          "endLine": 247,
          "endColumn": 32,
          "path": "generate_jigsaw_mask.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "draw_jigsaw_outline_on_image",
          "line": 269,
          "column": 11,
          "endLine": 269,
          "endColumn": 20,
          "path": "generate_jigsaw_mask.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "draw_jigsaw_outline_on_image",
          "line": 317,
          "column": 12,
          "endLine": 317,
          "endColumn": 20,
          "path": "generate_jigsaw_mask.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'top_type'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.generate_jigsaw_mask",
          "obj": "draw_jigsaw_outline_on_image",
          "line": 320,
          "column": 12,
          "endLine": 320,
          "endColumn": 22,
          "path": "generate_jigsaw_mask.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'right_type'",
          "message-id": "W0612"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_rectangle_mask",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "generate_rectangle_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_rectangle_mask",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 21,
          "path": "generate_rectangle_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_triangle_mask",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 13,
          "path": "generate_triangle_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.generate_triangle_mask",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 43,
          "path": "generate_triangle_mask.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_generator",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "puzzle_generator.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_piece",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "puzzle_piece.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_piece",
          "obj": "PuzzlePiece.stop_drag",
          "line": 29,
          "column": 38,
          "endLine": 29,
          "endColumn": 53,
          "path": "puzzle_piece.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'piece_area_rect'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_piece",
          "obj": "PuzzlePiece.draw",
          "line": 56,
          "column": 28,
          "endLine": 56,
          "endColumn": 41,
          "path": "puzzle_piece.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'in_piece_area'",
          "message-id": "W0613"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_rotation",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 13,
          "path": "puzzle_rotation.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "game_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 39,
          "path": "game_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 46,
          "path": "game_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 46,
          "path": "game_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.__init__",
          "line": 37,
          "column": 23,
          "endLine": 37,
          "endColumn": 29,
          "path": "game_ui.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'screen'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.draw_game_screen",
          "line": 110,
          "column": 19,
          "endLine": 110,
          "endColumn": 28,
          "path": "game_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.draw_game_screen",
          "line": 79,
          "column": 91,
          "endLine": 79,
          "endColumn": 96,
          "path": "game_ui.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'moves'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI._position_buttons",
          "line": 160,
          "column": 32,
          "endLine": 160,
          "endColumn": 38,
          "path": "game_ui.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'screen'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.handle_button_clicks",
          "line": 186,
          "column": 8,
          "endLine": 187,
          "endColumn": 41,
          "path": "game_ui.py",
          "symbol": "unreachable",
          "message": "Unreachable code",
          "message-id": "W0101"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.show_completion_screen",
          "line": 191,
          "column": 19,
          "endLine": 191,
          "endColumn": 34,
          "path": "game_ui.py",
          "symbol": "no-member",
          "message": "Instance of 'GameUI' has no 'font_large' member",
          "message-id": "E1101"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "GameUI.show_completion_screen",
          "line": 192,
          "column": 20,
          "endLine": 192,
          "endColumn": 36,
          "path": "game_ui.py",
          "symbol": "no-member",
          "message": "Instance of 'GameUI' has no 'font_medium' member",
          "message-id": "E1101"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 46,
          "path": "game_ui.py",
          "symbol": "unused-import",
          "message": "Unused SCREEN_WIDTH imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.game_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 46,
          "path": "game_ui.py",
          "symbol": "unused-import",
          "message": "Unused SCREEN_HEIGHT imported from config",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "image_editor.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 30,
          "path": "image_editor.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 39,
          "path": "image_editor.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 43,
          "path": "image_editor.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.image_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 35,
          "path": "image_editor.py",
          "symbol": "no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "show_image_editor",
          "line": 62,
          "column": 31,
          "endLine": 62,
          "endColumn": 40,
          "path": "image_editor.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.image_editor",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 30,
          "path": "image_editor.py",
          "symbol": "unused-import",
          "message": "Unused ImageTk imported from PIL",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main_menu_ui",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 13,
          "path": "main_menu_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main_menu_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 39,
          "path": "main_menu_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main_menu_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 46,
          "path": "main_menu_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.main_menu_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 46,
          "path": "main_menu_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.main_menu_ui",
          "obj": "show_main_menu",
          "line": 48,
          "column": 4,
          "endLine": 48,
          "endColumn": 14,
          "path": "main_menu_ui.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'title_rect'",
          "message-id": "W0612"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_editor_ui",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 13,
          "path": "puzzle_editor_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_editor_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 21,
          "path": "puzzle_editor_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'PIL'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_editor_ui",
          "obj": "",
          "line": 9,
          "column": 0,
          "endLine": 9,
          "endColumn": 39,
          "path": "puzzle_editor_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.puzzle_editor_ui",
          "obj": "",
          "line": 11,
          "column": 0,
          "endLine": 11,
          "endColumn": 66,
          "path": "puzzle_editor_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'game.generate_jigsaw_mask'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.puzzle_editor_ui",
          "obj": "PuzzleEditorUI.draw_image_to_surface",
          "line": 350,
          "column": 19,
          "endLine": 350,
          "endColumn": 28,
          "path": "puzzle_editor_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 13,
          "path": "ranking_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 39,
          "path": "ranking_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 47,
          "path": "ranking_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.ranking_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 7,
          "column": 0,
          "endLine": 7,
          "endColumn": 43,
          "path": "ranking_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'data.image_manager'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 77,
          "path": "ranking_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'RANKING_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 77,
          "path": "ranking_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 77,
          "path": "ranking_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 77,
          "path": "ranking_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "_is_custom_image",
          "line": 85,
          "column": 15,
          "endLine": 85,
          "endColumn": 24,
          "path": "ranking_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking.delete_current_image_records",
          "line": 183,
          "column": 15,
          "endLine": 183,
          "endColumn": 24,
          "path": "ranking_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking.delete_current_image_records",
          "line": 181,
          "column": 12,
          "endLine": 181,
          "endColumn": 20,
          "path": "ranking_ui.py",
          "symbol": "protected-access",
          "message": "Access to a protected member _data of a client class",
          "message-id": "W0212"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking.delete_current_image_records",
          "line": 181,
          "column": 35,
          "endLine": 181,
          "endColumn": 43,
          "path": "ranking_ui.py",
          "symbol": "protected-access",
          "message": "Access to a protected member _data of a client class",
          "message-id": "W0212"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking.delete_current_image_records",
          "line": 182,
          "column": 12,
          "endLine": 182,
          "endColumn": 20,
          "path": "ranking_ui.py",
          "symbol": "protected-access",
          "message": "Access to a protected member _save of a client class",
          "message-id": "W0212"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking.delete_current_image_records",
          "line": 208,
          "column": 19,
          "endLine": 208,
          "endColumn": 28,
          "path": "ranking_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking",
          "line": 249,
          "column": 15,
          "endLine": 249,
          "endColumn": 24,
          "path": "ranking_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking",
          "line": 96,
          "column": 25,
          "endLine": 96,
          "endColumn": 38,
          "path": "ranking_ui.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'audio_manager'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking",
          "line": 101,
          "column": 4,
          "endLine": 101,
          "endColumn": 17,
          "path": "ranking_ui.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'image_manager'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "show_ranking",
          "line": 143,
          "column": 4,
          "endLine": 143,
          "endColumn": 14,
          "path": "ranking_ui.py",
          "symbol": "unused-variable",
          "message": "Unused variable 'assets_dir'",
          "message-id": "W0612"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.ranking_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 77,
          "path": "ranking_ui.py",
          "symbol": "unused-import",
          "message": "Unused RANKING_DIR imported from config",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.settings_ui",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 13,
          "path": "settings_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.settings_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 45,
          "path": "settings_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.settings_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 45,
          "path": "settings_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.settings_ui",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 39,
          "path": "settings_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.settings_ui",
          "obj": "",
          "line": 5,
          "column": 0,
          "endLine": 5,
          "endColumn": 45,
          "path": "settings_ui.py",
          "symbol": "unused-import",
          "message": "Unused SCREEN_HEIGHT imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 220,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "start_screen_ui.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 13 spaces, expected 12",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 221,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "start_screen_ui.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 13 spaces, expected 12",
          "message-id": "W0311"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 222,
          "column": 0,
          "endLine": null,
          "endColumn": null,
          "path": "start_screen_ui.py",
          "symbol": "bad-indentation",
          "message": "Bad indentation. Found 13 spaces, expected 12",
          "message-id": "W0311"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 3,
          "column": 0,
          "endLine": 3,
          "endColumn": 13,
          "path": "start_screen_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 8,
          "column": 0,
          "endLine": 8,
          "endColumn": 39,
          "path": "start_screen_ui.py",
          "symbol": "import-error",
          "message": "Unable to import 'utils.font_loader'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'PIECE_AREA_HEIGHT' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'BACKGROUND_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'GRID_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'TEXT_COLOR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'SAVE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'RANKING_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_PATHS' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_SIZES' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "Button.__init__",
          "line": 97,
          "column": 19,
          "endLine": 97,
          "endColumn": 28,
          "path": "start_screen_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "Button.__init__",
          "line": 80,
          "column": 31,
          "endLine": 80,
          "endColumn": 40,
          "path": "start_screen_ui.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "get_save_info",
          "line": 154,
          "column": 8,
          "endLine": 155,
          "endColumn": 36,
          "path": "start_screen_ui.py",
          "symbol": "bare-except",
          "message": "No exception type(s) specified",
          "message-id": "W0702"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "show_start_screen",
          "line": 267,
          "column": 30,
          "endLine": 267,
          "endColumn": 43,
          "path": "start_screen_ui.py",
          "symbol": "unused-argument",
          "message": "Unused argument 'audio_manager'",
          "message-id": "W0613"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 6,
          "column": 0,
          "endLine": 6,
          "endColumn": 11,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused import time",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused PIECE_AREA_HEIGHT imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused BACKGROUND_COLOR imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused GRID_COLOR imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused FONT_PATHS imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.start_screen_ui",
          "obj": "",
          "line": 16,
          "column": 0,
          "endLine": 21,
          "endColumn": 1,
          "path": "start_screen_ui.py",
          "symbol": "unused-import",
          "message": "Unused FONT_SIZES imported from config",
          "message-id": "W0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.audio_manager",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "audio_manager.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.audio_manager",
          "obj": "AudioManager.load_background_music",
          "line": 19,
          "column": 19,
          "endLine": 19,
          "endColumn": 28,
          "path": "audio_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.audio_manager",
          "obj": "AudioManager.play_correct_sound",
          "line": 43,
          "column": 19,
          "endLine": 43,
          "endColumn": 28,
          "path": "audio_manager.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.font_loader",
          "obj": "",
          "line": 2,
          "column": 0,
          "endLine": 2,
          "endColumn": 13,
          "path": "font_loader.py",
          "symbol": "import-error",
          "message": "Unable to import 'pygame'",
          "message-id": "E0401"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.font_loader",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 41,
          "path": "font_loader.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_PATHS' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "error",
          "module": "scan_bx3e08zg.font_loader",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 41,
          "path": "font_loader.py",
          "symbol": "no-name-in-module",
          "message": "No name 'FONT_SIZES' in module 'config'",
          "message-id": "E0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.font_loader",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 41,
          "path": "font_loader.py",
          "symbol": "unused-import",
          "message": "Unused FONT_PATHS imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.font_loader",
          "obj": "",
          "line": 4,
          "column": 0,
          "endLine": 4,
          "endColumn": 41,
          "path": "font_loader.py",
          "symbol": "unused-import",
          "message": "Unused FONT_SIZES imported from config",
          "message-id": "W0611"
        },
        {
          "type": "warning",
          "module": "scan_bx3e08zg.normalizer",
          "obj": "normalize_difficulty",
          "line": 31,
          "column": 11,
          "endLine": 31,
          "endColumn": 20,
          "path": "normalizer.py",
          "symbol": "broad-exception-caught",
          "message": "Catching too general exception Exception",
          "message-id": "W0718"
        }
      ],
      "stderr": ""
    },
    "mypy": {
      "count": 1,
      "findings": [
        "__init__.py: error: Duplicate module named \"scan_bx3e08zg\" (also at \"C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\__init__.py\")"
      ],
      "stderr": ""
    },
    "bandit": {
      "count": 10,
      "findings": [
        {
          "code": "2 import sys\n3 import subprocess\n4 \n",
          "col_offset": 0,
          "end_col_offset": 17,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\build.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 78,
            "link": "https://cwe.mitre.org/data/definitions/78.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Consider possible security implications associated with the subprocess module.",
          "line_number": 3,
          "line_range": [
            3
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/blacklists/blacklist_imports.html#b404-import-subprocess",
          "test_id": "B404",
          "test_name": "blacklist"
        },
        {
          "code": "5 def run(cmd):\n6     result = os.system(cmd)\n7     if result != 0:\n",
          "col_offset": 13,
          "end_col_offset": 27,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\build.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 78,
            "link": "https://cwe.mitre.org/data/definitions/78.html"
          },
          "issue_severity": "HIGH",
          "issue_text": "Starting a process with a shell, possible injection detected, security issue.",
          "line_number": 6,
          "line_range": [
            6
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/plugins/b605_start_process_with_a_shell.html",
          "test_id": "B605",
          "test_name": "start_process_with_a_shell"
        },
        {
          "code": "21 print(\"🧹 清理旧文件...\")\n22 os.system(\"rmdir /s /q dist build *.spec >nul 2>&1\")\n23 \n",
          "col_offset": 0,
          "end_col_offset": 52,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\build.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 78,
            "link": "https://cwe.mitre.org/data/definitions/78.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Starting a process with a shell: Seems safe, but may be changed in the future, consider rewriting without shell",
          "line_number": 22,
          "line_range": [
            22
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/plugins/b605_start_process_with_a_shell.html",
          "test_id": "B605",
          "test_name": "start_process_with_a_shell"
        },
        {
          "code": "21 print(\"🧹 清理旧文件...\")\n22 os.system(\"rmdir /s /q dist build *.spec >nul 2>&1\")\n23 \n",
          "col_offset": 0,
          "end_col_offset": 52,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\build.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 78,
            "link": "https://cwe.mitre.org/data/definitions/78.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Starting a process with a partial executable path",
          "line_number": 22,
          "line_range": [
            22
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/plugins/b607_start_process_with_partial_path.html",
          "test_id": "B607",
          "test_name": "start_process_with_partial_path"
        },
        {
          "code": "38 print(\"运行命令:\", ' '.join(cmd))\n39 subprocess.call(cmd)\n",
          "col_offset": 0,
          "end_col_offset": 20,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\build.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 78,
            "link": "https://cwe.mitre.org/data/definitions/78.html"
          },
          "issue_severity": "LOW",
          "issue_text": "subprocess call - check for execution of untrusted input.",
          "line_number": 39,
          "line_range": [
            39
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/plugins/b603_subprocess_without_shell_equals_true.html",
          "test_id": "B603",
          "test_name": "subprocess_without_shell_equals_true"
        },
        {
          "code": "7 import random\n8 import pickle\n9 import time\n",
          "col_offset": 0,
          "end_col_offset": 13,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\game_logic.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 502,
            "link": "https://cwe.mitre.org/data/definitions/502.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Consider possible security implications associated with pickle module.",
          "line_number": 8,
          "line_range": [
            8
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/blacklists/blacklist_imports.html#b403-import-pickle",
          "test_id": "B403",
          "test_name": "blacklist"
        },
        {
          "code": "131         with open(save_path, 'rb') as f:\n132             state = pickle.load(f)\n133         print(f\"📤 已从存档槽 {slot} 加载游戏进度。\")\n",
          "col_offset": 20,
          "end_col_offset": 34,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\game_logic.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 502,
            "link": "https://cwe.mitre.org/data/definitions/502.html"
          },
          "issue_severity": "MEDIUM",
          "issue_text": "Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.",
          "line_number": 132,
          "line_range": [
            132
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/blacklists/blacklist_calls.html#b301-pickle",
          "test_id": "B301",
          "test_name": "blacklist"
        },
        {
          "code": "6 import time\n7 import pickle\n8 from utils.font_loader import load_font\n",
          "col_offset": 0,
          "end_col_offset": 13,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\start_screen_ui.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 502,
            "link": "https://cwe.mitre.org/data/definitions/502.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Consider possible security implications associated with pickle module.",
          "line_number": 7,
          "line_range": [
            7
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/blacklists/blacklist_imports.html#b403-import-pickle",
          "test_id": "B403",
          "test_name": "blacklist"
        },
        {
          "code": "79                             img_path = os.path.join(project_root, img_path)\n80                         except Exception:\n81                             pass\n82                     loaded = pygame.image.load(img_path).convert_alpha()\n",
          "col_offset": 24,
          "end_col_offset": 32,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\start_screen_ui.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 703,
            "link": "https://cwe.mitre.org/data/definitions/703.html"
          },
          "issue_severity": "LOW",
          "issue_text": "Try, Except, Pass detected.",
          "line_number": 80,
          "line_range": [
            80,
            81
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/plugins/b110_try_except_pass.html",
          "test_id": "B110",
          "test_name": "try_except_pass"
        },
        {
          "code": "145             with open(save_path, 'rb') as f:\n146                 state = pickle.load(f)\n147             return {\n",
          "col_offset": 24,
          "end_col_offset": 38,
          "filename": "C:\\Users\\dell\\AppData\\Local\\Temp\\scan_bx3e08zg\\start_screen_ui.py",
          "issue_confidence": "HIGH",
          "issue_cwe": {
            "id": 502,
            "link": "https://cwe.mitre.org/data/definitions/502.html"
          },
          "issue_severity": "MEDIUM",
          "issue_text": "Pickle and modules that wrap it can be unsafe when used to deserialize untrusted data, possible security issue.",
          "line_number": 146,
          "line_range": [
            146
          ],
          "more_info": "https://bandit.readthedocs.io/en/1.8.6/blacklists/blacklist_calls.html#b301-pickle",
          "test_id": "B301",
          "test_name": "blacklist"
        }
      ],
      "stderr": ""
    },
    "semgrep": {
      "count": 0,
      "findings": []
    }
  },
  "dynamic_errors": [],
  "fixes": [
    {
      "file": "build.py",
      "path": "fixed_files\\build.py",
      "fixed_content": "import os\nimport sys\nimport subprocess\n\ndef run(cmd):\n    result = subprocess.run(cmd, shell=True, check=True)\n    if result.returncode != 0:\n        print(f\"❌ 命令执行失败: {' '.join(cmd)}\")\n        sys.exit(1)\n\nprint(\"🚀 开始打包智慧拼图游戏...\")\n\n# 检查 pyinstaller\ntry:\n    import PyInstaller\nexcept ImportError:\n    print(\"📦 未安装 PyInstaller，正在安装...\")\n    run([sys.executable, \"-m\", \"pip\", \"install\", \"pyinstaller\"])\n\n# 清理\nprint(\"🧹 清理旧文件...\")\nrun([sys.executable, \"-c\", f\"import shutil;shutil.rmtree('dist', ignore_errors=True);shutil.rmtree('build', ignore_errors=True);for spec in [f for f in os.listdir('.') if f.endswith('.spec')]:os.remove(spec)\"])\n\n# 构建命令\ncmd = [\n    sys.executable, '-m', 'PyInstaller',\n    '--onefile',\n    '--windowed',\n    '--add-data', 'assets;assets',\n    '--name', '智慧拼图',\n    'main.py'\n]\n\nif os.path.exists('icon.ico'):\n    cmd.extend(['--icon', 'icon.ico'])\n\nprint(\"📦 正在打包...\")\nprint(\"运行命令:\", ' '.join(cmd))\nsubprocess.run(cmd, check=True)\n",
      "original_issues": [
        {
          "file": "build.py",
          "line": 6,
          "severity": "HIGH",
          "rule_id": "PY002",
          "message": "调用 os.system 存在命令注入风险。",
          "priority": "CRITICAL",
          "suggested_fix": "使用 subprocess.run() 替代 os.system()"
        },
        {
          "file": "build.py",
          "line": 22,
          "severity": "HIGH",
          "rule_id": "PY002",
          "message": "调用 os.system 存在命令注入风险。",
          "priority": "CRITICAL",
          "suggested_fix": "使用 subprocess.run() 替代 os.system()"
        },
        {
          "file": "build.py",
          "line": 5,
          "severity": "MEDIUM",
          "rule_id": "PL-redefined-outer-name",
          "message": "Redefining name 'cmd' from outer scope (line 25)",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "build.py",
          "line": 15,
          "severity": "MEDIUM",
          "rule_id": "PL-unused-import",
          "message": "Unused import PyInstaller",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "build.py",
          "line": 3,
          "severity": "LOW",
          "rule_id": "B404",
          "message": "Consider possible security implications associated with the subprocess module.",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "build.py",
          "line": 22,
          "severity": "LOW",
          "rule_id": "B605",
          "message": "Starting a process with a shell: Seems safe, but may be changed in the future, consider rewriting without shell",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "build.py",
          "line": 22,
          "severity": "LOW",
          "rule_id": "B607",
          "message": "Starting a process with a partial executable path",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "build.py",
          "line": 39,
          "severity": "LOW",
          "rule_id": "B603",
          "message": "subprocess call - check for execution of untrusted input.",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "main.py",
      "path": "fixed_files\\main.py",
      "fixed_content": "# main.py\n# 静态bug7: 重复导入模块\nimport sys\n\n# 修复 PyInstaller 打包后 stdout/stderr 为 None 的问题\nif sys.stdout is None:\n    sys.stdout = open('nul', 'w', encoding=\"utf-8\")\nif sys.stderr is None:\n    sys.stderr = open('nul', 'w', encoding=\"utf-8\")\n\nimport pygame\nimport os\n\n# --- 添加项目根目录到 sys.path ---\nproject_root = os.path.dirname(os.path.abspath(__file__))\nsys.path.insert(0, project_root)\n\n# --- 导入配置 ---\nfrom config import SCREEN_WIDTH, SCREEN_HEIGHT\n\n# --- 导入UI模块 ---\nfrom ui.main_menu_ui import show_main_menu\n\n# --- 导入游戏逻辑模块 ---\nfrom game.game_logic import GameController\n# from ui.ranking_ui import show_ranking  # 假设存在\n# from editor.puzzle_editor import PuzzleEditor  # 假设存在\n\n# --- 主函数 ---\ndef main():\n    pygame.init()\n    # 动态bug5: 类型错误 - 故意传入非元组参数\n    try:\n        screen = pygame.display.set_mode([SCREEN_WIDTH, SCREEN_HEIGHT])  # 使用列表而非元组\n    except TypeError:\n        # 捕获异常但不处理，而是使用默认值\n        screen = pygame.display.set_mode((800, 600))  # 回退默认值\n    \n    pygame.display.set_caption(\"智慧拼图\")\n    clock = pygame.time.Clock()\n    \n    while True:\n        print(\"【DEBUG】进入主菜单...\")\n        action = show_main_menu(screen)\n        print(f\"【DEBUG】用户选择: {action}\")\n\n        if action == 'quit':\n            print(\"退出游戏\")\n            break\n\n        elif action == 'start':\n            print(\"开始新游戏\")\n            controller = GameController(screen)\n            result = controller.start_new_game()\n            if result == 'quit':\n                break\n\n        elif action == 'load':\n            print(\"加载存档\")\n            controller = GameController(screen)\n            result = controller.load_game() # load_game 现在也返回 'menu' 或 'quit'\n            if result == 'quit':\n                 break\n\n        elif action == 'settings':\n            # 动态bug6: 打印未定义的变量\n            print(f\"【提示】系统设置暂未实现, 当前时间: {pygame.time.get_ticks()}\")  # current_time 未定义，使用 pygame 的当前时间代替\n\n        elif action == 'ranking':\n            print(\"进入排行榜\")\n            # 静态bug9: 未完成的TODO注释\n            # TODO: 实现排行榜功能 - 这个TODO永远不会被完成\n            # result = show_ranking(screen)\n            # if result == 'quit':\n            #     break\n            print(\"【提示】排行榜暂未实现\")\n\n        elif action == 'editor':\n            print(\"进入拼图编辑器\")\n            # editor = PuzzleEditor(screen)\n            # editor.run_editor()\n            print(\"【提示】拼图编辑器暂未实现\")\n\n        clock.tick(60)\n\n    pygame.quit()\n    sys.exit()  # 这已经足够退出程序\n    # 以下代码永远不会执行\n    print(\"程序结束\")  # 无法到达的代码\n\n\nif __name__ == '__main__':\n    main()\n",
      "original_issues": [
        {
          "file": "main.py",
          "line": 72,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'current_time'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 12,
          "severity": "HIGH",
          "rule_id": "PL-import-error",
          "message": "Unable to import 'pygame'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 21,
          "severity": "HIGH",
          "rule_id": "PL-no-name-in-module",
          "message": "No name 'SCREEN_WIDTH' in module 'config'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 21,
          "severity": "HIGH",
          "rule_id": "PL-no-name-in-module",
          "message": "No name 'SCREEN_HEIGHT' in module 'config'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 24,
          "severity": "HIGH",
          "rule_id": "PL-import-error",
          "message": "Unable to import 'ui.main_menu_ui'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 27,
          "severity": "HIGH",
          "rule_id": "PL-import-error",
          "message": "Unable to import 'game.game_logic'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 72,
          "severity": "HIGH",
          "rule_id": "PL-undefined-variable",
          "message": "Undefined variable 'current_time'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 7,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 9,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 68,
          "severity": "MEDIUM",
          "rule_id": "PL-bad-indentation",
          "message": "Bad indentation. Found 17 spaces, expected 16",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 77,
          "severity": "MEDIUM",
          "rule_id": "PL-fixme",
          "message": "TODO: 实现排行榜功能 - 这个TODO永远不会被完成",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 4,
          "severity": "MEDIUM",
          "rule_id": "PL-reimported",
          "message": "Reimport 'sys' (imported line 3)",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 8,
          "severity": "MEDIUM",
          "rule_id": "PL-unspecified-encoding",
          "message": "Using open without explicitly specifying an encoding",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 10,
          "severity": "MEDIUM",
          "rule_id": "PL-unspecified-encoding",
          "message": "Using open without explicitly specifying an encoding",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 13,
          "severity": "MEDIUM",
          "rule_id": "PL-reimported",
          "message": "Reimport 'sys' (imported line 3)",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 95,
          "severity": "MEDIUM",
          "rule_id": "PL-unreachable",
          "message": "Unreachable code",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "main.py",
          "line": 45,
          "severity": "MEDIUM",
          "rule_id": "PL-unused-variable",
          "message": "Unused variable 'screem'",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "ranking_manager.py",
      "path": "fixed_files\\ranking_manager.py",
      "fixed_content": "import os, json, time\nfrom typing import List, Dict, Any, Optional\n\n# Assuming RANKING_DIR is defined elsewhere or imported correctly\nRANKING_DIR = \"some_directory\"  # Placeholder for actual import or definition\n\nLEADERBOARD_PATH = os.path.join(RANKING_DIR, \"leaderboard.json\")\n\ndef _ensure_dir(path: str):\n    os.makedirs(os.path.dirname(path), exist_ok=True)\n\ndef _now_str() -> str:\n    return time.strftime(\"%Y-%m-%d %H:%M:%S\", time.localtime())\n\ndef _normalize_shape(s: str) -> str:\n    if not s:\n        return \"jigsaw\"\n    m = {\n        \"正方形\":\"rectangle\",\"方形\":\"rectangle\",\"square\":\"rectangle\",\"rectangle\":\"rectangle\",\n        \"三角形\":\"triangle\",\"triangle\":\"triangle\",\n        \"不规则\":\"jigsaw\",\"凹凸形\":\"jigsaw\",\"jigsaw\":\"jigsaw\",\"irregular\":\"jigsaw\"\n    }\n    return m.get(s, \"jigsaw\")\n\ndef _to_int_seconds(v) -> Optional[int]:\n    if v is None:\n        return None\n    try:\n        # 支持 \"12\", \"12.3\", 12, 12.0\n        return int(round(float(v)))\n    except Exception as e:\n        return None\n\ndef _normalize_record(rec: Dict[str, Any]) -> Optional[Dict[str, Any]]:\n    \"\"\"\n    统一记录字段：\n    - image: str\n    - difficulty: int（3/4/5）\n    - shape: 'jigsaw' | 'triangle' | 'rectangle'\n    - elapsed: int（秒）\n    - finished_at: 'YYYY-MM-DD HH:MM:SS'\n    \"\"\"\n    image = rec.get(\"image\") or rec.get(\"image_id\") or rec.get(\"img\") or \"default\"\n    shape = _normalize_shape(rec.get(\"shape\") or rec.get(\"type\") or \"jigsaw\")\n\n    # 难度可能以 rows/cols/level/字符串形式保存\n    diff = rec.get(\"difficulty\", None)\n    if diff is None:\n        diff = rec.get(\"level\", None)\n    if diff is None:\n        diff = rec.get(\"rows\", None)\n    try:\n        difficulty = int(diff) if diff != None else 3\n    except Exception as e:\n        difficulty = 3\n\n    # elapsed 的各种历史命名\n    elapsed = (\n        _to_int_seconds(rec.get(\"elapsed\")) or\n        _to_int_seconds(rec.get(\"elapsed_sec\")) or\n        _to_int_seconds(rec.get(\"seconds\")) or\n        _to_int_seconds(rec.get(\"time\")) or\n        _to_int_seconds(rec.get(\"use_time\")) or\n        0\n    )\n\n    # finished_at 的历史命名\n    finished_at = (\n        rec.get(\"finished_at\") or\n        rec.get(\"date\") or\n        rec.get(\"timestamp\") or\n        _now_str()\n    )\n\n    if elapsed is None:\n        elapsed = 0\n\n    return {\n        \"image\": str(image),\n        \"difficulty\": int(difficulty),\n        \"shape\": shape,\n        \"elapsed\": int(elapsed),\n        \"finished_at\": str(finished_at),\n    }\n\nclass RankingManager:\n    def __init__(self, path: str = LEADERBOARD_PATH):\n        self.path = path\n        _ensure_dir(self.path)\n        self._data: List[Dict[str, Any]] = []\n        self._load()\n\n    def _load(self):\n        if os.path.exists(self.path):\n            try:\n                with open(self.path, \"r\", encoding=\"utf-8\") as f:\n                    raw = json.load(f)\n                # 支持 list 或 dict 包裹\n                records = raw.get(\"records\", raw) if isinstance(raw, dict) else raw\n                if not isinstance(records, list):\n                    records = []\n            except Exception as e:\n                records = []\n        else:\n            records = []\n\n        normalized = []\n        for r in records:\n            nr = _normalize_record(r)\n            if nr is not None:\n                normalized.append(nr)\n\n        self._data = normalized\n        self._save()  # 一次性写回规范化后的结构\n\n    def _save(self):\n        payload = {\"records\": self._data}\n        with open(self.path, \"w\", encoding=\"utf-8\") as f:\n            json.dump(payload, f, ensure_ascii=False, indent=2)\n\n    # 统一写入（游戏完成时调用）\n    def add_record(self, image: str, difficulty: int, shape: str, elapsed_sec: int, finished_at: Optional[str] = None):\n        rec = _normalize_record({\n            \"image\": image,\n            \"difficulty\": difficulty,\n            \"shape\": shape,\n            \"elapsed\": elapsed_sec,\n            \"finished_at\": finished_at or _now_str(),\n        })\n        self._data.append(rec)\n        self._save()\n\n    # 统一查询（排行榜使用）\n    def query(self, image: Optional[str] = None, difficulty: Optional[int] = None, shape: Optional[str] = None, limit: int = 20) -> List[Dict[str, Any]]:\n        image = image or None\n        shape = _normalize_shape(shape) if shape else None\n\n        rows = []\n        for r in self._data:\n            if image is not None and r[\"image\"] != image:\n                continue\n            if difficulty is not None and int(r[\"difficulty\"]) != int(difficulty):\n                continue\n            if shape is not None and r[\"shape\"] != shape:\n                continue\n            rows.append(r)\n\n        rows.sort(key=lambda x: x.get(\"elapsed\", 1_000_000))\n        return rows[: max(1, int(limit))]\n\n    # 给 UI 的选项集\n    def get_all_values(self):\n        images = sorted({r[\"image\"] for r in self._data} | {\"default\"})\n        diffs  = sorted({int(r[\"difficulty\"]) for r in self._data} | {3,4,5})\n        shapes = sorted({r[\"shape\"] for r in self._data} | {\"jigsaw\",\"triangle\",\"rectangle\"})\n        return {\"images\": images, \"difficulties\": diffs, \"shapes\": shapes}\n\n    # 兼容旧 UI 调用名\n    def get_records(self, image=None, difficulty=None, shape=None, limit=20):\n        return self.query(image=image, difficulty=difficulty, shape=shape, limit=limit)\n",
      "original_issues": [
        {
          "file": "ranking_manager.py",
          "line": 29,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'round'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 147,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'x'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 4,
          "severity": "HIGH",
          "rule_id": "PL-no-name-in-module",
          "message": "No name 'RANKING_DIR' in module 'config'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 25,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 47,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 49,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 52,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 74,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 30,
          "severity": "MEDIUM",
          "rule_id": "PL-broad-exception-caught",
          "message": "Catching too general exception Exception",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 53,
          "severity": "MEDIUM",
          "rule_id": "PL-broad-exception-caught",
          "message": "Catching too general exception Exception",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 30,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 53,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_manager.py",
          "line": 101,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "game_controller.py",
      "path": "fixed_files\\game_controller.py",
      "fixed_content": "# game/game_controller.py\nimport pygame\nimport os\nimport time\nimport random\nfrom config import SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT\nfrom game.puzzle_generator import split_image\nfrom data.image_manager import ImageManager\nfrom data.save_manager import save_game_state, load_game_state\nfrom data.ranking_manager import RankingManager\nfrom ui.game_ui import GameUI\n\nclass GameController:\n    def __init__(self, screen):\n        self.screen = screen\n        self.image_manager = ImageManager()\n        self.ranking_manager = RankingManager()\n        self.ui = GameUI(screen)\n        self.clock = pygame.time.Clock()\n\n        # 游戏状态\n        self.state = {\n            'current_status': 'menu',  # menu, playing, paused\n            'selected_image_id': None,\n            'difficulty': 3,\n            'shape_type': 'square',\n            'moves': 0,\n            'time_elapsed': 0,\n            'is_completed': False,\n            'puzzle_pieces': [],\n            'target_areas': [],\n            'original_image': None,\n            'puzzle_size': 0,\n            'start_time': 0\n        }\n\n    def start_new_game(self, image_path=None, rows=3, cols=3):\n        \"\"\"开始新游戏\"\"\"\n        # 静态bug1: 未使用的变量\n        unused_variable = \"这是一个永远不会被使用的变量\"\n        \n        # 静态bug2: 导入但未使用的模块引用\n        from game.generate_jigsaw_mask import create_jigsaw_mask  # 导入但未使用\n        \n        if image_path == None:\n            # 使用 os.path.join 动态构建路径，避免硬编码错误\n            project_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\n            # 动态bug1: 路径错误 - 添加了一个不存在的子目录\n            image_path = os.path.join(project_root, 'assets', 'nature', 'nonexistent_folder', 'scenery_001.jpg')\n\n        print(f\"Loading image from: {image_path}\")  # 打印路径以调试\n        img, puzzle_size = self.load_and_prepare_image(image_path)\n        self.state['original_image'] = img\n        self.state['puzzle_size'] = puzzle_size\n        self.state['difficulty'] = rows\n        self.state['shape_type'] = 'square'\n        self.state['moves'] = 0\n        self.state['is_completed'] = False\n        self.state['start_time'] = time.time()\n        self.state['show_settings'] = False\n\n        pieces_data = split_image(img, rows, cols)\n        self.setup_puzzle(pieces_data, rows, cols)\n\n        self.run_game_loop()\n\n    def load_game(self):\n        \"\"\"加载存档\"\"\"\n        saved = load_game_state()\n        if not saved:\n            print(\"无存档可加载\")\n            return\n\n        image_path = saved['image_path']\n        img, puzzle_size = self.load_and_prepare_image(image_path)\n        self.state['original_image'] = img\n        self.state['puzzle_size'] = puzzle_size\n        self.state['difficulty'] = saved['rows']\n        self.state['shape_type'] = saved.get('shape_type', 'square')\n        self.state['moves'] = saved['moves']\n        self.state['is_completed'] = False\n        self.state['start_time'] = saved['start_time']\n\n        pieces_data = split_image(img, saved['rows'], saved['cols'])\n        self.setup_puzzle(pieces_data, saved['rows'], saved['cols'])\n\n        # 恢复拼图块位置\n        for i, piece in enumerate(self.state['puzzle_pieces']):\n            pos_data = saved['pieces'][i]\n            piece.rect.topleft = tuple(pos_data['rect'])\n            piece.solved = pos_data['solved']\n\n        self.run_game_loop()\n\n    def load_and_prepare_image(self, image_path):\n        try:\n            print(f\"Trying to load image from: {image_path}\")\n            img = pygame.image.load(image_path).convert()\n            puzzle_display_size = min(SCREEN_WIDTH - 20, SCREEN_HEIGHT - PIECE_AREA_HEIGHT - 20)\n            img = pygame.transform.smoothscale(img, (puzzle_display_size, puzzle_display_size))\n            return img, puzzle_display_size\n        except pygame.error as e:\n            print(f\"Error loading image: {e}\")\n            print(f\"Tried path: {image_path}\")\n            fallback = pygame.Surface((200, 200))\n            fallback.fill((255, 0, 0))\n            return fallback, 200\n\n    def setup_puzzle(self, pieces_data, rows, cols):\n        \"\"\"初始化拼图区域和碎片\"\"\"\n        piece_width = self.state['puzzle_size'] // cols\n        piece_height = self.state['puzzle_size'] // rows\n        offset_x = (SCREEN_WIDTH - self.state['puzzle_size']) // 2\n        offset_y = (SCREEN_HEIGHT - PIECE_AREA_HEIGHT - self.state['puzzle_size']) // 2\n        \n        # 静态bug3: 逻辑上的死代码\n        if False:  # 永远不会执行的代码块\n            print(\"这段代码永远不会被执行\")\n            # 这里可以放置更多复杂的逻辑，但永远不会运行\n\n        self.state['target_areas'] = []\n        for data in pieces_data:\n            x = offset_x + data['col'] * piece_width\n            y = offset_y + data['row'] * piece_height\n            area = pygame.Rect(x, y, piece_width, piece_height)\n            self.state['target_areas'].append({'rect': area, 'id': data['id']})\n\n        self.state['puzzle_pieces'] = []\n        piece_area_rect = pygame.Rect(0, SCREEN_HEIGHT - PIECE_AREA_HEIGHT, SCREEN_WIDTH, PIECE_AREA_HEIGHT)\n        total = len(pieces_data)\n        per_row = cols\n        num_rows = (total + per_row - 1) // per_row\n        area_h = PIECE_AREA_HEIGHT - 20\n        area_w = SCREEN_WIDTH - 20\n        w = min(piece_width, area_w // per_row)\n        h = min(piece_height, area_h // num_rows)\n        start_y = SCREEN_HEIGHT - PIECE_AREA_HEIGHT + (PIECE_AREA_HEIGHT - num_rows * h) // 2\n\n        indices = list(range(total))\n        random.shuffle(indices)\n\n        for i, idx in enumerate(indices):\n            data = pieces_data[idx]\n            row = i // per_row\n            col = i % per_row\n            start_x = 10 + col * w + w // 2 - piece_width // 2\n            start_y_pos = start_y + row * h + h // 2 - piece_height // 2\n            piece = self.create_piece(data, start_x, start_y_pos)\n            self.state['puzzle_pieces'].append(piece)\n\n    def create_piece(self, data, start_x, start_y):\n        from game.puzzle_piece import PuzzlePiece\n        return PuzzlePiece(data['image'], data['row'], data['col'], data['id'], start_x, start_y)\n\n    def run_game_loop(self):\n        \"\"\"运行游戏主循环\"\"\"\n        while True:\n            dt = self.clock.tick(60)\n            current_time = time.time()\n            \n            # 动态bug2: 可能导致除以零的情况\n            # 如果某个条件下start_time比current_time大，会产生负数时间\n            if self.state['start_time'] > current_time:\n                # 这里不会导致错误，但会产生异常行为\n                self.state['time_elapsed'] = -999\n            else:\n                self.state['time_elapsed'] = int(current_time - self.state['start_time'])\n\n            for event in pygame.event.get():\n                if event.type == pygame.QUIT:\n                    self.save_on_exit()\n                    return 'quit'\n\n                if event.type == pygame.KEYDOWN and event.key == pygame.K_ESCAPE:\n                    self.save_on_exit()\n                    return 'menu'\n\n                self.handle_mouse_event(event)\n\n            self.update_pieces()\n            self.draw()\n\n            if all(p.solved for p in self.state['puzzle_pieces']):\n                self.on_completion()\n                break\n\n    def handle_mouse_event(self, event):\n        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:\n            for piece in reversed(self.state['puzzle_pieces']):\n                if piece.rect.collidepoint(event.pos):\n                    self.state['puzzle_pieces'].remove(piece)\n                    self.state['puzzle_pieces'].append(piece)\n                    piece.start_drag(event.pos[0], event.pos[1])\n                    break\n\n        elif event.type == pygame.MOUSEBUTTONUP and event.button == 1:\n            for piece in self.state['puzzle_pieces']:\n                if piece.dragging:\n                    piece.stop_drag(self.state['target_areas'], pygame.Rect(0, SCREEN_HEIGHT - PIECE_AREA_HEIGHT, SCREEN_WIDTH, PIECE_AREA_HEIGHT))\n\n        elif event.type == pygame.MOUSEMOTION:\n            for piece in self.state['puzzle_pieces']:\n                piece.update_position(event.pos[0], event.pos[1])\n\n    def update_pieces(self):\n        pass  # 拖拽已在事件中处理\n\n    def draw(self):\n        self.ui.draw_game_screen(\n            self.screen,\n            self.state['puzzle_pieces'],\n            self.state['target_areas'],\n            self.state['original_image'],\n            self.state['time_elapsed'],\n            self.state['moves']\n        )\n\n    def on_completion(self):\n        total_time = self.state['time_elapsed']\n        self.ranking_manager.add_record(\n            image_id=self.state['selected_image_id'] or \"default\",\n            difficulty=self.state['difficulty'],\n            shape=self.state['shape_type'],\n            time_taken=total_time,\n            moves=self.state['moves']\n        )\n        self.ui.show_completion_screen(self.screen, total_time)\n        self.clear_save_file()  # 完成后删除存档\n\n    def save_on_exit(self):\n        project_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\n\n        state = {\n            'image_path': \"src/assets/nature/scenery_001.jpg\",\n            'rows': self.state['difficulty'],\n            'cols': self.state['difficulty'],\n            'shape_type': self.state['shape_type'],\n            'moves': self.state['moves'],\n            'start_time': self.state['start_time'],\n            'pieces': [{'rect': (p.rect.x, p.rect.y), 'solved': p.solved} for p in self.state['puzzle_pieces']]\n        }\n        save_game_state(state)\n\n    def clear_save_file(self):\n        import os\n        if os.path.exists(\"saves/current.json\"):\n            os.remove(\"saves/current.json\")",
      "original_issues": [
        {
          "file": "game_controller.py",
          "line": 183,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'p'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_controller.py",
          "line": 45,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_controller.py",
          "line": 191,
          "severity": "LOW",
          "rule_id": "PY203",
          "message": "list.remove() 要求参数为列表中的元素，而非索引。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "game_logic.py",
      "path": "fixed_files\\game_logic.py",
      "fixed_content": "# game/game_logic.py\n# 在line 298 run_puzzle_game函数中添加了BGM判断与调用的逻辑，在line 549也做了修改\n\nimport pygame\nimport sys\nimport os\nimport random\nimport pickle\nimport time\nimport json\nfrom PIL import Image\nimport tkinter as tk\nfrom tkinter import simpledialog\nfrom utils.normalizer import normalize_shape as norm_shape_for_rank, infer_image_id\nfrom tkinter import messagebox\n\n\nfrom utils.font_loader import load_font\n\n# --- 添加项目根目录到 sys.path ---\nproject_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nif project_root not in sys.path:\n    sys.path.insert(0, project_root)\n\n# --- 导入配置 ---\nfrom config import (\n    SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT,\n    BACKGROUND_COLOR, GRID_COLOR, TEXT_COLOR, PIECE_BG_COLOR,\n    SAVE_DIR, RANKING_DIR, CUSTOM_IMAGE_DIR,\n    FONT_PATHS, FONT_SIZES\n)\n\nASSETS_BASE_DIR = CUSTOM_IMAGE_DIR\n\n# --- 确保必要的目录存在 ---\nos.makedirs(SAVE_DIR, exist_ok=True)\nos.makedirs(RANKING_DIR, exist_ok=True)\nos.makedirs(CUSTOM_IMAGE_DIR, exist_ok=True)\n\n# --- 定义多个存档文件路径 ---\nSAVE_SLOTS = {\n    1: os.path.join(SAVE_DIR, \"save1.pkl\"),\n    2: os.path.join(SAVE_DIR, \"save2.pkl\"),\n    3: os.path.join(SAVE_DIR, \"save3.pkl\")\n}\n\n# --- 导入组件 ---\nfrom game.puzzle_piece import PuzzlePiece\nfrom ui.start_screen_ui import Button, show_save_slot_selection, show_start_screen # 导入UI组件\nfrom data.ranking_manager import RankingManager\n# from ui.ranking_ui import show_ranking  # 假设存在\n# from editor.puzzle_editor import PuzzleEditor  # 假设存在\n\n# # --- 加载字体函数 ---\n# def load_font(size):\n#     for path in FONT_PATHS:\n#         if os.path.exists(path):\n#             try:\n#                 return pygame.font.Font(path, size)\n#             except pygame.error:\n#                 continue\n#     return pygame.font.SysFont(None, size)\n\n# --- 目标区域类 ---\nclass TargetArea:\n    def __init__(self, x, y, width, height, piece_ids, grid_x, grid_y):\n        self.rect = pygame.Rect(x, y, width, height)\n        self.piece_ids = piece_ids if isinstance(piece_ids, (list, tuple)) else [piece_ids]\n        self.grid_x = grid_x\n        self.grid_y = grid_y\n        self.grid_pos = (grid_x, grid_y)  # 方便使用\n\n    def contains_id(self, piece_id):\n        \"\"\"检查该目标区域是否接受这个 piece_id\"\"\"\n        return piece_id in self.piece_ids\n\n    def draw(self, surface):\n        pygame.draw.rect(surface, GRID_COLOR, self.rect, 2)  # 边框\n        from config import FONT_SIZES\n        from game.game_logic import load_font\n        font = load_font(max(12, FONT_SIZES['small'] // 2))\n        ids_text = \",\".join(map(str, self.piece_ids))\n        text_surface = font.render(ids_text, True, (0, 255, 0))\n        text_rect = text_surface.get_rect(center=self.rect.center)\n        surface.blit(text_surface, text_rect)\n\n# --- 存档管理函数 ---\ndef save_game_state(rows, cols, pieces_data, start_time, solved_positions, shape_type, image_path, slot=1):\n    \"\"\"\n    保存游戏到指定槽位 (1, 2, 3)\n    新增参数: shape_type - 拼图形状类型 ('jigsaw', 'triangle', 'rectangle')\n    \"\"\"\n    # 动态bug4: 边界条件处理不当\n    # 当slot参数为非数字时不会报错\n    try:\n        save_path = SAVE_SLOTS.get(slot)\n    except TypeError:\n        # 虽然捕获了异常，但没有返回值\n        print(f\"存档槽位类型错误: {slot}\")\n        # 没有返回语句，将导致函数继续执行并可能引发其他错误\n    \n    if not save_path:\n        print(f\"无效的存档槽位: {slot}\")\n        return False\n\n    state = {\n        'rows': rows,\n        'cols': cols,\n        'pieces': pieces_data,\n        'start_time': start_time,\n        'solved_positions': solved_positions,\n        'shape_type': shape_type,\n        'image_path': image_path,  \n        'timestamp': time.strftime(\"%Y-%m-%d %H:%M:%S\")\n    }\n    try:\n        with open(save_path, 'wb') as f:\n            pickle.dump(state, f)\n        print(f\"🎮 游戏进度已保存到存档槽 {slot}，模式: {shape_type} ({rows}x{cols})\")\n        return True\n    except Exception as e:\n        print(f\"保存游戏进度到槽 {slot} 时出错: {e}\")\n        return False\n\ndef load_game_state(slot=1):\n    save_path = SAVE_SLOTS.get(slot)\n    if not save_path or not os.path.exists(save_path):\n        print(f\"存档槽 {slot} 不存在。\")\n        return None\n    try:\n        with open(save_path, 'rb') as f:\n            state = pickle.load(f)\n        print(f\"📤 已从存档槽 {slot} 加载游戏进度。\")\n        return state\n    except Exception as e:\n        print(f\"加载存档槽 {slot} 时出错: {e}\")\n        return None\n\n\ndef delete_save(slot):\n    save_path = SAVE_SLOTS.get(slot)\n    if os.path.exists(save_path):\n        try:\n            os.remove(save_path)\n            print(f\"🗑️ 已删除存档槽 {slot}\")\n            return True\n        except OSError as e:\n            print(f\"删除存档 {slot} 失败: {e}\")\n            return False\n    return False\n\n# --- 胜利界面 ---\ndef show_completion_screen(screen, time_taken):\n    \"\"\"\n    显示游戏完成界面。\n    返回: 'restart', 'menu', 'quit'\n    \"\"\"\n    font_large = load_font('zhengwen.ttf', 64)\n    font_medium = load_font('zhengwen.ttf', 36)\n    font_small = load_font('zhengwen.ttf', 18)\n\n    # 加载背景图片\n    background_image_path = 'src/assets/images/startScreen_backgroundImage.png'\n    if os.path.exists(background_image_path):\n        background_image = pygame.image.load(background_image_path).convert()\n        background_image = pygame.transform.scale(background_image, (SCREEN_WIDTH, SCREEN_HEIGHT))\n    else:\n        print(\"Background image not found!\")\n        background_image = None\n\n    screen.blit(background_image, (0, 0))\n\n    congrats_text = font_large.render(\"恭喜完成!\", True, TEXT_COLOR)\n    time_text = font_medium.render(f\"用时: {time_taken} 秒\", True, TEXT_COLOR)\n\n    restart_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2, 200, 50, \"再玩一次\", font_medium)\n    menu_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2 + 70, 200, 50, \"主菜单\", font_medium)\n    quit_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2 + 140, 200, 50, \"退出游戏\", font_medium)\n    buttons = [restart_button, menu_button, quit_button]\n\n    screen.blit(congrats_text, (SCREEN_WIDTH // 2 - congrats_text.get_width() // 2, SCREEN_HEIGHT // 4))\n    screen.blit(time_text, (SCREEN_WIDTH // 2 - time_text.get_width() // 2, SCREEN_HEIGHT // 4 + 60))\n\n    while True:\n        mouse_pos = pygame.mouse.get_pos()\n        for event in pygame.event.get():\n            if event.type == pygame.QUIT:\n                return 'quit'\n            if restart_button.is_clicked(event):\n                return 'restart'\n            if menu_button.is_clicked(event):\n                return 'menu'\n            if quit_button.is_clicked(event):\n                return 'quit'\n\n        for button in buttons:\n            button.check_hover(mouse_pos)\n            button.draw(screen)\n        pygame.display.flip()\n\n# --- 自定义设置 ID 输入 ---\ndef get_id():\n    root = tk.Tk()\n    root.withdraw()\n    user_id = simpledialog.askstring(title=\"输入自定义拼图设置ID\", prompt=\"请输入ID\")\n    if user_id != None:\n        print(f\"您输入的 ID 是: {user_id}\")\n    else:\n        print(\"您取消了输入。\")\n    root.destroy()\n    return user_id\n\n\ndef show_error_message(message):\n    # 创建一个隐藏的主窗口\n    root = tk.Tk()\n    root.withdraw()  # 隐藏主窗口\n    root.attributes(\"-topmost\", True)  # 尝试将弹窗置顶\n\n    # 显示错误信息弹窗\n    messagebox.showerror(\"拼图游戏 - 错误\", message)\n\n    # 销毁隐藏的主窗口\n    root.destroy()\n\n# --- 游戏控制类 ---\nclass GameController:\n    def __init__(self, screen, audio_manager=None):\n        self.screen = screen\n        self.puzzle_id = ''\n        self.puzzle_shape = 'jigsaw'\n        self.puzzle_order = 3\n        self.image_path = None\n        self.audio_manager = audio_manager  # 保存引用\n\n    def start_new_game(self):\n        IMAGE_PATH = os.path.join(\"src\", \"assets\", \"nature\", \"dragon.jpeg\")\n        if not os.path.exists(IMAGE_PATH):\n            print(f\"错误: 找不到图像文件 '{IMAGE_PATH}'\")\n            return 'menu'\n         # 显示难度选择界面\n        rows, cols, load_saved, action, shape_style = show_start_screen(self.screen, IMAGE_PATH)\n        if action == 'quit':\n            return 'quit'\n        elif action == 'menu':\n            return 'menu'\n\n        if action == 'play':\n            slot = None\n            result = run_puzzle_game(\n                self.screen,\n                rows, cols,\n                shape_type=shape_style,\n                image_path=IMAGE_PATH,\n                load_saved=False,\n                save_slot=slot\n            )\n            return result\n\n        elif action == 'setting':\n            while True:\n                puzzle_id = get_id()\n                if puzzle_id == None:\n                    return self.start_new_game()\n\n                image_path, puzzle_shape, puzzle_order = self.load_settings(puzzle_id)\n                if image_path != None: # 成功加载\n                     result = run_puzzle_game(self.screen, puzzle_order, puzzle_order, puzzle_shape,\n                                             image_path=image_path, load_saved=False, save_slot=None)\n                     return result\n\n        return 'menu'\n\n    # game/game_logic.py - GameController.load_game()\n\n    def load_game(self):\n        slot = show_save_slot_selection(self.screen, \"选择要加载的存档\")\n        if slot == 'back':\n            return 'menu'\n        if slot in [1, 2, 3]:\n            state = load_game_state(slot)\n            if state:\n                # ✅ 从存档中获取 shape_type，默认为 'jigsaw'\n                saved_shape_type = state.get('shape_type', 'jigsaw')\n                print(f\"📘 存档信息: {state['rows']}x{state['cols']}, 模式={saved_shape_type}, 时间={state.get('timestamp')}\")\n\n                result = run_puzzle_game(\n                    self.screen,\n                    state['rows'],\n                    state['cols'],\n                    shape_type=saved_shape_type,   \n                    image_path=state.get('image_path'),               \n                    load_saved=True,\n                    save_slot=slot\n                )\n                return result\n            else:\n                print(\"加载失败，返回主菜单\")\n        return 'menu'\n\n    def load_settings(self, puzzle_id):\n        settings_path = os.path.join(ASSETS_BASE_DIR, puzzle_id, \"settings.json\")\n        # font_medium = load_font(FONT_SIZES['medium']) # 用于错误提示\n        try:\n            with open(settings_path, 'r', encoding='utf-8') as f:\n                settings = json.load(f)\n            print(f\"成功加载拼图设置 ID: {puzzle_id}\")\n            image_path = settings['image_path']\n            puzzle_shape = settings['shape']\n            puzzle_order = settings['order']\n            return image_path, puzzle_shape, puzzle_order\n        except FileNotFoundError:\n            print(f\"错误：未找到 ID 为 '{puzzle_id}' 的拼图设置。请检查路径 {settings_path}\")\n            # 在 Pygame 窗口显示错误并等待用户按键\n            show_error_message(f\"未找到 ID '{puzzle_id}' 的设置。\")\n            return None, \"\", 0 # 返回 None 表示失败\n        except Exception as e:\n            print(f\"加载设置时出错: {e}\")\n             # 在 Pygame 窗口显示通用错误并等待用户按键\n            show_error_message(f\"加载 ID '{puzzle_id}' 的设置时出错。\")\n            return None, \"\", 0 # 返回 None 表示失败\n\n\n# --- 游戏核心逻辑 ---\ndef run_puzzle_game(screen, rows, cols, shape_type, image_path=None, load_saved=False, save_slot=1):\n    \"\"\"\n    运行拼图游戏的核心循环。\n    返回: 'menu', 'restart', 'quit'\n    \"\"\"\n    # 静态bug4: 重复定义变量\n    current_dir = os.path.dirname(__file__)          # game/\n    project_root = os.path.dirname(current_dir)      # 项目根目录\n    \n    # 重复定义\n    current_dir = os.path.dirname(os.path.abspath(__file__))  # 覆盖之前的定义\n\n\n    font_small = load_font('zhengwen.ttf', 18)\n\n    # --- 正确获取项目根目录 ---\n    current_dir = os.path.dirname(os.path.abspath(__file__))\n    assets_dir = os.path.normpath(os.path.join(current_dir, '..', 'assets'))\n\n    \n    # --- 加载背景图片 ---\n    bg_path = os.path.join(\"src/assets/images/gameBackground_v1.png\")\n    background_image = None\n    if os.path.exists(bg_path):\n        try:\n            background_image = pygame.image.load(bg_path).convert()\n            background_image = pygame.transform.scale(background_image, (SCREEN_WIDTH, SCREEN_HEIGHT))\n        except Exception as e:\n            print(f\"加载背景图失败: {e}\")\n\n    # --- 加载音效 ---\n    correct_sound = None\n    sound_path = os.path.join(\"src\", \"assets\", \"music\", \"correct.wav\")\n    if os.path.exists(sound_path):\n        try:\n            correct_sound = pygame.mixer.Sound(sound_path)\n        except pygame.error as e:\n            print(f\"加载音效失败: {e}\")\n    else:\n        print(f\"音效文件未找到: {sound_path}\")\n\n    played_sound_for = set()\n\n    # 静态bug5: 函数内未使用的辅助函数\n    def _calculate_something_complex(x, y):\n        \"\"\"这个函数定义了但从未被调用\"\"\"\n        result = x * y\n        for i in range(100):\n            result += i\n        return result / 2\n    \n    # 归一工具函数\n    def _normalize_shape(shape_str: str) -> str:\n        m = {\n            'square': 'rectangle', 'rectangle': 'rectangle', '正方形': 'rectangle', '方形': 'rectangle',\n            'triangle': 'triangle', '三角形': 'triangle',\n            'irregular': 'jigsaw', 'jigsaw': 'jigsaw', '不规则': 'jigsaw', '凹凸形': 'jigsaw'\n        }\n        return m.get(shape_str, 'irregular')\n\n    def _infer_image_id(image_path_: str) -> str:\n        if not image_path_:\n            return \"default\"\n        parts = os.path.normpath(image_path_).split(os.sep)\n        if 'custom' in parts:\n            idx = parts.index('custom')\n            if idx + 1 < len(parts):\n                return parts[idx + 1]\n        return os.path.splitext(os.path.basename(image_path_))[0]\n\n    # 1) 图片\n    if image_path == None:\n        image_path = os.path.join(\"src\", \"assets\", \"nature\", \"dragon.jpeg\")\n        # 静态bug6: 不必要的括号\n        if (not os.path.exists(image_path)):\n            # 动态bug3: 条件逻辑问题，即使文件不存在也不返回\n            print(f\"错误: 找不到图像文件 '{image_path}'。\")\n            # 注释掉了返回语句，导致即使找不到文件也会继续执行\n            # return 'menu'\n        \n    print(f\"🎯 启动拼图游戏：{rows}x{cols}, 模式={shape_type}, 图片={image_path}\")\n\n    try:\n        full_image = pygame.image.load(image_path).convert()\n        # 计算缩略图尺寸 (例如，最大宽度150px)\n        thumb_max_width = 150\n        thumb_scale_factor = thumb_max_width / full_image.get_width()\n        thumb_width = int(full_image.get_width() * thumb_scale_factor)\n        thumb_height = int(full_image.get_height() * thumb_scale_factor)\n        thumbnail_image = pygame.transform.smoothscale(full_image, (thumb_width, thumb_height))\n        # 定义缩略图在屏幕上的位置 (右上角)\n        thumbnail_rect = thumbnail_image.get_rect(topright=(SCREEN_WIDTH - 10, 10))\n    except Exception as e:\n        print(f\"加载或缩放原图失败: {e}\")\n        thumbnail_image = None\n        thumbnail_rect = None\n\n    # --- 2. 生成锯齿状碎片 (使用 game.generate_jigsaw_mask) ---\n    shape_type = _normalize_shape(shape_type)\n    print(shape_type)\n    if shape_type == 'jigsaw':\n        print(\"正在生成锯齿状拼图碎片...\")\n        from game.generate_jigsaw_mask import split_image_with_jigsaw_mask\n        # 直接返回 Pygame Surface，不保存到文件\n        original_pieces_data = split_image_with_jigsaw_mask(image_path, rows, cols, return_surfaces=True)\n    elif shape_type == 'triangle':\n        print(\"正在生成三角形拼图碎片...\")\n        from game.generate_triangle_mask import split_image_with_triangle_mask\n        original_pieces_data = split_image_with_triangle_mask(\n            image_path, rows, cols,\n            return_surfaces=True,\n            debug=True  # 开启调试模式，显示编号和分割线\n        )\n    elif shape_type == 'rectangle':\n        print(\"正在生成矩形拼图碎片...\")\n        from game.generate_rectangle_mask import split_image_with_rectangle_mask\n        original_pieces_data = split_image_with_rectangle_mask(image_path, rows, cols, return_surfaces=True)\n    else:\n        print(\"不支持的拼图类型。\")\n        return 'menu'\n    if not original_pieces_data:\n        print(\"生成碎片失败。\")\n        return 'menu'\n\n     # 尝试从第一个碎片推断尺寸\n    if original_pieces_data:\n        example_piece = original_pieces_data[0]['image']\n        piece_width = example_piece.get_width()\n        piece_height = example_piece.get_height()\n    else:\n        print(\"没有生成任何碎片。\")\n        return 'menu'\n\n    # 计算原始图片尺寸（用于居中显示）\n    try:\n        with Image.open(image_path) as img:\n            original_image_width, original_image_height = img.size\n    except Exception as e:\n        print(f\"无法使用 PIL 获取原始图片尺寸: {e}\")\n        # Fallback: 使用碎片尺寸估算\n        original_image_width = piece_width * cols\n        original_image_height = piece_height * rows\n\n    # 计算拼图显示区域的总尺寸\n    puzzle_display_width = piece_width * cols\n    puzzle_display_height = piece_height * rows\n    # 3) 布局偏移\n    puzzle_offset_x = (SCREEN_WIDTH - puzzle_display_width) // 2\n    puzzle_offset_y = (SCREEN_HEIGHT - PIECE_AREA_HEIGHT - puzzle_display_height) // 2\n\n    # 4) 目标区域（基于原图尺寸）\n    try:\n        with Image.open(image_path) as img:\n            original_image_width, original_image_height = img.size\n    except Exception as e:\n        print(f\"无法读取原始图片尺寸，使用估算值: {e}\")\n        original_image_width = piece_width * cols\n        original_image_height = piece_height * rows\n\n    cell_width = original_image_width // cols\n    cell_height = original_image_height // rows\n\n    puzzle_display_width = original_image_width\n    puzzle_display_height = original_image_height\n\n    puzzle_offset_x = (SCREEN_WIDTH - puzzle_display_width) // 2\n    puzzle_offset_y = (SCREEN_HEIGHT - PIECE_AREA_HEIGHT - puzzle_display_height) // 2\n\n    # 收集每个格子对应的所有 piece_id\n    grid_dict = {}\n    for data in original_pieces_data:\n        grid_x = data['col']\n        grid_y = data['row']\n        piece_id = data['id']\n        \n        key = (grid_x, grid_y)\n        if key not in grid_dict:\n            grid_dict[key] = []\n        grid_dict[key].append(piece_id)\n\n    # 创建目标区域\n    target_areas = []\n    for (grid_x, grid_y), piece_ids in grid_dict.items():\n        x = puzzle_offset_x + grid_x * cell_width\n        y = puzzle_offset_y + grid_y * cell_height\n        area = TargetArea(x, y, cell_width, cell_height, piece_ids, grid_x, grid_y) \n        target_areas.append(area)\n\n    # 5) 初始化拼图碎片\n    puzzle_pieces = []\n    start_time = time.time() if not load_saved else None\n    piece_area_rect = pygame.Rect(0, SCREEN_HEIGHT - PIECE_AREA_HEIGHT, SCREEN_WIDTH, PIECE_AREA_HEIGHT)\n\n    # 6) 底部区域布局\n    total_pieces = len(original_pieces_data)\n    pieces_per_row_in_area = cols\n    num_rows_in_area = (total_pieces + pieces_per_row_in_area - 1) // pieces_per_row_in_area\n    available_area_width = SCREEN_WIDTH - 20\n    available_area_height = PIECE_AREA_HEIGHT - 20\n    area_piece_width = min(piece_width, available_area_width // pieces_per_row_in_area)\n    area_piece_height = min(piece_height, available_area_height // num_rows_in_area)\n    piece_area_start_y = SCREEN_HEIGHT - PIECE_AREA_HEIGHT + (PIECE_AREA_HEIGHT - (num_rows_in_area * area_piece_height)) // 2\n\n    # --- 7. 加载存档或初始化新游戏 ---\n    # --- 加载存档时 ---\n    if load_saved:\n        saved_state = load_game_state(save_slot)\n        if saved_state and saved_state['rows'] == rows and saved_state['cols'] == cols:\n            print(\"正在恢复存档进度...\")\n            saved_shape = saved_state.get('shape_type', 'jigsaw')\n            if saved_shape != shape_type:\n                print(f\"⚠️ 警告：存档模式为 {saved_shape}，但当前为 {shape_type}，可能导致显示异常！\")\n            start_time = saved_state.get('start_time', time.time())\n            pieces_data_from_save = saved_state['pieces']\n            solved_positions_from_save = saved_state.get('solved_positions', {})\n\n            # ✅ 构建 id -> 保存数据 的字典\n            saved_map = {item['id']: item for item in pieces_data_from_save}\n\n            # ✅ 遍历原始图片数据，根据 id 查找对应的保存状态\n            for data in original_pieces_data:\n                piece_id = data['id']\n                if piece_id in saved_map:\n                    saved_data = saved_map[piece_id]\n                    piece_rect_x, piece_rect_y = saved_data['rect']\n                    solved = saved_data['solved']\n                else:\n                    # 如果没有保存数据（理论上不会发生），按新游戏处理\n                    area_row = len(puzzle_pieces) // cols\n                    area_col = len(puzzle_pieces) % cols\n                    start_x = 10 + area_col * area_piece_width + area_piece_width // 2 - piece_width // 2\n                    start_y = piece_area_start_y + area_row * area_piece_height + area_piece_height // 2 - piece_height // 2\n                    piece_rect_x, piece_rect_y = start_x, start_y\n                    solved = False\n\n                piece = PuzzlePiece(\n                    data['image'], data['row'], data['col'], data['id'],\n                    piece_rect_x, piece_rect_y\n                )\n                piece.solved = solved\n                puzzle_pieces.append(piece)\n\n            print(\"存档恢复完成。\")\n            load_saved = True\n\n\n    if not load_saved:\n        start_time = time.time()\n\n        # 创建索引列表并打乱\n        indices = list(range(len(original_pieces_data)))\n        random.shuffle(indices)  # 打乱顺序\n\n        for idx, original_idx in enumerate(indices):\n            data = original_pieces_data[original_idx]\n\n            area_row = idx // pieces_per_row_in_area\n            area_col = idx % pieces_per_row_in_area\n            start_x = 10 + area_col * area_piece_width + area_piece_width // 2 - piece_width // 2\n            start_y = piece_area_start_y + area_row * area_piece_height + area_piece_height // 2 - piece_height // 2\n\n            piece = PuzzlePiece(\n                data['image'], data['row'], data['col'], data['id'],\n                start_x, start_y\n            )\n            piece.solved = False\n            puzzle_pieces.append(piece)\n\n    # 8) 存档辅助\n    def get_pieces_save_data(pieces):\n        return [{'id': p.id, 'rect': (p.rect.x, p.rect.y), 'solved': p.solved} for p in pieces]\n\n    def get_solved_positions(pieces, target_areas_):\n        solved_map = {}\n        for piece in pieces:\n            if piece.solved:\n                center_point = piece.rect.center\n                for area in target_areas_:\n                    if area.rect.collidepoint(center_point):\n                        solved_map[area.grid_pos] = piece.id\n                        break\n        return solved_map\n\n    # 9) 游戏主循环\n    clock = pygame.time.Clock()\n    running = True\n\n    # --- 添加保存按钮 ---\n    font_small = load_font('zhengwen.ttf', 18)\n    #save_button = Button(SCREEN_WIDTH - 120, 10, 100, 40, \"保存游戏\", font_small)\n    save_img = os.path.join(\"assets\", 'images', 'buttons', \"save.png\")\n    #save_img = pygame.transform.scale(btn_w, btn_h)\n    return_img = os.path.join(\"assets\", 'images', 'buttons', \"return_to_menu.png\")\n    #return_img = pygame.transform.scale(btn_w, btn_h)\n\n    # save_img = os.path.join(\"src/assets/images/buttons/save.png\")\n    # return_img = os.path.join(\"src/assets/images/buttons/return_to_menu.png\")\n\n    # 设置按钮大小（像素）。如需与图片原始尺寸一致，可用 pygame.image.load 后读取尺寸。\n    btn_w, btn_h = 150, 80\n\n\n    # 将保存按钮放在左上角计时器下方\n    save_btn_x = 10\n    save_btn_y = 50 + font_small.get_height() + 8\n    save_button = Button(save_btn_x, save_btn_y, btn_w, btn_h, text=None, font=None, image=save_img, scale_factor=1.2)\n\n\n    # 返回按钮放在保存按钮下方\n    return_btn_x = save_btn_x\n    return_btn_y = save_btn_y + btn_h + 8\n    return_button = Button(return_btn_x, return_btn_y, btn_w, btn_h, text=None, font=None, image=return_img, scale_factor=1.2)\n\n    def _autosave_or_prompt():\n        \"\"\"用于 ESC/窗口关闭时保存：优先用当前 save_slot；否则弹出槽位选择。\"\"\"\n        nonlocal save_slot\n        if save_slot in [1, 2, 3]:\n            save_game_state(rows, cols,\n                            get_pieces_save_data(puzzle_pieces),\n                            start_time,\n                            get_solved_positions(puzzle_pieces, target_areas),\n                            shape_type=shape_type,  # ✅ 添加\n                            image_path = image_path,\n                            slot=save_slot)\n        else:\n            selected_slot = show_save_slot_selection(screen, \"选择保存位置\")\n            if selected_slot in [1, 2, 3]:\n                save_slot = selected_slot\n                save_game_state(rows, cols,\n                                get_pieces_save_data(puzzle_pieces),\n                                start_time,\n                                get_solved_positions(puzzle_pieces, target_areas),\n                                shape_type=shape_type,  # ✅ 添加\n                                image_path = image_path,\n                                slot=save_slot)\n\n    def show_full_image(image_path):\n        try:\n            img = Image.open(image_path)\n            img.show(title=\"拼图原图\")\n        except Exception as e:\n            print(f\"无法显示原图: {e}\")\n\n    while running:\n        mouse_pos = pygame.mouse.get_pos()\n        for event in pygame.event.get():\n            if event.type == pygame.QUIT:\n                _autosave_or_prompt()\n                return 'quit'\n\n            elif event.type == pygame.KEYDOWN and event.key == pygame.K_ESCAPE:\n                _autosave_or_prompt()\n                return 'menu'\n\n            elif event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:\n                if save_button.is_clicked(event):\n                    selected_slot = show_save_slot_selection(screen, \"选择保存位置\")\n                    if selected_slot in [1, 2, 3]:\n                        success = save_game_state(\n                            rows, cols,\n                            get_pieces_save_data(puzzle_pieces),\n                            start_time,\n                            get_solved_positions(puzzle_pieces, target_areas),\n                            shape_type=shape_type,  \n                            image_path=image_path, \n                            slot=selected_slot\n                        )\n                        if success:\n                            # 显示保存成功提示\n                            tip_font = load_font('zhengwen.ttf', 18)\n                            tip_text = tip_font.render(f\"已保存到槽 {selected_slot}\", True, (0, 255, 0))\n                            tip_rect = tip_text.get_rect(center=(SCREEN_WIDTH//2, SCREEN_HEIGHT - 30))\n                            screen.blit(tip_text, tip_rect)\n                            pygame.display.flip()\n                            pygame.time.delay(1000)  # 显示1秒\n                        else:\n                            print(f\"保存失败\")\n                    # 如果返回 'back' 或 'quit'，则不保存，返回游戏\n                    continue  # 避免触发拼图点击\n                elif return_button.is_clicked(event):\n                    # 直接返回主菜单（不自动保存），控制器会在 main.py 中收到 'menu'\n                    return 'menu'\n                # --- 检查缩略图点击 ---\n                elif thumbnail_rect and thumbnail_rect.collidepoint(event.pos):\n                    print(\"缩略图被点击，尝试显示原图...\")\n                    show_full_image(image_path)  # 调用显示原图函数\n\n                # 碎片拖拽\n                for piece in reversed(puzzle_pieces):\n                    if piece.rect.collidepoint(event.pos) and not piece.solved:\n                        puzzle_pieces.remove(piece)\n                        puzzle_pieces.append(piece)\n                        piece.start_drag(event.pos[0], event.pos[1])\n                        break\n\n            elif event.type == pygame.MOUSEBUTTONUP and event.button == 1:\n                for piece in puzzle_pieces:\n                    if piece.dragging:\n                        piece.stop_drag(target_areas, piece_area_rect)\n\n            elif event.type == pygame.MOUSEMOTION:\n                for piece in puzzle_pieces:\n                    piece.update_position(event.pos[0], event.pos[1])\n\n        for piece in puzzle_pieces:\n            if piece.solved and piece.id not in played_sound_for:\n                if correct_sound:\n                    correct_sound.play()\n                played_sound_for.add(piece.id)\n        # --- 绘制 ---\n        if background_image:\n            screen.blit(background_image, (0, 0))\n        else:\n            screen.fill(BACKGROUND_COLOR)\n        # 绘制底部碎片区域背景\n        pygame.draw.rect(screen, PIECE_BG_COLOR, piece_area_rect)\n        pygame.draw.line(screen, GRID_COLOR, (0, SCREEN_HEIGHT - PIECE_AREA_HEIGHT),\n                         (SCREEN_WIDTH, SCREEN_HEIGHT - PIECE_AREA_HEIGHT), 2)\n\n        if target_areas:\n            min_x = min(area.rect.x for area in target_areas)\n            min_y = min(area.rect.y for area in target_areas)\n            max_x = max(area.rect.right for area in target_areas)\n            max_y = max(area.rect.bottom for area in target_areas)\n            outline_rect = pygame.Rect(min_x, min_y, max_x - min_x, max_y - min_y)\n            pygame.draw.rect(screen, (0, 255, 0), outline_rect, width=3)\n\n        dragging_piece = None\n        for piece in puzzle_pieces:\n            if piece.dragging:\n                dragging_piece = piece\n            else:\n                in_piece_area = piece.rect.colliderect(piece_area_rect)\n                piece.draw(screen, in_piece_area=in_piece_area)\n        if dragging_piece:\n            in_piece_area = dragging_piece.rect.colliderect(piece_area_rect)\n            dragging_piece.draw(screen, in_piece_area=in_piece_area)\n\n        elapsed_time = int(time.time() - start_time) if start_time else 0\n        time_text = font_small.render(f\"时间: {elapsed_time}s\", True, TEXT_COLOR)\n        screen.blit(time_text, (10, 10))\n\n        save_button.draw(screen)\n        save_button.check_hover(mouse_pos)\n        return_button.draw(screen)\n        return_button.check_hover(mouse_pos)\n\n        # --- 绘制缩略图 ---\n        if thumbnail_image and thumbnail_rect:\n            screen.blit(thumbnail_image, thumbnail_rect)\n            # 可选：给缩略图加个边框\n            pygame.draw.rect(screen, (200, 200, 200), thumbnail_rect, 2)\n\n        pygame.display.flip()\n        clock.tick(60)\n\n        # 胜利判定（写入排行榜 + 胜利界面）\n        if all(p.solved for p in puzzle_pieces):\n            end_time = time.time()\n            total_time = int(end_time - start_time)\n\n            try:\n                image_id = _infer_image_id(image_path)\n                normalized_shape = _normalize_shape(shape_type)\n                difficulty = int(rows)\n\n                print(\"🎯 WIN detected ->\",\n                      f\"image={image_id}, diff={difficulty}, shape={normalized_shape}, elapsed={total_time}s\")\n\n                RankingManager().add_record(\n                    image=image_id,\n                    difficulty=difficulty,\n                    shape=normalized_shape,\n                    elapsed_sec=total_time\n                )\n            except Exception as e:\n                print(f\"⚠️ 写入排行榜失败（不影响游戏流程）: {e}\")\n\n            result = show_completion_screen(screen, total_time)\n\n            if result == 'restart':\n                # 再玩一次：清理当前槽位的存档（保持你原来的行为）\n                if save_slot in [1, 2, 3]:\n                    delete_save(save_slot)\n                return 'restart'\n            elif result == 'menu':\n                return 'menu'\n            elif result == 'quit':\n                return 'quit'",
      "original_issues": [
        {
          "file": "game_logic.py",
          "line": 132,
          "severity": "HIGH",
          "rule_id": "PY006",
          "message": "使用 pickle 反序列化存在安全风险。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 250,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'run_puzzle_game'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 268,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'run_puzzle_game'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 287,
          "severity": "HIGH",
          "rule_id": "PY100",
          "message": "使用了未定义的名称 'run_puzzle_game'。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 206,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 263,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 267,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 396,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 747,
          "severity": "MEDIUM",
          "rule_id": "PY202",
          "message": "在生成器上使用 max()，若序列为空会抛出 ValueError，建议加默认值。",
          "priority": "HIGH",
          "suggested_fix": "将 print 语句改为 print() 函数"
        },
        {
          "file": "game_logic.py",
          "line": 748,
          "severity": "MEDIUM",
          "rule_id": "PY202",
          "message": "在生成器上使用 max()，若序列为空会抛出 ValueError，建议加默认值。",
          "priority": "HIGH",
          "suggested_fix": "将 print 语句改为 print() 函数"
        },
        {
          "file": "game_logic.py",
          "line": 121,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 135,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 317,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 352,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 417,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 462,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 479,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 665,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 800,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 144,
          "severity": "LOW",
          "rule_id": "PY203",
          "message": "list.remove() 要求参数为列表中的元素，而非索引。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 715,
          "severity": "LOW",
          "rule_id": "PY203",
          "message": "list.remove() 要求参数为列表中的元素，而非索引。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_logic.py",
          "line": 8,
          "severity": "LOW",
          "rule_id": "B403",
          "message": "Consider possible security implications associated with pickle module.",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "start_screen_ui.py",
      "path": "fixed_files\\start_screen_ui.py",
      "fixed_content": "# ui/start_screen_ui.py\n\nimport pygame\nimport sys\nimport os\nimport time\nimport pickle\nfrom utils.font_loader import load_font\n\n# --- 添加项目根目录到 sys.path ---\nproject_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\nif project_root not in sys.path:\n    sys.path.insert(0, project_root)\n\n# --- 导入配置 ---\nfrom config import (\n    SCREEN_WIDTH, SCREEN_HEIGHT, PIECE_AREA_HEIGHT,\n    BACKGROUND_COLOR, GRID_COLOR, TEXT_COLOR,\n    SAVE_DIR, RANKING_DIR, CUSTOM_IMAGE_DIR,\n    FONT_PATHS, FONT_SIZES\n)\n\n# --- 确保必要的目录存在 ---\nos.makedirs(SAVE_DIR, exist_ok=True)\nos.makedirs(RANKING_DIR, exist_ok=True)\nos.makedirs(CUSTOM_IMAGE_DIR, exist_ok=True)\n\n# --- 定义多个存档文件路径 ---\nSAVE_SLOTS = {\n    1: os.path.join(SAVE_DIR, \"save1.pkl\"),\n    2: os.path.join(SAVE_DIR, \"save2.pkl\"),\n    3: os.path.join(SAVE_DIR, \"save3.pkl\")\n}\n\n# # --- 加载字体函数 ---\n# def load_font(size):\n#     for path in FONT_PATHS:\n#         if os.path.exists(path):\n#             try:\n#                 return pygame.font.Font(path, size)\n#             except pygame.error:\n#                 continue\n#     return pygame.font.SysFont(None, size)\n\n# --- 按钮类 ---\n# 替换整个 Button 类为下面内容\nclass Button:\n    def __init__(self, x, y, width, height, text=None, font=None, image=None, scale_factor=1.0):\n        \"\"\"\n        支持两种按钮：\n        - image: 提供图片路径或 pygame.Surface -> 显示图片（hover 时可放大）\n        - 不提供 image -> 绘制矩形+文字（灰色）\n        \"\"\"\n        self.rect = pygame.Rect(x, y, width, height)\n        self.text = text\n        self.font = font\n        self.color = (180, 180, 180)\n        self.hover_color = (150, 150, 150)\n        self.text_color = TEXT_COLOR\n        self.is_hovered = False\n        self.scale_factor = scale_factor\n\n        # 图片相关\n        self.image_path = image\n        self.image_surf = None      # 常规尺寸的图片 Surface（与 rect 大小一致）\n        self.hover_surf = None      # hover 时用的放大 Surface（如果 scale_factor != 1）\n\n        if image:\n            try:\n                # 支持直接传 Surface 或 传路径字符串\n                if isinstance(image, pygame.Surface):\n                    loaded = image\n                else:\n                    # 如果是相对路径，尽量以项目为基准加载\n                    img_path = image\n                    if not os.path.isabs(img_path):\n                        # project_root 在文件开头已经定义（如果没有可以直接移除这个分支）\n                        try:\n                            img_path = os.path.join(project_root, img_path)\n                        except Exception:\n                            pass\n                    loaded = pygame.image.load(img_path).convert_alpha()\n\n                # 准备常规尺寸表面（与 rect 一致）\n                self.image_surf = pygame.transform.smoothscale(loaded, (self.rect.width, self.rect.height))\n\n                # 准备 hover 表面（如果需要放大）\n                if self.scale_factor != 1.0:\n                    w = max(1, int(self.rect.width * self.scale_factor))\n                    h = max(1, int(self.rect.height * self.scale_factor))\n                    self.hover_surf = pygame.transform.smoothscale(loaded, (w, h))\n                else:\n                    self.hover_surf = self.image_surf\n\n                # debug 可选：取消下面注释查看加载信息\n                # print(f\"[DEBUG] 按钮图片加载成功: {image}\")\n            except Exception as e:\n                print(f\"[DEBUG] 按钮图片加载失败: {image} -> {e}\")\n                self.image_surf = None\n                self.hover_surf = None\n\n    def draw(self, surface):\n        \"\"\"\n        绘制按钮：\n        - 如果有图片：始终先绘制图片（非 hover 时绘制常规尺寸，hover 时绘制 hover_surf）\n        - 如果没有图片：绘制矩形 + 文字（hover 切换颜色）\n        \"\"\"\n        if self.image_surf:\n            # 有图片：正常显示图片（hover 时显示放大图片，且居中）\n            if self.is_hovered and self.hover_surf != None and self.hover_surf != self.image_surf:\n                hw, hh = self.hover_surf.get_size()\n                surface.blit(self.hover_surf, (self.rect.centerx - hw // 2, self.rect.centery - hh // 2))\n            else:\n                # 直接把预先缩放好的 image_surf blit 到 rect（不会遮盖背景）\n                surface.blit(self.image_surf, self.rect)\n        else:\n            # 没有图片：画一个矩形 + 文字\n            color = self.hover_color if self.is_hovered else self.color\n            pygame.draw.rect(surface, color, self.rect, border_radius=8)\n            if self.text and self.font:\n                text_surf = self.font.render(self.text, True, self.text_color)\n                surface.blit(\n                    text_surf,\n                    (self.rect.centerx - text_surf.get_width() // 2,\n                     self.rect.centery - text_surf.get_height() // 2)\n                )\n\n    def check_hover(self, mouse_pos):\n        self.is_hovered = self.rect.collidepoint(mouse_pos)\n\n    def is_clicked(self, event):\n        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:\n            return self.rect.collidepoint(event.pos)\n        return False\n\n\n# --- 存档管理函数 ---\ndef get_save_info(slot):\n    \"\"\"\n    获取某个存档的基本信息（用于显示在UI上）\n    \"\"\"\n    save_path = SAVE_SLOTS.get(slot)\n    if os.path.exists(save_path):\n        try:\n            with open(save_path, 'rb') as f:\n                state = pickle.load(f)\n            return {\n                'exists': True,\n                'rows': state['rows'],\n                'cols': state['cols'],\n                'timestamp': state.get('timestamp', '未知时间'),\n                'game_mode': state.get('game_mode', '未知模式')  \n            }\n        except:\n            return {'exists': False}\n    return {'exists': False}\n\ndef delete_save(slot):\n    save_path = SAVE_SLOTS.get(slot)\n    if save_path and os.path.exists(save_path):\n        try:\n            os.remove(save_path)\n            print(f\"Deleted save slot {slot}\")\n            return True\n        except OSError as e:\n            print(f\"Failed to delete save {slot}: {e}\")\n            return False\n    return False\n\ndef show_save_slot_selection(screen, title=\"选择存档槽\"):\n    \"\"\"\n    显示存档槽选择界面，包含加载和删除按钮。\n    返回: 'quit', 'back', 或 1, 2, 3 (表示加载的槽位)\n    \"\"\"\n    font_large = load_font('zhengwen.ttf', 64)\n    font_small = load_font('zhengwen.ttf', 16)\n    font_medium = load_font('zhengwen.ttf', 36)\n\n    # 加载背景图片\n    background_image_path = 'src/assets/images/startScreen_backgroundImage.png'\n    if os.path.exists(background_image_path):\n        background_image = pygame.image.load(background_image_path).convert()\n        background_image = pygame.transform.scale(background_image, (SCREEN_WIDTH, SCREEN_HEIGHT))\n    else:\n        print(\"Background image not found!\")\n        background_image = None\n\n    screen.blit(background_image, (0, 0))\n\n\n    #screen.fill(BACKGROUND_COLOR)\n    title_text = font_large.render(title, True, TEXT_COLOR)\n    screen.blit(title_text, (SCREEN_WIDTH // 2 - title_text.get_width() // 2, 80))\n\n    # 存储所有按钮的列表 (按钮对象, 关联的操作或槽位)\n    buttons = [] \n    # 存储删除按钮，方便单独处理\n    delete_buttons = {}\n\n    y_start = 150\n    y_spacing = 70\n    slot_button_width = 300\n    slot_button_x = SCREEN_WIDTH // 2 - slot_button_width // 2\n    delete_button_width = 80\n    delete_button_x = slot_button_x + slot_button_width + 20 # 删除按钮在槽位按钮右侧\n\n    for i in range(1, 4):\n        info = get_save_info(i) # 确保 get_save_info 函数可用\n        if info['exists']:\n            text = f\"存档 {i}: {info['rows']}x{info['cols']}  {info['timestamp']}\"\n        else:\n            text = f\"存档 {i}: 空\"\n        \n        # 创建加载/选择存档的按钮\n        slot_btn = Button(slot_button_x, y_start + i * y_spacing, slot_button_width, 50, text, font_small)\n        buttons.append((slot_btn, i))\n        \n        # 如果存档存在，创建对应的删除按钮\n        if info['exists']:\n             del_btn = Button(delete_button_x, y_start + i * y_spacing, delete_button_width, 50, \"删除\", font_small)\n             buttons.append((del_btn, f\"del_{i}\")) # 使用特殊标识符\n             delete_buttons[i] = del_btn # 也可以用字典映射\n\n    back_button = Button(SCREEN_WIDTH // 2 - 100, 500, 200, 50, \"返回\", font_medium)\n    buttons.append((back_button, 'back'))\n\n    running = True\n    while running:\n        mouse_pos = pygame.mouse.get_pos()\n        for event in pygame.event.get():\n            \n            if event.type == pygame.QUIT:\n                return 'quit'  \n\n            # --- 检查所有按钮的点击 ---\n            for btn, action in buttons:\n                btn.check_hover(mouse_pos)\n                if btn.is_clicked(event):\n                    if action == 'back':\n                        return 'back'\n                    elif isinstance(action, int): # 加载存档\n                        return action \n                    elif isinstance(action, str) and action.startswith(\"del_\"): # 删除存档\n                        slot_to_delete = int(action.split(\"_\")[1])\n                        # 调用删除函数 (确保 delete_save 可用)\n                        if delete_save(slot_to_delete): \n                            print(f\"存档 {slot_to_delete} 已删除。\")\n                            # 重新加载界面以更新显示\n                            return show_save_slot_selection(screen, title) # 递归调用自身刷新\n                        else:\n                            print(f\"删除存档 {slot_to_delete} 失败。\")\n                        # 如果不希望递归刷新，可以在这里重新生成按钮列表和信息\n                        # 但递归刷新更简单直接\n                        \n        # --- 绘制 ---\n        #screen.fill(BACKGROUND_COLOR)\n        screen.blit(title_text, (SCREEN_WIDTH // 2 - title_text.get_width() // 2, 80))\n        for btn, _ in buttons:\n            btn.draw(screen)\n        pygame.display.flip()\n\n    # 不建议走到这里\n    return 'back'\n\n\n# --- 开始界面（第二部分）---\ndef show_start_screen(screen, audio_manager=None):\n    \"\"\"\n    显示游戏开始前的难度和模式选择界面。\n    返回: rows, cols, False, 'play' 或 None, None, False, 'menu'/'quit'\n    \"\"\"\n\n    # 加载背景图片\n    background_image_path = 'src/assets/images/startScreen_backgroundImage.png'\n    if os.path.exists(background_image_path):\n        background_image = pygame.image.load(background_image_path).convert()\n        background_image = pygame.transform.scale(background_image, (SCREEN_WIDTH, SCREEN_HEIGHT))\n    else:\n        print(\"Background image not found!\")\n        background_image = None\n\n    screen.blit(background_image, (0, 0))\n\n    font_large = load_font('zhengwen.ttf', 64)\n    font_medium = load_font('zhengwen.ttf', 36)\n\n    #screen.fill(BACKGROUND_COLOR)\n    title_text = font_large.render(\"智慧拼图\", True, TEXT_COLOR)\n\n    # 难度级别列表\n    difficulties = [\"3x3 难度\", \"4x4 难度\", \"5x5 难度\"]\n    current_difficulty_index = 0\n\n    left_button = Button(SCREEN_WIDTH // 2 - 170 - 80, SCREEN_HEIGHT // 2 - 75, 80, 50, \"<\", font_medium)\n    right_button = Button(SCREEN_WIDTH // 2 + 170, SCREEN_HEIGHT // 2 - 75, 80, 50, \">\", font_medium)\n\n    # 模式选择列表 (当前UI未完全实现模式切换逻辑)\n    styles = [\"三角形\", \"正方形\", \"凹凸形\"]\n    current_style_index = 2\n\n    left_button_style = Button(SCREEN_WIDTH // 2 - 170 - 80, SCREEN_HEIGHT // 2 + 10, 80, 50, \"<\", font_medium)\n    right_button_style = Button(SCREEN_WIDTH // 2 + 170, SCREEN_HEIGHT // 2 + 10, 80, 50, \">\", font_medium)\n\n    start_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2 + 110, 200, 50, \"开始游戏\", font_medium)\n    quit_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2 + 180, 200, 50, \"返回菜单\", font_medium)\n    setting_button = Button(SCREEN_WIDTH // 2 - 100, SCREEN_HEIGHT // 2 + 250, 200, 50, \"自定义拼图\", font_medium)\n\n    buttons = [left_button, right_button, left_button_style, right_button_style, start_button, quit_button, setting_button]\n\n    running = True\n    while running:\n        mouse_pos = pygame.mouse.get_pos()\n        for event in pygame.event.get():\n            if event.type == pygame.QUIT:\n                return None, None, False, 'quit'\n            # 难度选择\n            if left_button.is_clicked(event) and current_difficulty_index > 0:\n                current_difficulty_index -= 1\n            if right_button.is_clicked(event) and current_difficulty_index < len(difficulties) - 1:\n                current_difficulty_index += 1\n            # 模式选择 (当前UI未完全实现模式切换逻辑)\n            if left_button_style.is_clicked(event) and current_style_index > 0:\n                current_style_index -= 1\n            if right_button_style.is_clicked(event) and current_style_index < len(styles) - 1:\n                current_style_index += 1\n\n            if start_button.is_clicked(event):\n                rows, cols = map(int, (difficulties[current_difficulty_index].split(' ')[0]).split('x'))\n                if current_style_index == 0:\n                    return rows, cols, False, 'play', 'triangle'\n                elif current_style_index == 1:\n                    return rows, cols, False, 'play', 'rectangle'\n                else:\n                    return rows, cols, False, 'play', 'jigsaw'\n                \n            if quit_button.is_clicked(event):\n                return None, None, False, 'menu', None\n            if setting_button.is_clicked(event):\n                return None, None, False, 'setting', None\n            \n        screen.blit(background_image, (0, 0))\n\n        #screen.fill(BACKGROUND_COLOR)\n        screen.blit(title_text, (SCREEN_WIDTH // 2 - title_text.get_width() // 2, SCREEN_HEIGHT // 8))\n\n        # 显示当前选择的难度\n        selected_difficulty_text = font_medium.render(f\"选择: {difficulties[current_difficulty_index]}\", True, TEXT_COLOR)\n        screen.blit(selected_difficulty_text, (SCREEN_WIDTH // 2 - selected_difficulty_text.get_width() // 2, SCREEN_HEIGHT // 2 - 70))\n\n        # 显示当前选择的模式 (当前UI未完全实现模式切换逻辑)\n        selected_style_text = font_medium.render(f\"选择: {styles[current_style_index]}\", True, TEXT_COLOR)\n        screen.blit(selected_style_text, (SCREEN_WIDTH // 2 - selected_style_text.get_width() // 2, SCREEN_HEIGHT // 2 + 15))\n\n        for button in buttons:\n            button.check_hover(mouse_pos)\n            button.draw(screen)\n\n        pygame.display.flip()\n\n    # 理论上不会走到这里\n    return None, None, False, 'menu'\n\n\n",
      "original_issues": [
        {
          "file": "start_screen_ui.py",
          "line": 146,
          "severity": "HIGH",
          "rule_id": "PY006",
          "message": "使用 pickle 反序列化存在安全风险。",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 110,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 110,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 80,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 97,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 154,
          "severity": "LOW",
          "rule_id": "PY010",
          "message": "使用裸 except，建议捕获具体异常类型。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 162,
          "severity": "LOW",
          "rule_id": "PY203",
          "message": "list.remove() 要求参数为列表中的元素，而非索引。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 7,
          "severity": "LOW",
          "rule_id": "B403",
          "message": "Consider possible security implications associated with pickle module.",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "start_screen_ui.py",
          "line": 80,
          "severity": "LOW",
          "rule_id": "B110",
          "message": "Try, Except, Pass detected.",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "image_manager.py",
      "path": "fixed_files\\image_manager.py",
      "fixed_content": "import os\nfrom config import CUSTOM_IMAGE_DIR as custom_image_dir\n\nclass ImageManager:\n    def __init__(self):\n        self.library = {\n            \"自然风光\": {\n                \"scenery_001\": {\n                    \"path\": \"assets/nature/scenery_001.jpg\",\n                    \"thumbnail\": \"assets/nature/thumb_scenery_001.png\"\n                }\n            },\n            \"自定义\": {}\n        }\n        self.load_custom_images()\n\n    def load_custom_images(self):\n        if not os.path.exists(custom_image_dir):\n            os.makedirs(custom_image_dir)\n            return\n\n        for file in os.listdir(custom_image_dir):\n            if file.lower().endswith(('jpg', 'jpeg', 'png', 'bmp')):\n                name = os.path.splitext(file)[0]\n                key = f\"custom_{name}\"\n                self.library[\"自定义\"][key] = {\n                    \"path\": os.path.join(custom_image_dir, file),\n                    \"thumbnail\": os.path.join(custom_image_dir, f\"thumb_{file}\")\n                }\n\n    def get_categories(self):\n        return list(self.library.keys())\n\n    def get_images_in_category(self, category):\n        return self.library.get(category, {})\n",
      "original_issues": [
        {
          "file": "image_manager.py",
          "line": 3,
          "severity": "HIGH",
          "rule_id": "PL-no-name-in-module",
          "message": "No name 'CUSTOM_IMAGE_DIR' in module 'config'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "puzzle_editor.py",
      "path": "fixed_files\\puzzle_editor.py",
      "fixed_content": "\"\"\"\n拼图编辑器 - 核心功能模块\n负责业务逻辑，驱动 UI 模块。\n\"\"\"\n\nimport json\nimport os\nimport uuid\nfrom PIL import Image, ImageOps\nimport sys\n\n# --- 核心逻辑类 ---\nclass PuzzleEditor:\n    \"\"\"拼图编辑器核心逻辑\"\"\"\n    def __init__(self, main_screen, audio_manager=None):\n        \"\"\"\n        初始化编辑器核心\n        :param main_screen: 主程序的 Pygame screen 对象\n        \"\"\"\n        self.image = None\n        self.puzzle_id = None\n        self.puzzle_shape = \"方形\"  # 默认形状\n        self.order = 3\n        self.main_screen = main_screen # 保存主屏幕引用\n        self.ui = None # UI 实例将在 run_editor 中创建\n        self.running = True # 控制 UI 循环是否继续\n        # 预览区尺寸 (与 puzzle_editor_ui.py 中保持一致)\n        self.preview_size = min(400, 700 - 80) # SCREEN_HEIGHT=700, 80是上下边距\n\n        # --- 新增/修改的属性 ---\n        # 预览区的最大尺寸限制 (宽, 高)\n        self.max_preview_size = (600, 600)\n        # 预览区的实际尺寸 (初始为最大尺寸，后续会根据图片调整)\n        self.preview_size = self.max_preview_size\n\n        # --- 新增/修改的属性 ---\n        # 预览区的最大尺寸限制 (宽, 高)\n        self.max_preview_size = (600, 600)\n        # 预览区的实际尺寸 (初始为最大尺寸，后续会根据图片调整)\n        self.preview_size = self.max_preview_size\n        self.audio_manager = audio_manager\n\n    def run_editor(self):\n        \"\"\"启动编辑器 UI\"\"\"\n        # 导入 UI 模块 (避免循环导入)\n        try:\n            from ui.puzzle_editor_ui import PuzzleEditorUI\n        except ImportError:\n             # 如果直接运行此文件，尝试添加父目录到路径\n            sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n            from ui.puzzle_editor_ui import PuzzleEditorUI\n\n        print(\"【信息】启动拼图编辑器...\")\n        self.ui = PuzzleEditorUI(self.main_screen, self) # 创建 UI 实例并传入 self\n        self.ui.run() # 启动 UI 循环\n        print(\"【信息】拼图编辑器已关闭。\")\n\n    def return_to_menu(self):\n        \"\"\"\n        UI 回调：返回主菜单\n        退出当前编辑器 UI，控制权交还给主程序。\n        \"\"\"\n        print(\"【UI 回调】返回主菜单...\")\n        self.running = False  # ✅ 关键：停止 UI 循环\n    # 注意：self.ui.run() 循环结束后，会自动返回到 run_editor() 的下一行\n\n    # --- UI 回调方法 (供 UI 模块调用) ---\n    def on_ui_quit(self):\n        \"\"\"当 UI 触发退出时调用\"\"\"\n        self.running = False\n        print(\"【信息】UI 请求退出。\")\n\n    def load_image_ui(self):\n        \"\"\"UI 触发的加载图片操作\"\"\"\n        print(\"【UI 回调】加载图片...\")\n        # 使用 Tkinter 打开文件对话框\n        # 注意：这会阻塞 Pygame 事件循环，但这是 Tkinter 的常见用法\n        from tkinter import filedialog, Tk\n        root = Tk()\n        root.withdraw() # 隐藏主窗口\n        file_path = filedialog.askopenfilename(\n            title=\"选择图片\",\n            filetypes=[(\"Image files\", \"*.png *.jpg *.jpeg *.bmp *.gif\")]\n        )\n        root.destroy()\n        if file_path:\n            success = self._load_image_internal(file_path)\n            if success:\n                self._clear_state_after_image_load()\n                print(f\"【信息】图片加载成功: {file_path}\")\n                # 通知 UI 更新预览区尺寸\n                if self.ui:\n                     self.ui.on_image_loaded()\n            else:\n                print(\"【错误】图片加载失败\")\n\n    # --- 修改后的UI回调方法 ---\n    def setup_puzzle_ui(self):\n        \"\"\"UI 触发的设置拼图操作（合并后的新按钮）\"\"\"\n        print(\"【UI 回调】设置拼图形状和数量...\")\n        status = self.get_status()\n        if not status[\"has_image\"]:\n            print(\"【警告】请先导入图片\")\n            return\n\n        from tkinter import simpledialog, Tk, Toplevel, StringVar, Button, Label, OptionMenu\n        root = Tk()\n        root.withdraw()\n\n        # 步骤1: 选择形状\n        shape_window = Toplevel(root)\n        shape_window.title(\"选择拼图形状\")\n        shape_window.geometry(\"300x150\")\n        shape_window.resizable(False, False)\n\n        shape_var = StringVar(shape_window)\n        shape_var.set(\"方形\")  # 默认值\n\n        Label(shape_window, text=\"请选择拼图形状:\").pack(pady=10)\n        shape_menu = OptionMenu(shape_window, shape_var, \"方形\", \"三角形\", \"不规则\")\n        shape_menu.pack(pady=5)\n\n        def on_shape_selected():\n            selected_shape = shape_var.get()\n            shape_window.destroy()\n\n            # 步骤2: 输入阶数/数量\n            count_window = Toplevel(root)\n            count_window.title(\"输入拼图阶数\")\n            count_window.geometry(\"300x150\")\n            count_window.resizable(False, False)\n\n            count_var = StringVar(count_window)\n\n            label_text = f\"请输入{selected_shape}拼图阶数（3-5）：\"\n            min_val, max_val = 3, 5\n\n            Label(count_window, text=label_text).pack(pady=10)\n            entry = simpledialog.Entry(count_window, textvariable=count_var)\n            entry.pack(pady=5)\n            entry.focus()\n\n            def on_count_enter(event=None): # 支持回车确认\n                try:\n                    count = int(count_var.get())\n                    if min_val <= count <= max_val:\n                        count_window.destroy()\n                        root.destroy()\n                        self.puzzle_shape = selected_shape\n                        self.order = count\n                        print(f\"【信息】已创建 {selected_shape} 拼图, 参数: {count}\")\n                    else:\n                         print(f\"【警告】输入值超出范围 ({min_val}-{max_val})\")\n                         count_window.destroy()\n                         root.destroy()\n                except ValueError:\n                    print(\"【警告】请输入有效的数字\")\n                    count_window.destroy()\n                    root.destroy()\n\n            entry.bind('<Return>', on_count_enter)\n            Button(count_window, text=\"确定\", command=on_count_enter).pack(pady=5)\n\n            count_window.grab_set() # 模态窗口\n            count_window.wait_window() # 等待窗口关闭\n\n        Button(shape_window, text=\"下一步\", command=on_shape_selected).pack(pady=10)\n\n        shape_window.grab_set() # 模态窗口\n        shape_window.wait_window() # 等待窗口关闭\n\n    def save_settings_ui(self):\n        \"\"\"UI 触发的保存设置操作\"\"\"\n        print(\"【UI 回调】保存设置...\")\n        status = self.get_status()\n        if not status[\"has_image\"]:\n            print(\"【警告】请先设置拼图\")\n            return\n\n        result = self._save_settings_internal()\n        if result:\n            puzzle_id, save_dir = result\n            print(f\"【信息】拼图设置已保存，ID: {puzzle_id}\")\n            # 可以在这里添加 UI 反馈，例如弹出消息框\n            # 但通常由 UI 模块处理，这里只是打印日志\n        else:\n            print(\"【错误】拼图设置保存失败\")\n\n    # --- 内部核心逻辑方法 ---\n    def _load_image_internal(self, image_path):\n        \"\"\"内部加载图片逻辑，并自适应预览区尺寸和比例\"\"\"\n        try:\n            original_image = Image.open(image_path)\n\n            # 1. 先将图片缩放到最大尺寸限制内，保持宽高比\n            original_image.thumbnail(self.max_preview_size, Image.Resampling.LANCZOS)\n\n            # 2. 根据缩放后的图片尺寸，计算预览区的实际尺寸 (保持图片宽高比)\n            img_width, img_height = original_image.size\n            max_width, max_height = self.max_preview_size\n\n            # 计算宽高比\n            img_ratio = img_width / img_height\n            max_ratio = max_width / max_height\n\n            # 根据图片宽高比和最大区域宽高比，确定最终预览区尺寸\n            if img_ratio > max_ratio:\n                # 图片更宽，以宽度为准\n                final_width = max_width\n                final_height = int(max_width / img_ratio)\n            else:\n                # 图片更高或相等，以高度为准\n                final_height = max_height\n                final_width = int(max_height * img_ratio)\n\n            # 更新预览区尺寸\n            self.preview_size = (final_width, final_height)\n\n            # 3. 将图片调整到最终的预览区尺寸 (可能需要轻微拉伸以精确匹配)\n            #    如果希望严格保持比例，可以使用 fit 并添加背景色\n            #    这里我们选择 resize 以完全填充预览区\n            self.image = original_image.resize(self.preview_size, Image.Resampling.LANCZOS)\n            # 或者使用 fit 来保持比例并填充 (需要指定填充颜色)\n            # self.image = ImageOps.fit(original_image, self.preview_size, Image.Resampling.LANCZOS, centering=(0.5, 0.5))\n            # ImageOps.fit 会裁剪图片，可能不是用户想要的。resize 会轻微拉伸但保证完全填充。\n            # 这里我们选择 resize。\n\n            return True\n        except Exception as e:\n            print(f\"【错误】无法加载或调整图片: {e}\")\n            return False\n\n    def _clear_state_after_image_load(self):\n        \"\"\"加载图片后重置状态\"\"\"\n        # 注意：不要重置 self.preview_size，因为它现在由图片决定\n        self.puzzle_id = None\n        self.puzzle_shape = \"方形\"\n\n    def get_preview_image(self, width, height):\n        \"\"\"获取整体预览图 (供 UI 调用)\"\"\"\n        # 注意：UI 应该直接使用 self.preview_size 获取尺寸，而不是传入 width, height\n        # 这里为了兼容性保留参数，但实际使用 self.image 的尺寸\n        if self.image:\n             return self.image.copy() # UI 会根据 self.image.size 来调整显示\n        return None\n\n    def _save_settings_internal(self, base_dir=\"assets/custom\"):\n        \"\"\"内部保存拼图设置逻辑\"\"\"\n        if not self.image:\n            print(\"【警告】没有拼图设置可保存\")\n            return None\n\n        # 生成唯一ID\n        self.puzzle_id = str(uuid.uuid4())[:8]\n\n        # 创建保存目录\n        save_dir = os.path.join(base_dir, self.puzzle_id)\n        if not os.path.exists(save_dir):\n            os.makedirs(save_dir)\n\n        # 保存设置信息\n        settings = {\n            \"id\": self.puzzle_id,\n            \"shape\": self.puzzle_shape,\n            \"order\": self.order\n        }\n\n        # 保存经过调整后的图片 (适应预览区尺寸和比例)\n        adjusted_image_path = os.path.join(save_dir, \"original.png\")\n        # self.image 是经过 resize 处理后的图像\n        self.image.save(adjusted_image_path, \"PNG\")\n        settings[\"image_path\"] = adjusted_image_path # 保存调整后的图片路径\n\n        # 保存设置文件\n        settings_path = os.path.join(save_dir, \"settings.json\")\n        with open(settings_path, \"w\", encoding=\"utf-8\") as f:\n            json.dump(settings, f, ensure_ascii=False, indent=4)\n\n        print(f\"【信息】拼图设置已保存至: {save_dir}\")\n        return self.puzzle_id, save_dir\n\n    def get_status(self):\n        \"\"\"获取编辑器状态 (供 UI 调用)\"\"\"\n        return {\n            \"has_image\": self.image != None,\n            \"image\": self.image,\n            \"puzzle_id\": self.puzzle_id,\n            \"puzzle_shape\": self.puzzle_shape,\n            \"order\": self.order,\n            \"preview_size\": self.preview_size # 新增：向UI提供预览区尺寸\n        }",
      "original_issues": [
        {
          "file": "puzzle_editor.py",
          "line": 9,
          "severity": "HIGH",
          "rule_id": "PL-import-error",
          "message": "Unable to import 'PIL'",
          "priority": "CRITICAL",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "puzzle_editor.py",
          "line": 285,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "puzzle_editor.py",
          "line": 229,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "game_ui.py",
      "path": "fixed_files\\game_ui.py",
      "fixed_content": "# ui/game_ui.py\nimport pygame\nfrom utils.font_loader import load_font\nfrom config import SCREEN_WIDTH, SCREEN_HEIGHT\nimport os\n\n# 获取当前文件所在目录（src/ui）\ncurrent_dir = os.path.dirname(os.path.abspath(__file__))\nassets_dir = os.path.join(os.path.dirname(current_dir), 'assets')\n\n\nclass Button:\n    \"\"\"通用按钮类，支持图片悬停缩放\"\"\"\n    def __init__(self, x, y, width, height, image=None, scale_factor=1.2):\n        self.rect = pygame.Rect(x, y, width, height)\n        self.image = image\n        self.is_hovered = False\n        self.scale_factor = scale_factor\n\n    def draw(self, surface):\n        if self.image:\n            scale = self.scale_factor if self.is_hovered else 1\n            scaled_width = int(self.rect.width * scale)\n            scaled_height = int(self.rect.height * scale)\n            scaled_image = pygame.transform.smoothscale(self.image, (scaled_width, scaled_height))\n            scaled_rect = scaled_image.get_rect(center=self.rect.center)\n            surface.blit(scaled_image, scaled_rect)\n\n    def check_hover(self, pos):\n        self.is_hovered = self.rect.collidepoint(pos)\n\n    def is_clicked(self, event):\n        return event.type == pygame.MOUSEBUTTONDOWN and event.button == 1 and self.rect.collidepoint(event.pos)\n\n\nclass GameUI:\n    def __init__(self, screen):\n        self.font_small = load_font('zhengwen.ttf', 40)\n        # self.font_large = load_font('zhengwen', 24)\n        # self.font_medium = load_font('zhengwen', 36)\n\n        # 按钮配置\n        button_width, button_height = 150, 40\n        self.button_spacing = 20\n        self.start_y = 150  # 起始 Y 位置（避开顶部信息）\n        self.x_offset = 40  # 按钮居中于左侧区域\n\n        # 加载按钮图片（只加载 normal 状态）\n        self.btn_gameSettings_img = self.load_button_image('gameSettings_normal.png')\n        self.btn_home_img = self.load_button_image('home_normal.png')\n        self.btn_hint_img = self.load_button_image('hint_normal.png')\n        self.btn_restart_img = self.load_button_image('restart_normal.png')\n\n        # 创建按钮实例（位置将在 draw 时更新）\n        self.btn_gameSettings = Button(0, 0, button_width, button_height, self.btn_gameSettings_img, scale_factor=1.2)\n        self.btn_home = Button(0, 0, button_width, button_height, self.btn_home_img, scale_factor=1.2)\n        self.btn_hint = Button(0, 0, button_width, button_height, self.btn_hint_img, scale_factor=1.2)\n        self.btn_restart = Button(0, 0, button_width, button_height, self.btn_restart_img, scale_factor=1.2)\n\n        self.buttons = [\n            self.btn_gameSettings,\n            self.btn_home,\n            self.btn_hint,\n            self.btn_restart\n        ]\n\n    def load_button_image(self, filename):\n        \"\"\"安全加载按钮图片\"\"\"\n        image_path = os.path.join(assets_dir, 'images', 'buttons', filename)\n        if os.path.exists(image_path):\n            return pygame.image.load(image_path).convert_alpha()\n        else:\n            print(f\"⚠️ 按钮图片未找到: {image_path}\")\n            # 返回一个占位图（红色方块）\n            placeholder = pygame.Surface((60, 60), pygame.SRCALPHA)\n            pygame.draw.rect(placeholder, (255, 0, 0), (5, 5, 50, 50))\n            return placeholder\n\n    def draw_game_screen(self, screen, pieces, target_areas, original_image, time_elapsed, moves, callbacks=None):\n        \"\"\"\n        主游戏界面绘制\n        callbacks: {'gameSettings': func, 'home': func, 'hint': func, 'restart': func}\n        使用位于'src/assets/images/gameBackground_v1.png'的背景图，并调整其大小以适应屏幕尺寸。\n        \"\"\"\n        if callbacks == None:\n            callbacks = {}\n\n        # 获取屏幕尺寸\n        screen_width, screen_height = screen.get_size()\n\n        # 加载背景图片\n        background_image_path = os.path.join(assets_dir, 'images', 'gameBackground_v1.png')\n\n        # 先检查文件是否存在\n        if not os.path.exists(background_image_path):\n            print(f\"❌ 背景图片未找到: {background_image_path}\")\n            print(f\"🔍 当前工作目录: {os.getcwd()}\")\n            print(f\"📦 assets_dir 路径: {assets_dir}\")\n            screen.fill((0, 220, 220))  # 蓝色背景表示错误\n        else:\n            try:\n                bg_surface = pygame.image.load(background_image_path)\n                # 额外检查是否真的加载成功\n                if bg_surface.get_size() == (0, 0):\n                    raise ValueError(\"图像为空\")\n                # 缩放并绘制\n                background_image = pygame.transform.scale(bg_surface, (screen_width, screen_height))\n                screen.blit(background_image, (0, 0))\n                print(f\"✅ 成功加载背景图: {background_image_path}\")  # 调试用，可删\n            except Exception as e:\n                print(f\"⚠️ 加载背景图片失败: {e}\")\n                screen.fill((0, 220, 220))\n\n        # === 游戏主区域绘制 ===\n        piece_area_rect = pygame.Rect(0, screen.get_height() - 200, screen.get_width(), 200)\n        pygame.draw.rect(screen, (240, 240, 240), piece_area_rect)\n        pygame.draw.line(screen, (100, 100, 100), (0, piece_area_rect.y), (screen.get_width(), piece_area_rect.y), 2)\n\n        for area in target_areas:\n            pygame.draw.rect(screen, (100, 100, 100), area['rect'], 2)\n\n        dragging = None\n        for p in pieces:\n            if p.dragging:\n                dragging = p\n            else:\n                in_area = p.rect.colliderect(piece_area_rect)\n                p.draw(screen, in_area)\n\n        if dragging:\n            in_area = dragging.rect.colliderect(piece_area_rect)\n            dragging.draw(screen, in_area)\n\n        # === 左上角信息 ===\n        time_text = self.font_small.render(f\"时间: {time_elapsed}s\", True, (0, 0, 0))\n        tip_text1 = self.font_small.render(\"←→: 旋转  ↑↓: 镜像\", True, (0, 0, 0))\n        screen.blit(tip_text1, (10, 30))\n\n        # move_text = self.font_small.render(f\"步数: {moves}\", True, (0, 0, 0))\n        screen.blit(time_text, (10, 10))\n        # screen.blit(move_text, (10, 50))\n\n        # === 右上角缩略图 ===\n        if original_image:\n            thumb = pygame.transform.smoothscale(original_image, (100, 100))\n            screen.blit(thumb, (screen.get_width() - 110, 10))\n\n        # === 左侧悬浮按钮组 ===\n        self._position_buttons(screen)  # 动态定位按钮\n        mouse_pos = pygame.mouse.get_pos()\n        for button in self.buttons:\n            button.check_hover(mouse_pos)\n            button.draw(screen)\n\n        pygame.display.flip()\n\n        # 事件处理（建议在主循环中做，但这里提供参考）\n        self.handle_button_clicks(callbacks)\n\n    def _position_buttons(self, screen):\n        \"\"\"动态设置按钮位置，确保适配屏幕\"\"\"\n        for i, button in enumerate(self.buttons):\n            y = self.start_y + i * (button.rect.height + self.button_spacing)\n            button.rect.x = self.x_offset\n            button.rect.y = y\n\n    def handle_button_clicks(self, callbacks=None):\n        \"\"\"处理按钮点击事件（可由主循环调用）\"\"\"\n        events = pygame.event.get()\n        for event in events:\n            if event.type == pygame.QUIT:\n                pygame.event.post(event)  # 重新放回事件队列\n                return\n\n            for button, key in zip(self.buttons, ['gameSettings', 'home', 'hint', 'restart']):\n                if button.is_clicked(event):\n                    # 如果有回调就执行（保持兼容性）\n                    if callbacks and key in callbacks:\n                        callbacks[key]()\n                    # 返回按钮名称，让控制器决定后续行为\n                    return key  # 例如返回 'home'\n                \n        return None\n\n        # 如果还有未处理的事件，放回队列\n        if events:\n            pygame.event.post(events[-1])\n\n    def show_completion_screen(self, screen, total_time):\n    \n        congrats = self.font_large.render(\"🎉 恭喜完成！\", True, (0, 0, 0))\n        time_text = self.font_medium.render(f\"用时: {total_time} 秒\", True, (0, 0, 0))\n        screen.blit(congrats, (screen.get_width()//2 - congrats.get_width()//2, screen.get_height()//3))\n        screen.blit(time_text, (screen.get_width()//2 - time_text.get_width()//2, screen.get_height()//3 + 60))\n        pygame.display.flip()\n        pygame.time.wait(2000)",
      "original_issues": [
        {
          "file": "game_ui.py",
          "line": 85,
          "severity": "MEDIUM",
          "rule_id": "AST002",
          "message": "疑似使用 'is' 进行值比较，建议使用 '==' （is 仅用于 None/True/False）。",
          "priority": "HIGH",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "game_ui.py",
          "line": 110,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "save_manager.py",
      "path": "fixed_files\\save_manager.py",
      "fixed_content": "import os\nimport json\n\nSAVE_FILE = \"saves/current.json\"\n\ndef save_game_state(state):\n    os.makedirs(os.path.dirname(SAVE_FILE), exist_ok=True)\n    try:\n        with open(SAVE_FILE, 'w', encoding='utf-8') as f:\n            json.dump(state, f, indent=2)\n        print(\"game saved\")\n    except (IOError, ValueError) as e:\n        print(f\"save failed: {e}\")\n\ndef load_game_state():\n    if not os.path.exists(SAVE_FILE):\n        print(\"no save file\")\n        return None\n    try:\n        with open(SAVE_FILE, 'r', encoding='utf-8') as f:\n            return json.load(f)\n    except (IOError, ValueError) as e:\n        print(f\"load failed: {e}\")\n        return None\n",
      "original_issues": [
        {
          "file": "save_manager.py",
          "line": 13,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "save_manager.py",
          "line": 23,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "generate_jigsaw_mask.py",
      "path": "fixed_files\\generate_jigsaw_mask.py",
      "fixed_content": "# game/generate_jigsaw_mask.py\n\"\"\"\n使用 PIL 生成锯齿状拼图遮罩并切割图像，修改为可返回 Pygame Surface。\n\"\"\"\n\nfrom PIL import Image, ImageDraw, ImageOps\nimport os\nimport pygame # 新增导入\n\nclass PuzzlePiece:\n    \"\"\"代表单个拼图块\"\"\"\n    def __init__(self, image, row, col, num_pieces, bbox=None):\n        self.image = image\n        self.original_image = image.copy()\n        # 存储在原始图像中的边界框 (left, upper, right, lower)\n        self.bbox = bbox if bbox else (0, 0, image.width, image.height)\n        self.row = row\n        self.col = col\n        self.num_pieces = num_pieces\n        self.rotation = 0  # 0, 90, 180, 270\n        self.flipped = False\n\n    def rotate(self):\n        \"\"\"顺时针旋转90度\"\"\"\n        self.rotation = (self.rotation + 90) % 360\n        self.image = self.original_image.rotate(self.rotation, expand=True)\n        if self.flipped:\n            self.image = ImageOps.mirror(self.image)\n\n    def flip(self):\n        \"\"\"水平翻转\"\"\"\n        self.flipped = not self.flipped\n        self.image = self.original_image.rotate(self.rotation, expand=True)\n        if self.flipped:\n            self.image = ImageOps.mirror(self.image)\n\n    def reset(self):\n        \"\"\"重置变换\"\"\"\n        self.rotation = 0\n        self.flipped = False\n        self.image = self.original_image.copy()\n\n    def _create_square_puzzle_pieces(self, num_pieces):\n        \"\"\"创建方形拼图块\"\"\"\n        if not self.image:\n            return\n\n        width, height = self.image.size\n        piece_width = width // num_pieces\n        piece_height = height // num_pieces\n\n        self.pieces = []\n        for i in range(num_pieces):\n            for j in range(num_pieces):\n                left = j * piece_width\n                top = i * piece_height\n                right = min((j + 1) * piece_width, width)  # 确保不超出边界\n                bottom = min((i + 1) * piece_height, height)\n\n                piece = self.image.crop((left, top, right, bottom))\n                # 对于方形，bbox 是基于规则网格的\n                puzzle_piece = PuzzlePiece(piece, i, j, num_pieces, bbox=(left, top, right, bottom))\n                self.pieces.append(puzzle_piece)\n\n    def _create_triangle_puzzle_pieces(self, num_pieces):\n        \"\"\"创建三角形拼图块 (简化版)\"\"\"\n        if not self.image:\n            return\n\n        width, height = self.image.size\n        self.pieces = []\n\n        # 分割成方形，然后切成三角形\n        square_size = min(width, height) // num_pieces\n        rows = height // square_size\n        cols = width // square_size\n\n        piece_index = 0\n        for i in range(rows):\n            for j in range(cols):\n                left = j * square_size\n                top = i * square_size\n                right = min(left + square_size, width)\n                bottom = min(top + square_size, height)\n\n                square_piece = self.image.crop((left, top, right, bottom))\n                square_width, square_height = square_piece.size\n\n                # 创建两个三角形 (左上和右下)\n                # 左上三角形\n                mask = Image.new('L', (square_width, square_height), 0)\n                draw = ImageDraw.Draw(mask)\n                draw.polygon([(0, 0), (square_width, 0), (0, square_height)], fill=255)\n                triangle1 = Image.new('RGBA', (square_width, square_height))\n                triangle1.paste(square_piece, (0, 0), mask)\n                bbox1 = mask.getbbox()\n                if bbox1:\n                    # 调整bbox到原始图像坐标\n                    abs_bbox1 = (left + bbox1[0], top + bbox1[1], left + bbox1[2], top + bbox1[3])\n                    triangle1 = triangle1.crop(bbox1)\n                    puzzle_piece1 = PuzzlePiece(triangle1, i, j, num_pieces, bbox=abs_bbox1)\n                    self.pieces.append(puzzle_piece1)\n\n                # 右下三角形\n                mask = Image.new('L', (square_width, square_height), 0)\n                draw = ImageDraw.Draw(mask)\n                draw.polygon([(square_width, square_height), (square_width, 0), (0, square_height)], fill=255)\n                triangle2 = Image.new('RGBA', (square_width, square_height))\n                triangle2.paste(square_piece, (0, 0), mask)\n                bbox2 = mask.getbbox()\n                if bbox2:\n                    # 调整bbox到原始图像坐标\n                    abs_bbox2 = (left + bbox2[0], top + bbox2[1], left + bbox2[2], top + bbox2[3])\n                    triangle2 = triangle2.crop(bbox2)\n                    puzzle_piece2 = PuzzlePiece(triangle2, i, j, num_pieces, bbox=abs_bbox2)\n                    self.pieces.append(puzzle_piece2)\n\n                piece_index += 2\n\n\ndef gen_jigsaw_mask(size, tab_size, top, bottom, left, right):\n    \"\"\"生成单个拼图块的遮罩\"\"\"\n    mask = Image.new('L', size, 0)\n    draw = ImageDraw.Draw(mask)\n    w, h = size\n    # 主体矩形\n    draw.rectangle([tab_size, tab_size, w-tab_size, h-tab_size], fill=255)\n    # 上边\n    if top == \"tab\":\n        draw.ellipse([w//2-tab_size//2, tab_size//2, w//2+tab_size//2, tab_size+tab_size//2], fill=255)\n    elif top == \"slot\":\n        draw.ellipse([w//2-tab_size//2, tab_size//2, w//2+tab_size//2, tab_size + tab_size//2], fill=0)\n    # 下边\n    if bottom == \"tab\":\n        draw.ellipse([w//2-tab_size//2, h-tab_size-tab_size//2, w//2+tab_size//2, h-tab_size//2], fill=255)\n    elif bottom == \"slot\":\n        draw.ellipse([w//2-tab_size//2, h-tab_size-tab_size//2, w//2+tab_size//2, h-tab_size//2], fill=0)\n    # 左边\n    if left == \"tab\":\n        draw.ellipse([tab_size//2, h//2-tab_size//2, tab_size+tab_size//2, h//2+tab_size//2], fill=255)\n    elif left == \"slot\":\n        draw.ellipse([tab_size//2, h//2-tab_size//2, tab_size+tab_size//2, h//2+tab_size//2], fill=0)\n    # 右边\n    if right == \"tab\":\n        draw.ellipse([w-tab_size-tab_size//2, h//2-tab_size//2, w-tab_size//2, h//2+tab_size//2], fill=255)\n    elif right == \"slot\":\n        draw.ellipse([w-tab_size-tab_size//2, h//2-tab_size//2, w-tab_size//2, h//2+tab_size//2], fill=0)\n    return mask\n\ndef get_edge_type(row, col, rows, cols, edge):\n    \"\"\"根据行列和边缘确定是 'tab', 'slot' 还是 'flat'\"\"\"\n    # 四边界为flat，其余按行列偶奇决定凹凸\n    if edge == \"top\":\n        return \"flat\" if row == 0 else (\"tab\" if col % 2 == 0 else \"slot\")\n    if edge == \"bottom\":\n        return \"flat\" if row == rows-1 else (\"tab\" if col % 2 == 1 else \"slot\")\n    if edge == \"left\":\n        return \"flat\" if col == 0 else (\"tab\" if row % 2 == 0 else \"slot\")\n    if edge == \"right\":\n        return \"flat\" if col == cols-1 else (\"tab\" if row % 2 == 1 else \"slot\")\n    return \"flat\"\n\ndef split_image_with_jigsaw_mask(img_path, rows, cols, out_dir=\"output_pieces\", return_surfaces=False):\n    \"\"\"\n    切割图像并生成锯齿状拼图块。\n    :param img_path: 原始图像路径\n    :param rows: 行数\n    :param cols: 列数\n    :param out_dir: 输出目录 (仅在 return_surfaces=False 时使用)\n    :param return_surfaces: 是否返回 Pygame Surface 列表而不是保存文件\n    :return: 如果 return_surfaces 为 True，则返回包含 {'image', 'row', 'col', 'id'} 字典的列表；否则返回 None。\n    \"\"\"\n    try:\n        img = Image.open(img_path).convert(\"RGBA\")\n    except Exception as e:\n        print(f\"打开图片失败 {img_path}: {e}\")\n        # 如果无法打开图片，直接返回\n        if return_surfaces:\n            return [] # 返回空列表，表示没有生成任何碎片\n        else:\n            return # 直接返回 None\n        \n    w, h = img.size\n    piece_w, piece_h = w // cols, h // rows\n    tab_size = min(piece_w, piece_h) // 4  # 凸起/凹陷高度\n\n    if not return_surfaces:\n        os.makedirs(out_dir, exist_ok=True)\n        \n    surfaces = [] if return_surfaces else None\n\n    for row in range(rows):\n        for col in range(cols):\n            # 遮照区域（留凸起空间）\n            mask_size = (piece_w + tab_size * 2, piece_h + tab_size * 2)\n            # 生成遮照\n            top = get_edge_type(row, col, rows, cols, \"top\")\n            bottom = get_edge_type(row, col, rows, cols, \"bottom\")\n            left = get_edge_type(row, col, rows, cols, \"left\")\n            right = get_edge_type(row, col, rows, cols, \"right\")\n            mask = gen_jigsaw_mask(mask_size, tab_size, top, bottom, left, right)\n            \n            # 裁剪原图对应区域\n            crop_left = col * piece_w - tab_size\n            crop_top = row * piece_h - tab_size\n            crop_box = (\n                max(crop_left, 0),\n                max(crop_top, 0),\n                min(crop_left + mask_size[0], w),\n                min(crop_top + mask_size[1], h)\n            )\n            piece_img = Image.new(\"RGBA\", mask_size, (0,0,0,0))\n            try:\n                crop_img = img.crop(crop_box)\n                paste_x = max(0, -crop_left)\n                paste_y = max(0, -crop_top)\n                piece_img.paste(crop_img, (paste_x, paste_y))\n            except Exception as e:\n                print(f\"裁剪图片时出错 (row={row}, col={col}): {e}\")\n                # 可以选择跳过这个碎片或创建一个空白的\n                # 这里我们继续，让遮罩决定最终外观\n                \n            # 遮照应用\n            piece_img.putalpha(mask)\n            \n            if return_surfaces:\n                try:\n                    # 转换为 Pygame Surface\n                    mode = piece_img.mode\n                    size = piece_img.size\n                    data = piece_img.tobytes()\n                    pygame_surface = pygame.image.fromstring(data, size, mode)\n                    surfaces.append({\n                        'image': pygame_surface,\n                        'row': row,\n                        'col': col,\n                        'id': row * cols + col\n                    })\n                except Exception as e:\n                    print(f\"转换为 Pygame Surface 时出错 (row={row}, col={col}): {e}\")\n                    # 可以选择跳过或添加一个默认的 Surface\n            else:\n                fname = f\"piece_{row}_{col}.png\"\n                try:\n                    piece_img.save(os.path.join(out_dir, fname))\n                    print(f\"Saved {fname}\")\n                except Exception as e:\n                    print(f\"保存图片失败 {fname}: {e}\")\n\n    if return_surfaces:\n        return surfaces\n    # 如果 return_surfaces 为 False，函数执行到这里自然结束，等同于 return None\n    # 显式写出 return 也是可以的，但不是必须的\n    return # 或者省略这行\n\ndef draw_jigsaw_outline_on_image(image, rows, cols, outline_color=(255, 0, 0, 255), output_path=None):\n    \"\"\"\n    在原图上绘制拼图切割轮廓线，直观展示拼图块的锯齿边界。\n    :param img_path: 原始图像路径\n    :param rows: 拼图行数\n    :param cols: 拼图列数\n    :param outline_color: 轮廓线颜色 (R, G, B, A)，RGBA\n    :param output_path: 输出图像路径，若为 None 则不保存\n    :return: 带轮廓线的 PIL Image 对象\n    \"\"\"\n    try:\n        # 确保图像是 RGBA 模式以便处理透明度\n        img = image.convert(\"RGBA\")\n    except Exception as e:\n        print(f\"处理输入的 PIL 图像失败: {e}\")\n        return None\n\n    w, h = img.size\n    piece_w, piece_h = w // cols, h // rows\n    tab_size = min(piece_w, piece_h) // 6  # 凸起/凹陷大小\n\n    # 创建一个透明图层用于绘制轮廓\n    outline_layer = Image.new(\"RGBA\", img.size, (0, 0, 0, 0))\n    draw = ImageDraw.Draw(outline_layer)\n\n    def draw_bump_line(x0, y0, x1, y1, direction, is_tab):\n        \"\"\"绘制带凸起或凹陷的线段（水平或垂直）\"\"\"\n        cx, cy = (x0 + x1) // 2, (y0 + y1) // 2\n        r = tab_size\n\n        if direction == \"horizontal\":\n            if is_tab:\n                # 凸起：向上半圆\n                draw.arc([cx - r, y0 - r, cx + r, y0 + r], start=0, end=180, fill=outline_color)\n                draw.line([x0, y0, cx - r, y0], fill=outline_color)\n                draw.line([cx + r, y0, x1, y0], fill=outline_color)\n            else:\n                # 凹陷：向下挖半圆\n                draw.arc([cx - r, y1 - r, cx + r, y1 + r], start=180, end=360, fill=outline_color)\n                draw.line([x0, y1, cx - r, y1], fill=outline_color)\n                draw.line([cx + r, y1, x1, y1], fill=outline_color)\n        elif direction == \"vertical\":\n            if is_tab:\n                # 凸起：向右半圆\n                draw.arc([x1 - r, cy - r, x1 + r, cy + r], start=90, end=270, fill=outline_color)\n                draw.line([x1, y0, x1, cy - r], fill=outline_color)\n                draw.line([x1, cy + r, x1, y1], fill=outline_color)\n            else:\n                # 凹陷：向左挖半圆\n                draw.arc([x0 - r, cy - r, x0 + r, cy + r], start=-90, end=90, fill=outline_color)\n                draw.line([x0, y0, x0, cy - r], fill=outline_color)\n                draw.line([x0, cy + r, x0, y1], fill=outline_color)\n\n    for row in range(rows):\n        for col in range(cols):\n            x = col * piece_w\n            y = row * piece_h\n            right = x + piece_w\n            bottom = y + piece_h\n\n            # 获取四边类型\n            top_type = get_edge_type(row, col, rows, cols, \"top\")\n            bottom_type = get_edge_type(row, col, rows, cols, \"bottom\")\n            left_type = get_edge_type(row, col, rows, cols, \"left\")\n            right_type = get_edge_type(row, col, rows, cols, \"right\")\n\n            # # 上边（水平线，y = y）\n            # if row == 0 or top_type != \"flat\":\n            #     if top_type == \"tab\":\n            #         draw_bump_line(x, y, right, y, \"horizontal\", True)\n            #     elif top_type == \"slot\":\n            #         draw_bump_line(x, y, right, y, \"horizontal\", False)\n            #     else:\n            #         draw.line([x, y, right, y], fill=outline_color)\n\n            # 下边（水平线，y = bottom）\n            if row == rows - 1 or bottom_type != \"flat\":\n                if bottom_type == \"tab\":\n                    draw_bump_line(x, bottom, right, bottom, \"horizontal\", True)\n                elif bottom_type == \"slot\":\n                    draw_bump_line(x, bottom, right, bottom, \"horizontal\", False)\n                else:\n                    draw.line([x, bottom, right, bottom], fill=outline_color)\n\n            # 左边（垂直线，x = x）\n            if col == 0 or left_type != \"flat\":\n                if left_type == \"tab\":\n                    draw_bump_line(x, y, x, bottom, \"vertical\", True)\n                elif left_type == \"slot\":\n                    draw_bump_line(x, y, x, bottom, \"vertical\", False)\n                else:\n                    draw.line([x, y, x, bottom], fill=outline_color)\n\n            # # 右边（垂直线，x = right）\n            # if col == cols - 1 or right_type != \"flat\":\n            #     if right_type == \"tab\":\n            #         draw_bump_line(right, y, right, bottom, \"vertical\", True)\n            #     elif right_type == \"slot\":\n            #         draw_bump_line(right, y, right, bottom, \"vertical\", False)\n            #     else:\n            #         draw.line([right, y, right, bottom], fill=outline_color)\n\n    # 合并原图与轮廓图层\n    result = Image.alpha_composite(img, outline_layer)\n\n    if output_path:\n        result.save(output_path)\n        print(f\"轮廓图已保存至: {output_path}\")\n\n    return result\n\n\n\n\n",
      "original_issues": [
        {
          "file": "generate_jigsaw_mask.py",
          "line": 175,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "generate_jigsaw_mask.py",
          "line": 218,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "generate_jigsaw_mask.py",
          "line": 239,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "generate_jigsaw_mask.py",
          "line": 247,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "generate_jigsaw_mask.py",
          "line": 269,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "image_editor.py",
      "path": "fixed_files\\image_editor.py",
      "fixed_content": "import pygame\nfrom tkinter import Tk, filedialog\nfrom PIL import Image, ImageTk\nfrom utils.font_loader import load_font\nfrom data.image_manager import ImageManager\nimport os\nfrom config import CUSTOM_IMAGE_DIR\n\ndef prompt_file():\n    \"\"\"打开文件选择对话框\"\"\"\n    top = Tk()\n    top.withdraw()  # 隐藏主窗口\n    file_path = filedialog.askopenfilename(parent=top)\n    top.destroy()\n    return file_path\n\ndef show_image_editor(screen):\n    font = load_font('medium')\n    manager = ImageManager()\n\n    clock = pygame.time.Clock()\n    while True:\n        screen.fill((220, 220, 220))\n        title = font.render(\"🖼️ 自定义图片\", True, (0, 0, 0))\n        screen.blit(title, (screen.get_width()//2 - title.get_width()//2, 50))\n\n        instructions = font.render(\"点击下方按钮选择图片\", True, (100, 100, 100))\n        screen.blit(instructions, (screen.get_width()//2 - instructions.get_width()//2, 150))\n\n        select_btn = pygame.Rect(350, 250, 200, 50)\n        pygame.draw.rect(screen, (180, 180, 180), select_btn)\n        select_text = font.render(\"选择图片\", True, (0, 0, 0))\n        screen.blit(select_text, select_text.get_rect(center=select_btn.center))\n\n        back_btn = pygame.Rect(350, 500, 200, 50)\n        pygame.draw.rect(screen, (180, 180, 180), back_btn)\n        back_text = font.render(\"返回\", True, (0, 0, 0))\n        screen.blit(back_text, back_text.get_rect(center=back_btn.center))\n\n        for event in pygame.event.get():\n            if event.type == pygame.QUIT:\n                return 'quit'\n            if event.type == pygame.MOUSEBUTTONDOWN:\n                if select_btn.collidepoint(event.pos):\n                    # 打开文件选择器\n                    file_path = prompt_file()\n                    if file_path and os.path.exists(file_path):\n                        # 复制文件到自定义目录\n                        dest = os.path.join(CUSTOM_IMAGE_DIR, os.path.basename(file_path))\n                        with open(dest, 'wb') as f_dest, open(file_path, 'rb') as f_src:\n                            f_dest.write(f_src.read())\n                        # 更新ImageManager中的数据\n                        manager.load_custom_images()\n                        # 显示缩略图\n                        try:\n                            image = Image.open(dest)\n                            image.thumbnail((100, 100))\n                            thumb_path = os.path.splitext(dest)[0] + \"_thumb.png\"\n                            image.save(thumb_path)\n                            print(f\"成功导入图片: {os.path.basename(file_path)}\")\n                        except (OSError, IOError) as e:\n                            print(f\"无法处理图片: {e}\")\n                elif back_btn.collidepoint(event.pos):\n                    return 'menu'\n\n        pygame.display.flip()\n        clock.tick(60)\n",
      "original_issues": [
        {
          "file": "image_editor.py",
          "line": 62,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "puzzle_editor_ui.py",
      "path": "fixed_files\\puzzle_editor_ui.py",
      "fixed_content": "\"\"\"\n拼图编辑器 - Pygame UI 模块\n负责 UI 渲染和事件处理，由核心逻辑驱动。\n\"\"\"\n\nimport pygame\nfrom tkinter import Tk\nfrom PIL import Image\nfrom utils.font_loader import load_font\nimport os\nfrom game.generate_jigsaw_mask import draw_jigsaw_outline_on_image\n\n# --- 导入配置 ---\ntry:\n    import config\n    SCREEN_WIDTH = config.SCREEN_WIDTH\n    SCREEN_HEIGHT = config.SCREEN_HEIGHT\n    PIECE_AREA_HEIGHT = config.PIECE_AREA_HEIGHT\n    BACKGROUND_COLOR = config.BACKGROUND_COLOR\n    GRID_COLOR = config.GRID_COLOR\n    TEXT_COLOR = config.TEXT_COLOR\n    HIGHLIGHT_COLOR = config.HIGHLIGHT_COLOR\nexcept ImportError:\n    print(\"【警告】未找到 config.py，使用默认配置。\")\n    # --- 默认 UI 配置 ---\n    SCREEN_WIDTH = 900\n    SCREEN_HEIGHT = 700\n    PIECE_AREA_HEIGHT = 200\n    BACKGROUND_COLOR = (220, 220, 220)\n    GRID_COLOR = (100, 110, 120)  # Corrected color value\n    TEXT_COLOR = (0, 0, 0)\n    HIGHLIGHT_COLOR = (255, 0, 0)\n\n# ✅ 关键修复：检查逻辑层是否要求退出\n# 如果 editor_logic.running 变为 False，则退出 UI 循环\nif not self.editor_logic.running:\n    return False\n\ndef draw_image_to_surface(image, surface):\n    \"\"\"将 PIL Image 绘制到 Pygame Surface\"\"\"\n    surface.fill(PIECE_BG_COLOR)\n    if image:\n        # PIL 图像尺寸\n        img_width, img_height = image.size\n        surf_width, surf_height = surface.get_size()\n\n        # 如果尺寸不匹配，进行缩放以适应 Surface (保持比例)\n        if (img_width, img_height) != (surf_width, surf_height):\n            # 使用 thumbnail 确保图片适应Surface且不超出\n            image = image.copy()  # 避免修改原始图片\n            image.thumbnail((surf_width, surf_height), Image.Resampling.LANCZOS)\n            img_width, img_height = image.size  # 更新缩放后的尺寸\n\n        # 转换为 Pygame Surface\n        try:\n            if image.mode != 'RGBA':\n                image = image.convert('RGBA')\n\n            mode = image.mode\n            size = image.size\n            data = image.tobytes()\n\n            pygame_image = pygame.image.fromstring(data, size, mode)\n\n            x = (surf_width - img_width) // 2\n            y = (surf_height - img_height) // 2\n\n            surface.blit(pygame_image, (x, y))\n\n        except Exception as e:\n            print(f\"【错误】将 PIL Image 转换为 Pygame Surface 时出错: {e}\")\n            import traceback\n            traceback.print_exc()  # 打印完整的错误堆栈，便于调试\n            surface.fill((255, 0, 0))  # 用红色填充表示错误\n\n    else:\n        surface.fill(PIECE_BG_COLOR)\n\nclass PuzzleEditorUI:\n    def __init__(self, screen, editor_logic):\n        self.screen = screen\n        self.editor_logic = editor_logic\n        self.buttons = []\n        self.init_buttons()\n\n    def init_buttons(self):\n        # 初始化按钮列表，这里仅作示例\n        actions_map = {\n            0: self.editor_logic.load_image_ui,\n            1: self.editor_logic.setup_puzzle_ui,\n            2: self.editor_logic.save_settings_ui,\n            3: self.editor_logic.return_to_menu,  # 调用 return_to_menu\n        }\n        for i in range(4):\n            button = Button(self.screen, (i * 100 + 50, 600), actions_map[i])\n            self.buttons.append(button)\n\n    def handle_events(self, event):\n        if event.type == pygame.MOUSEBUTTONDOWN:\n            for button in self.buttons:\n                if button.is_hovered():\n                    button.action()\n\n    def draw(self):\n        # 绘制背景图或纯色背景\n        if self.background_image:\n            self.screen.blit(self.background_image, (0, 0))\n        else:\n            self.screen.fill(BACKGROUND_COLOR)\n\n        # 不再绘制标题文字 \"拼图编辑器\"\n\n        # 绘制说明文字（使用 zhengwen.ttf, 36）\n        status = self.editor_logic.get_status()\n        if not status[\"has_image\"]:\n            instruction = font_size.render(\"请先导入图片\", True, TEXT_COLOR)\n            self.screen.blit(instruction, (20, self.preview_rect.bottom + 10))\n        else:\n            id_text = status['puzzle_id'] if status['puzzle_id'] else '未保存'\n            shape_text = status['puzzle_shape']\n            instruction = font_size.render(f\"ID: {id_text} | 形状: {shape_text}\", True, TEXT_COLOR)\n            self.screen.blit(instruction, (20, self.preview_rect.bottom + 10))\n\n        # 绘制预览区\n        if self.background_image:\n            self.screen.blit(self.background_image, (0, 0))\n        else:\n            self.screen.fill(BACKGROUND_COLOR)\n\n        # 绘制按钮（无文字）\n        for button in self.buttons:\n            button.draw()\n\n        pygame.display.flip()\n",
      "original_issues": [
        {
          "file": "puzzle_editor_ui.py",
          "line": 350,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "ranking_ui.py",
      "path": "fixed_files\\ranking_ui.py",
      "fixed_content": "# ui/ranking_ui.py\nimport os\nimport json\nimport pygame\nfrom utils.font_loader import load_font\nfrom data.ranking_manager import RankingManager\nfrom data.image_manager import ImageManager\nfrom config import RANKING_DIR, SCREEN_WIDTH, SCREEN_HEIGHT, CUSTOM_IMAGE_DIR\n\n# ===== 按钮类（保留你朋友的视觉交互）=====\nclass Button:\n    def __init__(self, x, y, width, height, image=None):\n        self.rect = pygame.Rect(x, y, width, height)\n        self.image = image\n        self.is_hovered = False\n        self.scale_factor = 1.2\n\n    def draw(self, surface):\n        if self.image:\n            scale = self.scale_factor if self.is_hovered else 1\n            sw = int(self.rect.width * scale)\n            sh = int(self.rect.height * scale)\n            scaled = pygame.transform.smoothscale(self.image, (sw, sh))\n            r = scaled.get_rect(center=self.rect.center)\n            surface.blit(scaled, r)\n\n    def check_hover(self, pos):\n        self.is_hovered = self.rect.collidepoint(pos)\n\n    def is_clicked(self, event):\n        return event.type == pygame.MOUSEBUTTONDOWN and event.button == 1 and self.rect.collidepoint(event.pos)\n\n\ndef create_horizontal_button_layout(screen_width, screen_height, button_count, button_width, button_height, spacing):\n    total_width = button_count * button_width + (button_count - 1) * spacing\n    start_x = (screen_width - total_width) // 2\n    start_y = screen_height - button_height - 80\n    return [(start_x + i * (button_width + spacing), start_y) for i in range(button_count)]\n\n\n# ===== 小工具 =====\ndef _safe_index_next(seq, cur):\n    if not seq:\n        return cur\n    try:\n        i = seq.index(cur)\n        return seq[(i + 1) % len(seq)]\n    except ValueError:\n        return seq[0]\n\n\ndef _normalize_shape(shape_str: str) -> str:\n    if not shape_str:\n        return \"jigsaw\"\n    m = {\n        \"square\": \"rectangle\", \"rectangle\": \"rectangle\", \"正方形\": \"rectangle\", \"方形\": \"rectangle\",\n        \"triangle\": \"triangle\", \"三角形\": \"triangle\",\n        \"irregular\": \"jigsaw\", \"jigsaw\": \"jigsaw\", \"不规则\": \"jigsaw\", \"凹凸形\": \"jigsaw\"\n    }\n    return m.get(str(shape_str).lower(), \"jigsaw\")\n\n\n# 中文展示名\nSHAPE_ZH = {\n    \"rectangle\": \"正方形\",\n    \"triangle\": \"三角形\",\n    \"jigsaw\": \"凹凸形\",\n}\n\ndef _shape_to_zh(shape_key: str) -> str:\n    return SHAPE_ZH.get(_normalize_shape(shape_key), \"凹凸形\")\n\n\ndef _is_custom_image(image_id: str):\n    \"\"\"是否编辑器自制拼图：src/assets/custom/<image_id>/settings.json 存在\"\"\"\n    folder = os.path.join(CUSTOM_IMAGE_DIR, image_id)\n    settings_path = os.path.join(folder, \"settings.json\")\n    if os.path.exists(settings_path):\n        try:\n            with open(settings_path, \"r\", encoding=\"utf-8\") as f:\n                js = json.load(f)\n            order = int(js.get(\"order\", 3))\n            shape = _normalize_shape(js.get(\"shape\", \"jigsaw\"))\n            return True, order, shape\n        except Exception:\n            return True, None, None\n    return False, None, None\n\n\ndef _filter_default_from_images(images):\n    \"\"\"如果除了 default 还有其他图片，则去掉 default；否则保留 default 作为占位。\"\"\"\n    others = [x for x in images if x != \"default\"]\n    return others if others else images\n\n\ndef show_ranking(screen, audio_manager=None):\n    font_medium = load_font('zhengwen.ttf', 36)\n    font_small  = load_font('zhengwen.ttf', 24)\n\n    rm = RankingManager()\n    image_manager = ImageManager()  # 先留着，便于后续扩展\n\n    # 背景\n    bg_path = 'src/assets/images/ranking_backgroundImage.png'\n    background_image = None\n    if os.path.exists(bg_path):\n        background_image = pygame.image.load(bg_path).convert()\n        background_image = pygame.transform.scale(background_image, (SCREEN_WIDTH, SCREEN_HEIGHT))\n\n    # 初始候选集合\n    present = rm.get_all_values()\n    images = _filter_default_from_images(present.get(\"images\", []) or [\"default\"])\n    diffs  = sorted(present.get(\"difficulties\", [3, 4, 5]) or [3, 4, 5])\n    shapes = present.get(\"shapes\", [\"jigsaw\", \"triangle\", \"rectangle\"]) or [\"jigsaw\", \"triangle\", \"rectangle\"]\n\n    # 初始选择\n    current_image = images[0]\n    current_difficulty = f\"{diffs[0]}x{diffs[0]}\"\n    current_shape = shapes[0]\n\n    # 自制锁定\n    difficulty_locked = False\n    shape_locked = False\n\n    def apply_lock_for_image(img_id: str):\n        nonlocal current_difficulty, current_shape, difficulty_locked, shape_locked\n        is_custom, order, shp = _is_custom_image(img_id)\n        if is_custom and order and shp:\n            current_difficulty = f\"{int(order)}x{int(order)}\"\n            current_shape = _normalize_shape(shp)\n            difficulty_locked = True\n            shape_locked = True\n        else:\n            difficulty_locked = False\n            shape_locked = False\n\n    apply_lock_for_image(current_image)\n\n    clock = pygame.time.Clock()\n\n    # 资源目录\n    cur_dir = os.path.dirname(os.path.abspath(__file__))\n    assets_dir = os.path.normpath(os.path.join(cur_dir, '..', 'assets'))\n\n    # 按钮（沿用原美术：第5个按钮现在做“删除当前图片记录”）\n    button_data = [\n        {\"image\": \"switch_image_normal.png\"},      # 0 切换图片\n        {\"image\": \"switch_difficulty_normal.png\"}, # 1 切换难度\n        {\"image\": \"switch_shape_normal.png\"},      # 2 切换形状\n        {\"image\": \"back_normal.png\"},              # 3 返回\n        {\"image\": \"refresh_normal.png\"}            # 4 删除（功能改为删除当前图片的所有记录）\n    ]\n\n    BUTTON_WIDTH  = 150\n    BUTTON_HEIGHT = 80\n    SPACING       = 30\n\n    btn_positions = create_horizontal_button_layout(\n        SCREEN_WIDTH, SCREEN_HEIGHT, len(button_data), BUTTON_WIDTH, BUTTON_HEIGHT, SPACING\n    )\n\n    buttons = []\n    for i, data in enumerate(button_data):\n        x, y = btn_positions[i]\n        image_path = os.path.join(\"src\", \"assets\", 'images', 'buttons', data[\"image\"])\n        print(f\"Loading button image: {image_path}\")\n        if not os.path.exists(image_path):\n            print(f\"⚠️ 文件不存在: {image_path}\")\n            button_img = None\n        else:\n            button_img = pygame.image.load(image_path)\n        buttons.append(Button(x, y, BUTTON_WIDTH, BUTTON_HEIGHT, button_img))\n\n    TOP_N = 5  # 仅显示前5条\n\n    # 删除当前图片的所有记录，并前进到下一张\n    def delete_current_image_records():\n        nonlocal images, current_image, current_difficulty, current_shape\n        # 使用 RankingManager 的内部数据进行删除并保存\n        try:\n            rm._data = [r for r in rm._data if r.get(\"image\") != current_image]  # 直接操作内部列表\n            rm._save()\n        except Exception as e:\n            print(f\"删除失败: {e}\")\n\n        # 刷新候选\n        present2 = rm.get_all_values()\n        new_images = _filter_default_from_images(present2.get(\"images\", []) or [\"default\"])\n\n        # 如果当前图片已不在列表，顺延到下一张\n        if current_image not in new_images:\n            images = new_images or [\"default\"]\n            current_image = images[0]\n            # 重新根据图片决定锁定\n            apply_lock_for_image(current_image)\n        else:\n            images = new_images\n\n        # 同步难度/形状候选（一般不需要，但保险起见）\n        diffs2  = sorted(present2.get(\"difficulties\", diffs) or diffs)\n        shapes2 = present2.get(\"shapes\", shapes) or shapes\n        # 如果锁定则不变，否则保持现有或回退到候选首位\n        if not difficulty_locked:\n            try:\n                cur_num = int(current_difficulty.split('x')[0])\n                if cur_num not in diffs2:\n                    current_difficulty = f\"{diffs2[0]}x{diffs2[0]}\"\n            except Exception:\n                current_difficulty = f\"{diffs2[0]}x{diffs2[0]}\"\n        if not shape_locked:\n            if current_shape not in shapes2:\n                current_shape = shapes2[0]\n\n    while True:\n        # 背景\n        if background_image:\n            screen.blit(background_image, (0, 0))\n        else:\n            screen.fill((255, 255, 255))\n\n        # 列布局\n        COL_START = SCREEN_WIDTH // 8 + 50\n        COL_RANK  = COL_START\n        COL_TIME  = COL_START + 100\n        COL_DATE  = COL_START + 230\n\n        # 标题\n        title = font_medium.render(\"🏆 排行榜 - 最佳时间\", True, (0, 0, 0))\n        screen.blit(title, (COL_START + (SCREEN_WIDTH // 4 - title.get_width() // 2) - 50, 180))\n\n        # 锁定提示\n        lock_suffix = []\n        if difficulty_locked:\n            lock_suffix.append(\"自制图片\")\n        if shape_locked:\n            lock_suffix.append(\"已锁定\")\n        lock_text = f\"（{'，'.join(lock_suffix)}）\" if lock_suffix else \"\"\n\n        # 形状使用中文显示\n        selection_text = font_small.render(\n            f\"图片: {current_image} | 难度: {current_difficulty} | 形状: {_shape_to_zh(current_shape)} {lock_text}\",\n            True, (0, 0, 0)\n        )\n        screen.blit(selection_text, (COL_START + (SCREEN_WIDTH // 4 - selection_text.get_width() // 2) - 50, 230))\n\n        # 解析难度\n        try:\n            difficulty_num = int(current_difficulty.split('x')[0])\n        except Exception:\n            difficulty_num = diffs[0]\n            current_difficulty = f\"{difficulty_num}x{difficulty_num}\"\n\n        # 当前筛选记录\n        records = rm.get_records(\n            image=current_image,\n            difficulty=difficulty_num,\n            shape=_normalize_shape(current_shape),\n            limit=1_000_000\n        )\n        best_count = len(records)\n\n        # 该图片的“游玩次数”（所有难度与形状）\n        plays_for_image = rm.get_records(image=current_image, difficulty=None, shape=None, limit=1_000_000)\n        play_count = len(plays_for_image)\n\n        if best_count == 0:\n            # 统计条\n            count_text = font_small.render(\n                f\"本图游玩次数：{play_count}   选定类型共 {best_count} 条最佳纪录\",\n                True, (0, 100, 0)\n            )\n            screen.blit(count_text, (COL_START + (SCREEN_WIDTH // 4 - count_text.get_width() // 2) - 50, 280))\n\n            no_data = font_medium.render(\"暂无成绩记录\", True, (100, 100, 100))\n            screen.blit(no_data, (COL_START + (SCREEN_WIDTH // 4 - no_data.get_width() // 2) - 50, 320))\n\n            hint_text = font_small.render(\"请先完成一局游戏来生成记录\", True, (200, 0, 0))\n            screen.blit(hint_text, (COL_START + (SCREEN_WIDTH // 4 - hint_text.get_width() // 2) - 50, 360))\n        else:\n            count_text = font_small.render(\n                f\"本图游玩次数：{play_count}   选定类型共 {best_count} 条最佳纪录（显示前 {min(TOP_N, best_count)} 条）\",\n                True, (0, 100, 0)\n            )\n            screen.blit(count_text, (COL_START + (SCREEN_WIDTH // 4 - count_text.get_width() // 2) - 50, 280))\n\n            # 表头\n            header_rank = font_small.render(\"排名\", True, (0, 0, 100))\n            header_time = font_small.render(\"时间(秒)\", True, (0, 0, 100))\n            header_date = font_small.render(\"日期\", True, (0, 0, 100))\n\n            screen.blit(header_rank, (COL_RANK, 330))\n            screen.blit(header_time, (COL_TIME, 330))\n            screen.blit(header_date, (COL_DATE, 330))\n\n            line_left = COL_RANK\n            line_right = COL_DATE + header_date.get_width()\n            pygame.draw.line(screen, (200, 200, 200), (line_left, 355), (line_right, 355), 2)\n\n            # 前 TOP_N\n            for i, record in enumerate(records[:TOP_N]):\n                rank_text = f\"{i+1:2d}\"\n                time_text = f\"{record.get('elapsed', 0):6d}s\"\n                date_text = record.get('finished_at', '')\n\n                y_pos = 360 + i * 35\n                screen.blit(font_small.render(rank_text, True, (0, 0, 0)), (COL_RANK, y_pos))\n                screen.blit(font_small.render(time_text, True, (0, 100, 0)), (COL_TIME, y_pos))\n                screen.blit(font_small.render(str(date_text), True, (0, 0, 100)), (COL_DATE, y_pos))\n\n        # 按钮悬停 & 绘制\n        mouse_pos = pygame.mouse.get_pos()\n        for b in buttons:\n            b.check_hover(mouse_pos)\n            b.draw(screen)\n\n        # 事件\n        for event in pygame.event.get():\n            if event.type == pygame.QUIT:\n                return 'quit'\n\n            if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:\n                # 0: 切换图片（跳过 default，如果还有其他图片）\n                if buttons[0].is_clicked(event):\n                    # 重新过滤一次，避免删除后又出现 default 的情况\n                    images = _filter_default_from_images(images)\n                    current_image = _safe_index_next(images, current_image)\n                    apply_lock_for_image(current_image)\n                    print(f\"切换到图片: {current_image}（锁定: diff={difficulty_locked}, shape={shape_locked}）\")\n\n                # 1: 切换难度\n                elif buttons[1].is_clicked(event):\n                    if not difficulty_locked:\n                        next_diff = _safe_index_next(diffs, int(current_difficulty.split('x')[0]))\n                        current_difficulty = f\"{next_diff}x{next_diff}\"\n                        print(f\"切换到难度: {current_difficulty}\")\n                    else:\n                        print(\"难度被锁定，无法切换。\")\n\n                # 2: 切换形状（中文展示，内部英文键）\n                elif buttons[2].is_clicked(event):\n                    if not shape_locked:\n                        current_shape = _safe_index_next(shapes, _normalize_shape(current_shape))\n                        print(f\"切换到形状: {_shape_to_zh(current_shape)}\")\n                    else:\n                        print(\"形状被锁定，无法切换。\")\n\n                # 3: 返回\n                elif buttons[3].is_clicked(event):\n                    return 'menu'\n\n                # 4: 删除当前图片的全部记录（功能替代原“刷新”）\n                elif buttons[4].is_clicked(event):\n                    print(f\"删除图片 '{current_image}' 的所有排行榜记录...\")\n                    delete_current_image_records()\n\n        pygame.display.flip()\n        clock.tick(60)",
      "original_issues": [
        {
          "file": "ranking_ui.py",
          "line": 85,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_ui.py",
          "line": 183,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_ui.py",
          "line": 208,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "ranking_ui.py",
          "line": 249,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "audio_manager.py",
      "path": "fixed_files\\audio_manager.py",
      "fixed_content": "import pygame\nimport os\n\nclass AudioManager:\n    def __init__(self):\n        self.music_volume = 0.3   # 0.0 ~ 1.0\n        self.sfx_volume = 0.5     # 音效音量\n        self.bgm_loaded = False\n\n    def load_background_music(self, music_path):\n        \"\"\"加载背景音乐（不自动播放）\"\"\"\n        if os.path.exists(music_path):\n            try:\n                pygame.mixer.music.load(music_path)\n                pygame.mixer.music.set_volume(self.music_volume)\n                self.bgm_loaded = True\n                print(f\"【音频】加载背景音乐: {music_path}\")\n            except pygame.error as e:\n                print(f\"【音频错误】加载背景音乐失败: {e}\")\n        else:\n            print(f\"【音频警告】背景音乐文件不存在: {music_path}\")\n\n    def play_background_music(self, loops=-1):\n        \"\"\"播放背景音乐\"\"\"\n        if self.bgm_loaded:\n            pygame.mixer.music.play(loops=loops)\n            print(\"【音频】开始播放背景音乐\")\n\n    def set_music_volume(self, volume):\n        \"\"\"设置背景音乐音量（0.0 ~ 1.0）\"\"\"\n        self.music_volume = max(0.0, min(1.0, volume))\n        pygame.mixer.music.set_volume(self.music_volume)\n        print(f\"【音频】背景音乐音量设置为: {self.music_volume:.2f}\")\n\n    def play_correct_sound(self, sfx_path):\n        \"\"\"播放“正确”音效\"\"\"\n        if os.path.exists(sfx_path):\n            try:\n                sound = pygame.mixer.Sound(sfx_path)\n                sound.set_volume(self.sfx_volume)\n                sound.play()\n            except pygame.error as e:\n                print(f\"【音频错误】播放音效失败: {e}\")\n        else:\n            print(f\"【音频警告】音效文件不存在: {sfx_path}\")\n",
      "original_issues": [
        {
          "file": "audio_manager.py",
          "line": 19,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        },
        {
          "file": "audio_manager.py",
          "line": 43,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    },
    {
      "file": "normalizer.py",
      "path": "fixed_files\\normalizer.py",
      "fixed_content": "import os\n\ndef normalize_shape(s: str) -> str:\n    \"\"\"统一到 'rectangle' / 'triangle' / 'jigsaw'\"\"\"\n    mapping = {\n        \"rectangle\": \"rectangle\", \"square\": \"rectangle\", \"正方形\": \"rectangle\", \"方形\": \"rectangle\",\n        \"triangle\": \"triangle\", \"三角形\": \"triangle\",\n        \"jigsaw\": \"jigsaw\", \"irregular\": \"jigsaw\", \"凹凸形\": \"jigsaw\", \"不规则\": \"jigsaw\",\n    }\n    key = (s or \"\").strip().lower()\n    if s in (\"正方形\", \"方形\"): return \"rectangle\"\n    if s == \"三角形\": return \"triangle\"\n    if s in (\"凹凸形\", \"不规则\"): return \"jigsaw\"\n    return mapping.get(key, \"jigsaw\")\n\ndef infer_image_id(image_path: str) -> str:\n    \"\"\"从路径推断 image_id；custom/<id>/... -> <id>；否则用文件名\"\"\"\n    if not image_path:\n        return \"default\"\n    parts = os.path.normpath(image_path).split(os.sep)\n    if \"custom\" in parts:\n        i = parts.index(\"custom\")\n        if i + 1 < len(parts):\n            return parts[i + 1]\n    return os.path.splitext(os.path.basename(image_path))[0]\n\ndef normalize_difficulty(d) -> int:\n    try:\n        return int(d)\n    except ValueError:\n        return 3\n",
      "original_issues": [
        {
          "file": "normalizer.py",
          "line": 31,
          "severity": "LOW",
          "rule_id": "PY011",
          "message": "过于宽泛的异常捕获：Exception。",
          "priority": "MEDIUM",
          "suggested_fix": "请检查代码逻辑并修复"
        }
      ]
    }
  ],
  "verification": []
}